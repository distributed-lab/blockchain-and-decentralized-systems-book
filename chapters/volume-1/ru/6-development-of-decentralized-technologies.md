# 6 РАЗВИТИЕ ДЕЦЕНТРАЛИЗОВАННЫХ ТЕХНОЛОГИ


## 6.1 Ответвления и клоны Bitcoin

Как между дикими животными, так и между образованными людьми разногласия всегда существовали в этом мире. Если мнения людей фундаментально расходятся, они больше не могут эффективно взаимодействовать, обмениваться информацией и согласовывать ее: разногласия не позволяют сформировать какое-либо однозначное утверждение.

Между участниками сети Bitcoin также могут возникать противоречия. В силу того, что сообщества по-настоящему децентрализованных систем открыты и могут состоять из участников с совершенно разным образованием, интересами и целями, то в подобных спорах даже Мухтар и комиссар Рекс могут смело отстаивать право на реализацию своих потребностей и инстинктов (рис. 6.1). В этой теме мы рассмотрим понятия *форков*, а также немного затронем тему *спланированных разделений*, которые могут происходить в открытых сообществах.

![Рисунок 6.1 – Разногласия между членами сообщества](/resources/img/volume-1/6.1-bitcoin-forks-and-clones/6.1-disagreements.png)

Когда говорят о форке в контексте криптовалют, может подразумеваться одно из двух разных значений.

*Форк* (первое значение) – *это процесс клонирования исходного кода некоторой валюты в новый репозиторий*. При этом команда разработчиков запускает новую валюту с нуля: формируется новый genesis block, развертывается новая сеть из новых узлов и пользователей.

Примерами таких форков являются цифровые валюты, такие как Litecoin, Dash, Peercoin, Bytecoin и ZCash (мы уже упоминали их в предыдущих темах и еще будем упоминать в следующих).

*Форк* (второе значение) – *это процесс появления нескольких блоков на одной высоте цепочки*. Такие форки могут быть как случайными, так и спланированными. Этот случай наиболее интересный; рассмотрим его подробнее.

### Спланированные форки

Некоторые узлы могут намеренно модифицировать правила формирования блоков и продолжать работать в рамках одной цифровой валюты. Но если при этом нарушить правила протокола, то могут появляться разногласия по поводу продолжения цепочки блоков или даже по поводу блоков, созданных в прошлом. Это может стать еще одной причиной появления нескольких блоков на одной высоте.

Представьте множество узлов, которые при взаимодействии образуют сеть Bitcoin. Они работают по одинаковым правилам достижения консенсуса и ведут одну историю транзакций, которая записана в общую для всех последовательность блоков, как изображено на рис. 6.2.

![Рисунок 6.2 – Ведение истории транзакции каждым из узлов сети](/resources/img/volume-1/6.1-bitcoin-forks-and-clones/6.2-maintaining-txs-history.png)

Существует специальный репозиторий Биткоина, где можно задокументировать и разместить свое предложение по улучшению работы протокола Биткоина (BIP) [87]. После того, как предложение опубликовано в репозитории, на соответствующих форумах сообщество наиболее активных пользователей ведет дискуссии о целесообразности, безопасности и т. д. Остальные участники сообщества следят за дискуссиями и делают выводы, после чего либо принимают, либо отвергают предложение по улучшению.

Кто-то из сообщества предлагает внести изменения в протокол, которые, допустим, увеличат пропускную способность и уровень конфиденциальности пользователей. Часть сообщества считает, что предложение действительно стоит принять, а для других участников его целесообразность не очевидна.

Стоит отметить, что в децентрализованных системах, хоть и существует некоторое открытое сообщество, члены которого чаще всего являются наиболее компетентными в соответствующих технических и организационных вопросах, власти оно не имеет. Конечное решение участники принимают самостоятельно и независимо друг от друга (рис. 6.3).

![Рисунок 6.3 – Обновление протокола частью участников сети](/resources/img/volume-1/6.1-bitcoin-forks-and-clones/6.3-particular-protocol-update.png)

Таким образом, если владельцы части полных узлов (прежде всего это касается узлов-валидаторов) сомневаются насчет установки этого обновления, то они, вероятно, не станут рисковать и продолжат работать по старым правилам.

Соответственно, вся сеть может разделиться на две подсети: одни пользователи обновят ПО и будут ждать, когда обновление вступит в силу, а другие не будут торопиться или вообще не станут этого делать. Когда обновление вступит в силу, одни узлы будут иметь свои правила формирования и проверки блоков и транзакций, а другие узлы – свои. На этой почве могут возникнуть конфликты, поскольку блоки будут генерироваться на одной высоте, но по разным правилам.

Один из вариантов развития событий состоит в том, что обычные узлы сети могут не принимать блоки, которые сформировали узлы сети с обновленным ПО. В итоге одни начинают строить новую версию цепочки, а другие продолжают строить старую (рис. 6.4).

![Рисунок 6.4 – Разделение сети на две из-за разных правил работы](/resources/img/volume-1/6.1-bitcoin-forks-and-clones/6.4-network-division.png)

Выше описан пример проблемы, с которой может столкнуться сообщество при обновлении ПО. Но давайте обратим внимание на то, как именно происходит это обновление.

### Методы обновления ПО: softfork и hardfork

Можно выделить два метода обновления ПО: softfork и hardfork. По сути, оба метода являются обновлениями протокола, которые подразумевают изменения некоторых правил формирования и проверки транзакций, а также блоков. Такие обновления могут быть обратно совместимыми, а могут не предусматривать этой совместимости. Рассмотрим это детальнее.

*Softfork* – изменение протокола, в котором обновленные правила более приоритетные, а ранее действительные блоки и транзакции все еще поддерживаются узлами с обновленным ПО, но считаются устаревшими. Сложно переоценить значение совместимости при обновлении протокола. В качестве примера из повседневной жизни можно привести разработку обновлений для популярных стандартов USB и HDMI. При их разработке огромное внимание уделяется обратной совместимости обновленных версий со старыми, которые продолжают активно использоваться. Без этого свойства распространение новых стандартов зашло бы в тупик, так как переход всех сторон на новую версию – это процесс, занимающий достаточно много времени (на протяжении которого взаимодействие должно продолжаться).

Другими словами, множество допустимых блоков и транзакций сужается после обновления. Поскольку узлы со старой версией ПО будут распознавать новые блоки как действительные (рис. 6.5), softfork обратно совместим. Чтобы softfork прошел без разделения сети, должны обновиться узлы, которые контролируют большую часть ее вычислительной мощности.

![Рисунок 6.5 – Обновление протокола типа softfork](/resources/img/volume-1/6.1-bitcoin-forks-and-clones/6.5-protocol-update.jpg)

*Hardfork* – изменение протокола, которое делает ранее недействительные блоки и транзакции действительными. Поэтому hardfork требует, чтобы **все** узлы обновили ПО во избежание раздвоения цепочки. Это может быть введением новых форматов данных, новых правил верификации. Соответственно, блок, который будет генерировать старое ПО, не будет поддерживать новое и наоборот. Очевидно, что в случае hardfork возможно два исхода: обновляются все узлы и формирование цепочки продолжается по новым правилам; мнения участников расходятся и цепочка разветвляется, а сообщество раскалывается на группы, каждая из которых работает согласно своему протоколу (рис. 6.6).

![Рисунок 6.6 – Обновление протокола типа hardfork](/resources/img/volume-1/6.1-bitcoin-forks-and-clones/6.6-hardfork.jpg)

До этого речь шла о спланированных форках. Но существуют и другие ситуации, в которых форк необходим и провести его нужно быстро. Например, однажды в протоколе Биткоина была найдена критическая уязвимость, и в течение небольшого промежутка времени пришлось провести незапланированный softfork. Далее рассмотрим этот случай подробнее.

### Незапланированный softfork в Bitcoin

15 августа 2010 года в одном из блоков базы данных Bitcoin была обнаружена транзакция, которая содержала большое количество монет неизвестного происхождения и отправила их на несколько адресов [88]. Примечательно, что эти монеты не были добыты с помощью майнинга. Это произошло не по правилам, которые были заложены в протокол, и весь график эмиссии полностью нарушился. Транзакция имела один вход и два выхода. Каждый из этих выходов отправлял по 92 млрд биткоинов на соответствующий ему адрес (при том, что максимальная эмиссия монет Биткоина имеет ограничение около 21 млн). Как же это случилось?

Кто-то нашел уязвимость в программном коде: выходы транзакций не проверялись отдельно, а проверялось условие, что сумма монет на выходе не превышает сумму монет на входе. Далее этот пользователь подобрал такие значения для каждого выхода, что при суммировании они переполняли целочисленный тип данных int. Получилось, что огромные количества монет каждого выхода превращались в маленькую сумму, которая проходила проверку, и транзакция становилась валидной.

Когда была обнаружена эта транзакция, на форуме создали отдельную тему и предложили решить эту проблему с помощью softfork. Пользователям предложили изменить код программного обеспечения и вручную внести проверку для каждого выхода транзакции. Тем, кто не мог сделать все самостоятельно, было предложено приостановить свою майнинговую деятельность и подождать готовый исполняемый файл с новым ПО.

Узлы с новым ПО стали генерировать новые блоки с той высоты, где еще не было блока с «плохой» транзакцией. Узлы, которые не были уведомлены об этом происшествии, продолжали цепочку блоков с критической транзакцией. Постепенно количество узлов с обновленным ПО росло, и со временем они стали контролировать большинство вычислительной мощности. Их честная цепочка стала длиннее, и на нее перешли узлы, которые не были обновлены. Вознаграждение, которое было получено в результате майнинга в цепочке с некорректной транзакцией, при переходе на «правильную» цепочку было потеряно.

В этом случае сработал социальный консенсус: все понимали необходимость проведения обновления и поддержали его. Но так случается не всегда, особенно, когда форк *спланированный*. В примере ниже социальный консенсус не сработал.

### Появление спланированных форков

Появление спланированных форков вполне обосновано. В качестве примера можно привести случай с Ethereum, когда часть сообщества решила обновить протокол, изменив прошлую историю блоков, чтобы искусственно повлиять на конечное состояние децентрализованной учетной системы. Другая часть сообщества не поддержала это обновление и сохранила оригинальные правила протокола, чтобы поддерживать децентрализованную учетную систему в соответствии с изначальными принципами; эта система получила название Ethereum Classic. Ethereum так и остался первым из самых известных случаев спланированных форков, где были нарушены основные принципы неизменности истории формирования конечного состояния базы данных.

В 2016 году злоумышленники совершили успешную атаку на децентрализованную организацию The DAO. Эта компания работала на платформе Ethereum, и основной ее идеей было создание полноценной организации без применения иерархической модели управления. Была найдена и проэксплуатирована уязвимость в исходном коде. До того как уязвимость устранили, злоумышленникам удалось перевести на свой счет монеты ether стоимостью, эквивалентной 60 млн USD.

Поскольку пострадало много пользователей и атака была самой значительной из всех предшествующих, некоторые члены сообщества Ethereum предложили откатить цепочку блоков до момента, когда уязвимость еще не была использована. Но предложение поддержали не все, и сообщество разделилось во мнениях: одни считали, что состояние смарт-контрактов нужно перераспределить, а другие сказали, что это противоречит принципам децентрализации, и не поддержали эту инициативу. В результате сообщество разделилось на две группы, каждая из которых руководствовалась своей идеологией.

Обновление было выпущено. Одни узлы обновились, а другие не стали этого делать. Сеть разделилась на две группы узлов, и цепочка блоков, соответственно, продолжила развиваться параллельно в виде двух разных ветвей. Произошло клонирование исходного кода протокола и изменение некоторых правил, а также раздвоение цепочки блоков и раскол сети, которые изначально не предусматривались, а стали следствием того, что участники сообщества не достигли согласия.

### Примеры спланированных форков Биткоина

Обратим внимание на случаи, когда имело место крупное раздвоение блокчейна Биткоина. Один из них – Bitcoin Cash, когда был осуществлен hardfork – обновление протокола с целью изменения базовых параметров. Некоторые активные участники сообщества предложили повысить пропускную способность системы путем увеличения размера блока. Но далеко не все в сообществе были согласны, что это оптимальный путь. Многие отдали предпочтение активации Segregated Witness, но кто-то все равно настаивал на альтернативных вариантах повышения пропускной способности.

Те участники сообщества, которые поддержали увеличение размера блока, обновили ПО и стали работать над параллельной веткой цепочки блоков. Это значит работать фактически с альтернативной валютой.

Спланированный форк Bitcoin Cash произошел летом 2017 года. После разделения цепочки блоков Биткоина и появления Bitcoin Cash в определенный момент оказалось, что прибыльность майнинга в альтернативной цепочке выше, чем в основной. Естественно, некоторые валидаторы решили переключиться на формирование блоков для учетной системы Bitcoin Cash вопреки тому, что на самом деле они не поддерживают идею форка и считают блоки с больши́м размером «большим злом».

> **_Замечание._** *Большие блоки проблемные не в контексте решения разногласий среди участников системы, а с точки зрения архитектуры: с увеличением размера блока конкуренция за место в блоке уменьшается, вследствие чего это место используется менее эффективно (например увеличивается количество спама).*

Как же это повлияло на частоту генерации блоков? Предположим, что владельцы 50% вычислительной мощности в сети Биткоина переключили свое оборудование на поддержание другой сети. Тогда средний период формирования блока в цепочке Биткоина стал равен 20 минутам. Соответственно, транзакции подтверждаться стали дольше, и пропускная способность сети снизилась в два раза. Такая ситуация будет продолжаться до тех пор, пока не произойдет перерасчет параметра сложности.

Однако последние исследования сети Bitcoin Cash показывают, что она имеет высокий уровень централизации. Анонимная группа BitPico на основании проведенных исследований утверждает, что большинство активных узлов связаны друг с другом. После проведенного стресс-теста оказалось, что 98% полных узлов Bitcoin Cash находятся в одном серверном шкафу [89]. Целью команды было продемонстрировать, насколько сеть Bitcoin Cash на самом деле является централизованной, что угрожает стабильности работы этой цифровой валюты.

До определенного момента у сетей Bitcoin Cash и Bitcoin была общая история, но после форка для каждой приоритетной стала своя цепочка со своими правилами.

Подобным образом появился форк Bitcoin Gold. Его сообщество поддерживает другой алгоритм майнинга, который имеет более децентрализованный характер.

Форк под названием SegWit2x был запланирован очень давно. Его сторонники хотели увеличить размер блока в два раза и одновременно реализовать поддержку Segregated Witness. Когда поняли, что это приведет к расколу сообщества, отказались его внедрять.

Во всех случаях механизм достижения консенсуса один и тот же – proof-of-work. Но хэш-функции, которые используются для хэширования заголовков блоков при решении задачи proof-of-work, отличаются. В Bitcoin и Bitcoin Cash применяется хэш-функция SHA-2 на длине 256 бит (отсюда можно догадаться, что майнить валюту можно на специализированных чипах в обоих случаях). В Bitcoin Gold реализована хэш-функция, которая используется в ZCash – EQUIHASH. Она была специально разработана так, чтобы наиболее энергоэффективными для вычислений были графические процессоры.

Чтобы подстраивать частоту формирования блоков, существует параметр сложности ресурсоемкой задачи, который обновляется с определенной периодичностью. В протоколе Bitcoin этот период времени приблизительно равен двум неделям; в протоколе Bitcoin Cash – двум неделям плюс EDA (emergency difficulty adjustment). EDA – это некоторый промежуток времени, который нужен для защиты от раскачивания параметра сложности. Это раскачивание может быть выгодно валидаторам, но неудобно для пользователей, потому что время подтверждения транзакций резко изменяется каждые две недели. В Bitcoin Gold этот параметр обновляется с каждым новым блоком. Обновление SegWit поддерживают все перечисленные форки, кроме Bitcoin Cash.

**Часто задаваемые вопросы**

*– Litecoin считается форком Bitcoin?*

Да, конечно. Мы рассмотрели понятие форка в двух разных значениях. В первом случае речь идет о копировании исходного кода проекта и поддержание его отдельной командой: отдельная сеть и новая база данных. Получается новая валюта с новыми параметрами. В другом значении – это разветвление самого блокчейна. Litecoin – это форк в первом значении.

*– Форк SegWit2x – то же ли самое, что технология Segregated Witness?*

Нет. И правильно говорить, кстати, предложение по обновлению, которое подразумевает форк. Оно было предложено до того, как в августе 2017 года в Биткоин была добавлена поддержка Segregated Witness. А после этого проводить еще один форк с увеличением размера блока было нецелесообразно.

*– Что происходит в случае softfork с транзакциями из «плохой» цепочки после того, как «хорошая» обгонит ее?*

Если они не конфликтуют с транзакциями в основной сети, то они будут добавлены в основную цепочку, поскольку валидаторы заинтересованы найти их и забрать себе комиссию.

*– Какой максимальный разрыв был между «плохой» и «хорошей» цепочкой? Было ли больше 6 подтверждений, что фактически означает полное подтверждение транзакций? (Вопрос относительно softfork в 2010 году.)*

В этом случае уязвимость была найдена вручную и сработал социальный консенсус. Действительно, те, кто знал об этой проблеме, могли воспользоваться этим и сделать двойную трату. Те, кто не знал, могли стать жертвой. Однако транзакции из «плохой» цепочки, которые не конфликтовали, были добавлены в «хорошую» цепочку, а монеты, которые были получены из ниоткуда, не распространились дальше.

*– Dogecoin – это тоже форк Bitcoin?*

Да, в том смысле, что был скопирован исходный код. Были изменены некоторые параметры. Но изменения коснулись не механизма достижения консенсуса, а правил формирования цепочки блоков: частоты формирования блоков, максимального размера блока и т. д.

*– Как начисляются монеты в форках Биткоина?*

Если, например, вы имели монеты в Bitcoin до наступления форка, то вы автоматически получаете пропорциональное количество монет и в альтернативной ветви. В программном коде задается высота блока, после которой вступают в силу альтернативные правила.

*– Можно ли стать членом сообщества Bitcoin?*

Да, конечно, вы можете стать членом сообщества Bitcoin, чтобы влиять на решения о развитии Bitcoin, предлагать новые обновления и технологические новшества. 

## 6.2 Альтернативные цифровые валюты и токены

Часть подходов к децентрализации, рассмотренных в этой книге, были либо впервые предложены, либо впервые протестированы в Биткоине. Но то, что уже реализовано и работает, не является пределом возможностей инженеров или профессиональных разработчиков и тем более не является пределом мечтаний обычного пользователя. Есть много людей с намерениями протестировать более инновационные механизмы, но не каждый из них можно просто и быстро внедрить в Bitcoin.

Так возник целый ряд альтернативных цифровых валют, некоторые из которых мы кратко рассмотрим ниже, чтобы ознакомиться с основной сутью их инноваций. Среди них – Litecoin, Dash, NXT, BitShares, Monero, Ethereum, Cardano, Ripple, Stellar и ZCash. Но прежде всего следует разобрать понятие криптовалюта.

### Что такое криптовалюта?

*Криптовалюта (cryptocurrency) – это независимая цифровая валюта, в которой децентрализовано управление следующими процессами: эмиссия монет, подтверждение транзакций, хранение данных, аудит учетной системы и принятие решений об обновлениях (governance), – а стать участником системы может любой желающий*. Также отметим, что цена монеты криптовалюты определяется исключительно соотношением спроса и предложения на соответствующих торговых площадках.

Именно децентрализованность всех процессов – отличительная особенность криптовалюты. Если хотя бы один из этих процессов происходит централизованно, то перед вами – не криптовалюта. Такая система не будет настолько устойчивой и надежной, как децентрализованная.

Собственно, интерес к криптовалютам и обусловлен их свойствами, которые позволяют свободно и надежно совершать платежи, избегая бюрократической составляющей, например, регистрации и ограничений. Более того, эти валюты весьма устойчивы к разного рода атакам и цензуре.

Каждый пользователь криптовалюты может провести аудит всех транзакций. Для этого не нужно получать каких-либо разрешений от кого-либо. То же касается подтверждения новых транзакций. Таким образом, ни для создания новых транзакций, ни для их подтверждения пользователям криптовалюты не нужно проходить процедуру идентификации (KYC).

> **_Замечание._** *KYC (Know Your Customer) представляет собой процедуру, который проводит организация для верификации личностей клиентов и корректного начала взаимодействия с ними.*

Для криптовалюты характерна полностью децентрализованная эмиссия. Новые монеты в системе должны появляться согласно определенному алгоритму, который лежит в основе внутренней монетарной политики.

Стоит упомянуть о голосовании за обновление протокола и об участии в принятии решения, поскольку в условиях децентрализации это ключевой нюанс, который определяет усовершенствование валюты. Чем больше участников могут предложить свои улучшения, тем больше шансов провести оптимальное обновление протокола.

Совершенно очевидно, что свойства криптовалюты могут быть достигнуты только при условии открытой спецификации протокола, его реализации с открытым исходным кодом и при наличии достаточно большого открытого сообщества.

### Litecoin

Обзор альтернативных монет начнем с Litecoin (рис. 6.7). Это одна из самых старых криптовалют, которая появилась еще в 2011 году. Валюта создана на основе исходного кода Bitcoin, но с некоторыми изменениями. Целевой период формирования блока был сокращен в четыре раза (до 2,5 минут), что повлекло за собой увеличение итоговой эмиссии монет в 4 раза.

![Рисунок 6.7 – Litecoin](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.7-litecoin.png)

Litecoin использует хэш-функцию *script* для доказательства выполнения работы. Эта хэш-функция использует SHA-256 как подпрограмму, полагаясь на большое количество арифметических вычислений, но также требуя наличия быстрого доступа к большим объемам памяти, что делает создание интегральных схем специального назначения (ASICs) менее выгодным. Несмотря на то, что Litecoin имеет мало принципиальных отличий от Биткоина, он нашел свою аудиторию и сообщество, которое его поддерживает. Благодаря этой поддержке Litecoin занял весьма устойчивую позицию. 

### Dash

Следующая криптовалюта называется Dash (рис. 6.8). Проект этой валюты был запущен в 2014 году. Особенность протокола – сокращение периода генерации блока и, соответственно, повышение пропускной способности. В качестве алгоритма хэширования для PoW применяется Х11, который поначалу позволял энергоэффективно решать ресурсоемкую задачу на графических процессорах, но позже для этих целей все-таки спроектировали и выпустили специализированные чипы (ASICs).

![Рисунок 6.8 – Dash](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.8-dash.png)

Dash поддерживает технологии *PrivatSend* и *InstantSend*. Первая из них – это технология *перемешивания (mixing)* монет, иначе говоря, технология запутывания истории происхождения монет. Проект Dash приоритетной задачей сделал повышение конфиденциальности пользователей. Для этого была реализована модификация подхода *CoinJoin*. Этот подход подразумевает объединение нескольких платежей в одной общей транзакции, которая смешивает монеты и сильно затрудняет отслеживание однозначной истории их происхождения.

На примере это выглядит так: четыре человека положили деньги в общий сейф, потом независимо друг от друга пришли и забрали из этого сейфа ту же сумму денег. Человек со стороны никогда не узнает, какова доля каждого в этой общей сумме и какие именно банкноты кому принадлежат.

InstantSend – это технология мгновенных платежей, где получателю не нужно дожидаться подтверждения транзакции; ее добавление в блок основной цепочки гарантируется (в случае соответствия транзакции правилам протокола).

Достижение консенсуса в Dash также имеет свои особенности: опции PrivatSend и InstantSend реализуются с помощью так называемых *masternodes* – отдельной группы валидаторов, которые достигают консенсуса между собой [90]. Каждый узел сети может стать masternode. Требуется только иметь определенное количество монет на адресе. Эти монеты замораживаются и будут использоваться в качестве депозита.

Управление изменениями (governance) в Dash имеет свои особенности. На развитие проекта идет 10% от общего дохода за майнинг, 45% идет обычным узлам, а остальные 45% – masternodes. Управление бюджетом на разработку протокола Dash осуществляется посредством голосования masternodes. Таким образом, все предложения разработчиков по поводу улучшения протокола (повышение качества сети, пропускной способности) могут принимать либо отклонять только masternodes. Однако считать систему децентрализованной в полной мере нельзя, поскольку управление улучшениями проекта не зависит от обычных участников системы. Каждый пользователь системы может предлагать свои проекты по ее улучшению, которые в дальнейшем могут быть профинансированы. Происходит финансирование довольно просто: пользователю нужно оставить *заявку (treasury)* с предложением идеи, за которую могут проголосовать владельцы masternodes.

### Отличие алгоритмов майнинга Litecoin, Dash и Bitcoin

Заметим, что рассмотренные выше альткоины отличаются от Биткоина алгоритмами хэширования, что и определяет тот факт, что майнеры, предназначенные для добычи биткоинов, невозможно использовать для добычи альтернативных цифровых валют (за исключением совпадения алгоритма хэширования, формата заголовка блока и некоторых других деталей). Основная цель таких мер – достижение условий, при которых валидаторы Биткоина не могли бы атаковать сеть Litecoin, Dash или любой другой криптовалюты. Другими словами, отдельные валюты стараются использовать уникальный алгоритм майнинга, чтобы невозможно было провести атаку 51%.

Представим, что hash rate сети Litecoin составляет 10% по сравнению с Bitcoin и обе валюты используют одинаковый алгоритм решения задачи для создания блока. Тогда валидаторы Bitcoin могли бы легко переключиться на сеть Litecoin и быстро построить альтернативную цепочку, которая могла бы существенно превысить по длине основную. Это сделало бы возможным проведение атаки двойной траты. Чем большая мощность направляется на создание цепочки, тем быстрее она создается. Это особенно актуально на ранних этапах развития сети, когда она еще не располагает большой вычислительной мощностью. 

### NXT

Перейдем к другой независимой цифровой валюте – NXT (рис. 6.9). NXT была запущена в 2013 году анонимным разработчиком. Платформа использует механизм достижения консенсуса на основе proof-of-stake. NXT изначально была задумана как гибкая платформа, предоставляющая возможность реализации различных финансовых приложений и услуг.

![Рисунок 6.9 - NXT](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.9-nxt.png)

Инфраструктура платформы NXT является довольно сложной по сравнению с Bitcoin. Особенность платформы – наличие внутренней биржи цифровых активов и системы обмена сообщениями [91]. Эмиссия проводилась централизованно и один раз. Система NXT позволяет каждому пользователю создавать и эмитировать собственные токены для представления и учета любых активов или обязательств. Этими токенами можно торговать на внутренней бирже NXT.

Обмен сообщениями позволяет отправлять обычные либо зашифрованные сообщения и обеспечить хранение данных до 1 кБ в совместной базе данных на постоянной основе и до 42 кБ на протяжении ограниченного времени.

Из ограничений платформы можно выделить достаточно низкую пропускную способность (4–5 транзакций в секунду), а также время подтверждения транзакции от 10 до 15 минут.

### BitShares

Идея протокола BitShares была озвучена в 2013 году и состоит в создании инструмента, с помощью которого можно было бы торговать разными активами и валютами в децентрализованной среде без их фактического депонирования на торговую площадку (рис. 6.10).

Платформа BitShares позволяет кому угодно создавать user issued assets (UIA), или цифровые токены. Таким образом, на платформе учитывается базовая валюта, т. е. криптовалюта BitShares (BTS), и множество пользовательских токенов.

![Рисунок 6.10 - BitShares](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.10-bitshares.png)

Кроме этого, BitShares позиционирует себя как платформа смарт-контрактов. Смарт-контракты здесь предустановленные (набор шаблонов) и их количество ограничено (реализованы наиболее популярные контракты), но они более энергоэффективные и, соответственно, обходятся дешевле в контексте комиссий.

Еще одной особенностью платформы является поддержка платежей с повышенным уровнем конфиденциальности пользователей. В BitShares эта технология называется stealth transfers.

### Monero

Проект криптовалюты Monero (рис. 6.11), в которой основной упор сделан на повышение уровня конфиденциальности пользователей, появился в 2014 году как форк Bytecoin. Bytecoin был анонсирован в 2014 году и позиционировался как проект, реализующий анонимную платежную систему. Часть сообщества обеспокоилась, когда было обнаружено, что 80% монет Bytecoin (BCN) было уже добыто [92]. В этом просматривались неутешительные перспективы: для вознаграждения валидаторов, занимающихся добычей монет, оставалось около 20% предусмотренного объема эмиссии, а наличие большого количества монет у ранних участников ставило под угрозу цену валюты BCN, поскольку они теперь могли манипулировать рынком. Поэтому часть сообщества решила создать свой проект – Monero.

Monero работает по правилам, которые определены в протоколе CryptoNote [93], и позволяет осуществлять анонимизацию трафика на сетевом уровне, скрывать происхождение монет в каждой транзакции, скрывать суммы платежей от сторонних наблюдателей, а также скрывать связь между идентификаторами пользователей и адресами, к которым фактически прикреплены монеты.

![Рисунок 6.11 - Monero](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.11-monero.png)

На уровне модели транзакции реализован механизм запутывания истории происхождения монет, который вообще не использует третью сторону. В отличие от Dash, где в роли миксера выступает конкретный сервер или группа серверов, в Monero монеты перемешиваются по специальным схемам с применением криптографических алгоритмов. Создается транзакция, в которую помещаются монеты, а дальше запускается каскад переводов; в итоге монеты поступают на указанный адрес. История переводов получается настолько запутанной, что определить адрес отправителя практически невозможно.

Такой механизм использует *кольцевую подпись (ring signature)*. Его суть заключается в том, что отправитель монет сам формирует группу адресов, среди которых он будет скрывать переводы. Он создает транзакции и подписывает их от лица группы, причем без согласия остальных членов этой группы. В Monero также имплементирован механизм confidential transactions [94], который скрывает еще и сумму транзакции (со стороны ее невозможно определить). Но поскольку размер группы ограничен, вероятность отслеживания транзакции ненулевая (сложность отслеживания напрямую зависит от размера группы).

Касательно анонимизации трафика на сетевом уровне в Monero реализована оптимизированная версия протокола I2P (Invisible Internet Project) [95], который является более совершенным по сравнению с Tor.

Генерация блока в системе занимает приблизительно 2 минуты, а полное подтверждение транзакции – до 30 минут.

### Ethereum

Особенность Ethereum состоит в поддержке программируемой цифровой валюты (рис. 6.12). Ethereum можно назвать по-разному: кто-то называет его платформой смарт-контрактов, кто-то – децентрализованным компьютером. Учетная система имеет базовую валюту *ether*.

![Рисунок 6.12 - Ethereum](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.12-ethereum.png)

Эмиссия в Ethereum не ограничена верхним пределом. Каждый год появляется 18 миллионов новых монет, то есть инфляция является бесконечной и постоянно снижается. Период генерации блока составляет 10–20 секунд. Сейчас алгоритм достижения консенсуса в Ethereum – proof-of-work, но обсуждается возможность перехода на proof-of-stake.

Особенность Ethereum в том, что каждая транзакция, которая осуществляется в сети, может выполняться согласно некоторым правилам, которые участники заранее определяют (условия смарт-контракта).

Например, Алиса пересылает монеты Бобу. Она ставит условие, в котором оговаривается возможность наступления каких-то дополнительных событий. Если эти события наступают, то валидаторы эту транзакцию подтвердят. Если в Биткоине есть только одно условие – корректная цифровая подпись, то в Ethereum можно указать любые условия, которые требуются. Можно указать также источники внешних данных. Функция поставки их в сеть возлагается на так называемых *оракулов (oracles)*. Суть их применения можно объяснить эмпирически.

Допустим, необходимо создать *смарт-контракт* (подробнее в 6.3), который будет страховать пшеничное поле на случай пожара и реализовывать выплату компенсации владельцу за потерянный урожай. Несколько собственников формируют общий страховой бюджет, который поделят между собой пострадавшие вследствие пожара, если он случится. Далее этот бюджет будет управляться исключительно по предварительно описанным в смарт-контракте условиям.

При этом лучше использовать не одного оракула, а нескольких, чтобы минимизировать риск подкупа и сговора. Тогда они независимо друг от друга будут передавать смарт-контракту данные о пожарах. Каждый из оракулов будет использовать собственные способы слежки: данные спутника, местные пункты пожарной безопасности, данные с камер наблюдения дронов и т. д. Если контракт получает подтверждение пожара на конкретном поле от большинства предустановленных оракулов, то принимается решение выплатить страховую сумму владельцу поля.

Если в течение предустановленного периода времени пожар не случился, то бюджет возвращается на аккаунты вкладчиков. Можно также предусмотреть, что оракулы получают фиксированное вознаграждение за свою работу вне зависимости от исхода.

### Cardano

Проект Cardano (рис. 6.13) – это децентрализованная платформа смарт-контрактов, которые могут быть запрограммированы с помощью полных по Тьюрингу языков. ПО полных узлов сети реализовано на функциональном языке программирования Haskell. Как заявляют разработчики, их платформа использует доказуемо стойкий алгоритм достижения консенсуса, основанный на идее proof-of-stake. Алгоритм называется Ouroboros и был разработан и реализован специально для применения в этой децентрализованной учетной системе.

![Рисунок 6.13 - Cardano](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.13-cardano.png)

Учетная система использует встроенный механизм голосования для управления изменениями. Максимальный объем эмиссии базовой валюты платформы составляет 45 млрд монет. Одноразовая предэмиссия была осуществлена централизованно еще до запуска платформы, а далее эмиссия осуществлялась в виде вознаграждения участников за созданные блоки.

### Stellar and Ripple

Цифровая валюта Ripple была запущена в 2011 году. Изначально проект назывался Opencoin, но в 2013 году был переименован в Ripple. Некоторые идеи, которые заложены в Ripple, появились еще до Биткоина, а именно в 2005–2006 годах, а принципы работы знакомы по средневековой системе денежных переводов Hawala. Однако уже после появления Bitcoin основатель Ripple решил их внедрить в своем проекте.

У основателя Ripple был конфликт с другими членами команды, в результате которого в 2014 году произошел форк – Stellar (рис. 6.14). Изначально исходные коды Ripple и Stellar были одинаковыми. Несмотря на это, Stellar не похож на форк Bitcoin Cash, который до определенного блока имеет ту же историю, что и Bitcoin: Stellar начал работать с отдельной историей.

![Рисунок 6.14 - Stellar](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.14-stellar.png)

![Рисунок 6.14 - Ripple](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.14-ripple.png)

Предназначение Ripple как системы – создать децентрализованную биржу и механизм расчетов между сторонами. Все монеты нативных валют в обеих системах были выпущены и распределены централизованно. Также пользователи могут выпустить собственные активы (IoU) и торговать ими на децентрализованной бирже.

Основные отличия этих цифровых валют от Bitcoin состоят в том, что эмиссия монет выполняется централизованно, механизм достижения консенсуса основан на FBA, все валидаторы децентрализованной учетной системы неанонимные (напротив, каждый из них идентифицирован).

### ZCash

ZCash – криптовалюта, основной упор в функционировании которой приходится на обеспечение конфиденциальности транзакций. Результаты транзакций публикуются в основной цепочке блоков, но детали, такие как данные отправителя, получателя и сумма транзакции остаются конфиденциальными. Криптовалюта была анонсирована в 2016 году (рис. 6.15).

![Рисунок 6.15 - ZCash](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.15-zcash.png)

ZCash – первая в мире криптовалюта, которая основывается на протоколе *доказательства с нулевым разглашением (zero-knowledge proof)*, что позволяет пользователям криптовалюты скрывать детали транзакций. Архитектура системы идентична архитектуре Bitcoin. Ключевыми отличиями являются уменьшение времени формирования и увеличение объема блоков (вынужденная мера, поскольку транзакции, использующие zero-knowledge proofs, имеют гораздо больший размер).

Важной частью функционирования криптовалюты ZCash является механизм под названием *trusted setup*. Доказательства с нулевым разглашением в ZСash основываются на наборе открытых общесистемных параметров, использование которых позволяет пользователям создавать и проверять конфиденциальные транзакции на соответствие правилам протокола. Эти параметры и должны быть сгенерированы на этапе trusted setup начальной настройки (при взаимодействии шести участников) [96]. Предполагается, что эти шесть участников удаляют материал, связанный с промежуточным ключом, который остается после trusted setup (иначе эти участники могут сговориться и скомпрометировать транзакции определенного пользователя). Однако очевидно, что не существует способа  проверить, действительно ли эти данные удаляются (например, аппаратные устройства этих пользователей могут быть модифицированы спецслужбами).

Из особенностей ZCash стоит выделить permissioned аудит транзакций, который предполагает, что детали транзакции можно видеть, только получив необходимое разрешение от стороны, непосредственно сформировавшей транзакцию. Стоит упомянуть, что 20% всех добытых монет автоматически уходят на счета разработчиков протокола.

### Другие цифровые валюты

Для сравнения вышеперечисленных цифровых валют между собой мы использовали критерии, такие как процесс эмиссии монет и особенности подтверждения транзакций, аудит транзакций и процесс управления обновлениями. Также сравнивалась пропускная способность систем, время полного подтверждения транзакции и уровень приватности пользователей (табл. 6.1).

![Таблица 6.1 – Сравнение основных цифровых валют](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/table-6.1-comp.png)

Проанализировав, например, базовую валюту Ripple (XRP), увидим, что ее эмиссия и подтверждение транзакций осуществляются централизованно. Следовательно, Ripple – это цифровая валюта (а не криптовалюта), потому что не все процессы в системе происходят децентрализованно.

Теперь перейдем к другому виду цифровых активов – токенам – и определим основные особенности, которые помогут их отличить от цифровых валют (рис. 6.16).

![Рисунок 6.16 – Классификация цифровых активов](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.16-classification.png)

### Токены

В конце 2016 года начался резкий рост количества проектов, которые стремились запустить собственную валюту для финансирования разработки определенного сервиса. Чаще всего такое действие обосновывалось необходимостью иметь сеть, которая бы предоставляла услуги децентрализованно. Среди самых известных проектов можно выделить Filecoin, OmiseGo, Steemit, Golem, Basic Attention Token, Bancor и другие. В подавляющем большинстве их целью не было создание криптовалюты в полном смысле этого слова, а, скорее, внутреннего платежного средства, с помощью которого пользователи могли получать доступ к услугам (utility tokens).

Практически все проекты подобного рода стремились запустить свою учетную систему, используя технологию блокчейн, однако до того, как это происходило, их токены выпускались на платформе Ethereum и торговались на биржах. После запуска собственной учетной системы (для цифровой валюты, платформы смарт-контрактов и т. п.) эти токены заменялись монетами базовой валюты.

Токены отличаются от монет криптовалюты тем, что могут эмитироваться как централизованно (под управлением одной организации), так и децентрализованно (под управлением заранее определенного алгоритма). Это главное отличие токенов от криптовалют, где все процессы децентрализованы.

> **_Замечание._** *В отличие от цифровой валюты токен – это оцифрованное право собственности на актив. Он также может быть использован в качестве платежного средства. Суть обмена токенов или оплаты ими других товаров или сервисов эквивалентна сути бартера.* 

Таблица 6.2 наглядно отражает отличия цифровых активов по характеру осуществления процессов, которые происходят внутри соответствующей учетной системы.

![Таблица 6.2 – Отличия между группами цифровых активов](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/table-6.2-dist.png)

### Итоги

Приведем определение криптовалюты, наиболее точно передающее ее суть и свойства. *Криптовалюта – это независимая цифровая валюта, в которой децентрализовано управление следующими процессами: эмиссия монет, подтверждение транзакций, хранение данных, аудит учетной системы и принятие решений об обновлениях.* Владеть валютой и совершать транзакции может кто угодно, причем на равных правах с остальными пользователями, а стоимость монеты не подвержена влиянию со стороны создателей.

Овладение правильной терминологией необходимо для однозначного восприятия и представления информации. В таблице 6.3 приведено сравнение различных цифровых активов в соответствии с основными критериями. Изучение этой таблицы позволит вам выделить основные группы активов, а также лучше ориентироваться во многих областях цифровых финансовых технологий.

![Таблица 6.3 – Сравнение цифровых активов между собой](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/table-6.3-comp.png)

**Часто задаваемые вопросы**

*– В чем принципиальная разница между Ripple и Stellar?*

Ripple – коммерческая компания, она продает свою валюту для получения прибыли. Stellar зарегистрирована как неприбыльная организация, которая продает часть эмиссии своей валюты для покрытия расходов. Их принципы работы примерно одинаковы, но Ripple, прежде всего, ориентируется на банки, а Stellar – на платежные системы. 

*– Если цифровая валюта не реализует майнинг, то насколько она надежна?*

Если под надежностью подразумевать отсутствие возможности подделывать транзакции, то эта особенность не зависит от наличия возможности майнинга, а определяется протоколом, в котором должен быть заложен механизм защиты от подтверждения поддельных транзакций. Преимуществом валют, использующих майнинг на основе PoW, можно считать то, что процесс достижения консенсуса между валидаторами не зависит от отдельных лиц, а субъективность принятия решений может быть минимальной.

*– Известно, что в криптовалюте ZCash поддерживается два типа адресов, которые начинаются на «t» и «z» соответственно. В чем разница между такими адресами?*

Адреса, начинающиеся с «t», в целом ничем не отличаются от bitcoin-адресов и называются прозрачными. Все действия с использованием таких адресов являются прозрачными и могут быть видны каждому пользователю сети.

Адреса, которые начинаются с «z», включают в себя улучшения, касающиеся конфиденциальности, которые обеспечивает использование доказательств с нулевым разглашением, и называются shielded addresses (экранированные, защищенные адреса).

*– Поддерживает ли ZCash multisignature транзакции?*

Да, открытые адреса в ZCash поддерживают multisignature транзакции. Однако shielded addresses на сегодняшний день еще не поддерживают подобную функциональность.

*– Поддерживает ли BitShares функционирование SPV-узла?*

На данный момент BitShares не поддерживает функционирование  SPV-клиентов; каждому пользователю необходимо иметь локальную копию базы данных для надежного взаимодействия в сети.

*– Для чего в транзакциях Ethereum мы самостоятельно задаем параметр GasLimit? Не может ли он рассчитываться автоматически?*

Параметр GasLimit содержит в себе значение максимального количества монет, которое пользователь готов потратить на выполнение смарт-контракта. Для обычной передачи монет между пользователями сети этот параметр рассчитывается в большинстве случаев автоматически, но в случае смарт-контрактов ситуация отличается. Дело в том, что заранее очень сложно определить, не зациклится ли смарт-контракт (если допущена некоторая ошибка в коде, выполнение контракта может происходить бесконечно). Если монеты со счета будут сниматься по мере выполнения контракта, то пользователь рискует потерять все свои деньги. Параметр GasLimit позволяет защититься от потери средств, связанной с возникновением бесконечного цикла. И этот параметр должен задавать непосредственно пользователь.

*– Существует ли реализация облегченного узла для Monero?*

Monero не поддерживает функционирование SPV-клиента. Однако в Monero существует реализация так называемого *lightweight wallet*. Особенность функционирования ПО такого кошелька заключается в следующем. Вы определяете узел, к которому будете подключаться и который будет отслеживать ваши транзакции в цепочке блоков. Этот узел будет знать о факте получения денег, но суммы и адрес отправителя останутся для него неизвестными. Для большей конфиденциальности предлагается развернуть собственный полный узел сети и подключать к нему свои же lightweight wallets.

*– Что представляет собой masternode в Dash?*

Masternodes играют важную роль в инфраструктуре Dash, позволяя обеспечить некоторые функции, не доступные (труднодоступные) одноранговым децентрализованным учетным системам. По сути, masternode является компьютером, подключенным к Интернету и выполняющим следующие функции: блокировка транзакций, поддержка мгновенных транзакций, смешивание монет, голосование по вопросам финансирования сети и др. Masternode должен иметь минимум 1000 DASH в качестве обеспечения, находиться в сети 24 часа в сутки и иметь минимальные потери связи.

*– Если эмиссия ether неограничена, усложняется ли его майнинг со временем?*

На самом деле количество выпускаемых ether рассчитывается по одной формуле и зависит от количества уже выпущенных монет, а сложность майнинга рассчитывается по другой формуле и подстраивается под вычислительную мощность всех валидаторов.

## 6.3 Введение в смарт-контракты

В некотором смысле мы можем рассматривать технологию blockchain как способ прийти к соглашению относительно прошлого. Это соглашение основывается на безопасности криптографических алгоритмов, которые защищают целостность истории транзакций (событий). Использование смарт-контрактов позволяет достичь согласия относительно будущего за счет того, что результат выполнения смарт-контракта зависит только от заданных условий и входных данных. При этом следует понимать, что условия задаются до того, как контракт задействуется, а входные данные могут быть определены позже. Стоит также учитывать, что часть условий может не выполниться, поэтому все возможные варианты его завершения должны быть приняты во внимание на этапе создания.

По этой причине смарт-контракты считаются одной из самых перспективных технологий, которая должна изменить привычные способы ведения бизнеса. Практический эффект от их использования состоит в автоматизации финансовых и юридических отношений между двумя и более субъектами. Чтобы детально разобраться в принципах, возможностях и ограничениях технологии, сначала нужно разобраться с проблемами традиционных (бумажных) контрактов.

Затронем сложности, которые часто сопровождают работу с обычными контрактами. Проблемы могут возникнуть при составлении, понимании, верификации, исполнении и т. д.

> **Сложности при составлении обычного контракта**
>> * *Чаще всего грамотно составить контракт под силу только юристу* 
>> * *Сложно добиться полноты условий контракта* 
>> * *Невозможно быстро проверить контракт на предмет противоречий другим контрактам и всем требованиям действующего законодательства*

Когда все условия учтены и стороны подписали контракт, остается ряд других проблем, которые могут возникнуть позже в зависимости от ситуации.

> **Сложности понимания и верификации контракта**
>> * *Язык контракта чаще всего непонятен людям без юридического образования* 
>> * *Возможны разногласия между юристами по поводу значения некоторых слов* 
>> * *Возможно подменить неподписанные страниці контракта* 
>> * *Подпись может быть подделана*

Сложно вообразить масштаб временных и материальных потерь, которые несут участники юридических отношений вследствие неправильно составленных или недоработанных контрактов. А если учесть количество поддельных документов, то это будет напоминать нечто среднее между экономическим и социальным бедствием.

Отметим, что основная часть вышеуказанных потерь приходится на этап исполнения и судебных разбирательств. Если проанализировать этап исполнения, обнаружим немало проблем.

> **Сложности при исполнении контракта**
>> * *Исполнение даже правильно составленного контракта может зависеть от умственных способностей юристов участвующих сторон*
>> * *Длительность судебных процессов и затраты на них* 
>> * *Возможность подкупа суда* 
>> * *Гарантировать возмещение ущерба сложно, если вторая сторона обанкротится*

Решение для будущего появилось. Контракт может быть написан на таком языке, который понятен и человеку, и машине. 

> **Особенности контракта, который задан программным кодом**
>> * *Универсальный язык написания однозначно распознается компьютером* 
>> * *При одинаковых входных данных программный код дает один и тот же результат (рис. 6.17)*
>> * *Контракт подписан цифровой подписью, которую легко проверить и сложно подделать* 
>> * *Человеческий фактор исключается на этапах понимания и выполнения* 
>> * *Такой контракт возможно протестировать*

![Рисунок 6.17 – Результат выполнения смарт-контракта одинаковый для всех устройств](/resources/img/volume-1/6.3-introduction-to-smart-contracts/6.17-result-of-execution.png)

### Что такое смарт-контракт?

*Смарт-контракт (smart contract)* – это соглашение о перераспределении ценностей между контрагентами, которое подразумевает строгое и однозначное задание условий, автоматизацию процессов выполнения и минимизацию вовлечения доверенных сторон. Чаще всего это достигается с помощью объединения механизмов задания условий и механизмов строгого их выполнения, для чего обычно применяют компьютерные протоколы, описывающие порядок создания, обработки и реализации смарт-контрактов. Система под управлением такого протокола называется платформой смарт-контрактов, где контракты помещаются в специальные транзакции (или запросы), которые должны быть подписаны всеми вовлеченными в сделку сторонами. После того, как такая транзакция была передана на платформу смарт-контрактов, изменить условия контракта, нарушить или отменить их выполнение уже невозможно. Такую идею, как и сам термин смарт-контракт, предложил исследователь Nick Szabo в 1994 году, а соответствующий документ [62] был опубликован в 1997 году (рис. 6.18).

![Рисунок 6.18 – Идея смарт-контрактов Nick Szabo](/resources/img/volume-1/6.3-introduction-to-smart-contracts/6.18-nick-szabo.png)

> **Что нужно знать о смарт-контрактах?**
>> * *Позволяют контрагентам взаимодействовать без привлечения третьих сторон* 
>> * *Проводить аудит смарт-контрактов проще, чем в случае с системой традиционных контрактов* 
>> * *Существуют разные способы и протоколы реализации смарт-контрактов* 
>> * *Позволяют управлять цифровыми активами, которые учитываются на платформе* 
>> * *Инициация созданного контракта выполняется либо вручную, либо автоматически*

Выполнение смарт-контрактов подразумевает, что на платформе присутствует один валидатор (либо целая сеть валидаторов) и база данных, которая хранит все смарт-контракты, поступившие на выполнение в строгой хронологической последовательности. Важно, что эта база должна содержать все данные, которые будут использовать условия-триггеры при выполнении смарт-контракта. Она также должна учитывать ту же ценность, распределение которой описано в контракте: если это касается некоторой цифровой валюты, то эта база данных должна учитывать эту цифровую валюту.

Другими словами, валидаторы смарт-контрактов должны иметь доступ ко *всем* данным, которыми оперирует смарт-контракт. Например, одна база данных должна использоваться для учета одновременно цифровых валют, балансов пользователей, транзакций пользователей и временных меток. Тогда в смарт-контракте условием может быть баланс пользователя в определенной валюте, наступление некоторого времени или факт осуществления какой-либо транзакции, но не более того.

Смарт-контракты подразумевают автоматизацию распределения ценности, которая может зависеть только от тех условий, которые заранее установлены. В самом простом варианте это программируемый контракт со строго заданными условиями, который обычно заверяется всеми вовлеченными в сделку сторонами с помощью цифровой подписи (рис. 6.19).

![Рисунок 6.19 – Заверение смарт-контракта вовлеченными сторонами](/resources/img/volume-1/6.3-introduction-to-smart-contracts/6.19-validation-od-a-smart-contract.png)

Смарт-контракты призваны минимизировать доверие к третьим сторонам. Иногда даже полностью исключается центр принятия решений, от которого все зависит. По сравнению с бумажными контрактами касательно смарт-контрактов проводить аудит гораздо проще. Это является следствием некоторых особенностей проектирования такой системы. Если платформа смарт-контрактов децентрализованная и база данных общедоступная, то любой желающий может проанализировать историю транзакций и провести полный аудит выполнения контрактов. Таким образом достигается защита от изменения данных задним числом, которые могли бы повлечь изменения в выполнении одного или нескольких контрактов. В итоге, затраты на поддержание инфраструктуры смарт-контрактов ниже по сравнению с затратами на поддержание инфраструктуры бумажных контрактов.

### Роль оракулов для смарт-контрактов

Очень важно, с какими входными данными работает смарт-контракт. Если данные изначально создавались, хранились и обрабатывались в пределах одной учетной системы, то смарт-контракт, который выполняется в этой же учетной системе, может работать с этими данными без посредников. В этом случае *оракулы* не требуются. Однако работа только с внутренними данными существенно ограничивает возможности практического применения смарт-контрактов.

В ряде случаев контракту нужны внешние данные (факт случившегося события, достижение некоторой отметки температуры воздуха и т. д.), которые должны быть доставлены в базу данных учетной системы и подтверждены доверенными сторонами. Собственно, оракулы и являются поставщиками данных о внешнем мире.

Оракулы транслируют данные из внешней среды в децентрализованную учетную систему. Чаще всего оракул имеет identity и требует некоторого доверия пользователей к данным, которые он предоставляет. Все данные, которые передает оракул, должны быть подписаны цифровой подписью, чтобы обеспечить целостность данных и неотказуемость (каждый пользователь системы может проверить, что конкретные данные передал конкретный оракул).

Можно минимизировать необходимость доверия пользователей путем увеличения количества оракулов (допустим, с целью предотвращения коррупции). Тогда смарт-контракт будет получать сведения от множества независимых оракулов и согласовывать их, после чего принимать некоторое решение (рис. 6.20).

![Рисунок 6.20 – Смарт-контракт получает данные от независимых оракулов](/resources/img/volume-1/6.3-introduction-to-smart-contracts/6.20-smart-contracts-and-oracles.png)

### Пример с покупкой в онлайн-магазине

Давайте рассмотрим очень простой пример. Он поможет приблизиться к пониманию функциональных возможностей смарт-контрактов, а также лучше ориентироваться, в каких случаях их стоит применять. Его можно реализовать также с использованием Биткоина, хотя сейчас Биткоин еще сложно назвать полноценной платформой для смарт-контрактов.

Итак, у нас есть некоторый покупатель и интернет-магазин. Покупатель хочет приобрести в этом магазине монитор (рис. 6.21). В наиболее простом случае покупатель оформляет и отправляет платеж, а интернет-магазин принимает его, подтверждает, после чего отправляет товар. Однако в этой ситуации присутствует необходимость большого доверия: покупатель вынужден на всю стоимость монитора доверять интернет-магазину. Предположим, интернет-магазин может иметь низкую репутацию, и для покупателя существует риск, что по каким-то причинам после приема платежа магазин откажет в обслуживании и не отправит товар. Поэтому покупатель задается вопросом (как и интернет-магазин), что можно в этом случае применить, чтобы минимизировать такие риски и сделать подобные сделки более надежными.

![Рисунок 6.21 – Использование смарт-контракта для покупки товара в интернет-магазине](/resources/img/volume-1/6.3-introduction-to-smart-contracts/6.21-smart-contract-for-buying-good.png)

В случае Биткоина можно предоставить возможность покупателю и продавцу независимо друг от друга выбрать *медиатора*. Есть множество людей, которые занимаются решением спорных вопросов. И наши участники могут выбрать из общего списка медиаторов того, которому одновременно будут доверять. Вместе они создают MultiSig-адрес 2-из-3, где есть три ключа и необходимы две подписи любыми двумя ключами, чтобы потратить монеты с этого адреса. Один ключ будет принадлежать покупателю, второй – интернет-магазину и третий – медиатору. И на такой MultiSig-адрес покупатель отправит сумму, необходимую для оплаты монитора. Теперь, когда продавец убедился, что монеты на некоторое время заблокированы на таком MultiSig-адресе, который зависит от него, он смело может отправлять монитор по почте.

Дальше покупатель получает посылку, осматривает товар и принимает решение об окончательной покупке. Он может быть полностью согласен с предоставленным обслуживанием и подписать транзакцию своим ключом, где он передает монеты с MultiSig-адреса продавцу, а может быть чем-то недоволен. Во втором случае он связывается с медиатором для составления какой-то альтернативной транзакции, которая по-другому будет распределять эти монеты.

Допустим, монитор приехал немного поцарапанный и в комплекте не лежал кабель для подключения к компьютеру, хотя на сайте интернет-магазина было написано, что кабель должен входить в комплект. Тогда покупатель собирает доказательства, необходимые для того, чтобы доказать медиатору, что его обманули: он делает скриншоты сайта, фотографии чека, выданного службой доставки, делает фотографии царапин на мониторе и сорванной пломбы (что указывает, что кабель забрали). Интернет-магазин, в свою очередь, собирает свои доказательства и передает их медиатору.

Медиатор заинтересован в том, чтобы удовлетворить одновременно интересы и покупателя, и интернет-магазина (дальше будет понятно, почему). Он составляет такую транзакцию, в которой монеты с MultiSig-адреса будут тратиться в некоторой пропорции между покупателем, интернет-магазином и медиатором (поскольку он берет себе часть в качестве вознаграждения за свою работу). Допустим, 90% всей суммы пойдет продавцу, 5% – медиатору, а оставшиеся 5% – покупателю в качестве компенсации. Эту транзакцию медиатор подписывает своим ключом, но она еще не может быть применена, потому что необходимо две подписи, а стоит только одна. Такую транзакцию он отправляет и покупателю, и продавцу. Если хотя бы один из них будет удовлетворен таким вариантом перераспределения монет, то транзакция будет доподписана и распространена по сети. Для ее валидации достаточно, чтобы один из участников сделки согласился с вариантом медиатора.

Важно изначально выбрать медиатора так, чтобы оба участника доверяли ему. В таком случае он будет действовать независимо от интересов одного либо другого и объективно оценит ситуацию. Если же медиатор не предоставляет такой вариант распределения монет, который удовлетворит хотя бы одного участника, тогда, договорившись между собой, и покупатель, и интернет-магазин могут перенаправить монеты на новый MultiSig-адрес, поставив свои две подписи. Новый MultiSig-адрес будет составлен уже с другим медиатором, который, возможно, будет более компетентен в вопросе и предоставит лучший вариант решения конфликта. В этом примере есть две ключевые особенности:

* Медиатор не может украсть деньги пользователей. 
* Возможно заменить медиатора в процессе разрешения спора по соглашению обеих сторон.

### Пример контракта для совместной покупки

Давайте рассмотрим более сложный пример, который отображает возможности смарт-контракта более явно. Допустим, есть трое студентов, которые недавно заселились в одну комнату в общежитии. Они втроем заинтересованы в том, чтобы купить в свою комнату холодильник, которым они будут совместно пользоваться. Один из них вызвался собрать необходимую сумму для покупки холодильника и вести переговоры с продавцом. Однако они относительно недавно познакомились друг с другом и достаточного доверия между ними нет. Очевидно, что двое из них рискуют, отдавая деньги третьему. При этом им нужно достичь согласия в выборе продавца.

Ребята могут воспользоваться escrow service, то есть выбрать медиатора, который проконтролирует выполнение сделки и уладит спорные вопросы, если такие возникнут. Тогда, договорившись, они составляют смарт-контракт и прописывают в нем определенные условия (рис. 6.22), где одно из условий заключается в том, что до наступления определенного времени (допустим, спустя одну неделю) на соответствующий аккаунт смарт-контракта должны поступить три платежа с определенных адресов на определенную сумму. Если этого не происходит, смарт-контракт возвращает монеты всем участникам и прекращает свое выполнение. Если же условие выполняется, задаются идентификаторы продавца и медиатора и происходит проверка условия, все ли участники согласны с выбором продавца и медиатора. Когда все условия будут выполнены, средства будут переведены на указанные адреса.

![Рисунок 6.22 – Использование смарт-контракта для совместной покупки](/resources/img/volume-1/6.3-introduction-to-smart-contracts/6.22-mutual-purchase.png)

Подобный подход может обезопасить участников от мошенничества с любой стороны и вообще исключает необходимость доверять. Мы видим на этом примере сам принцип: возможность пошагово задавать параметры для выполнения каждого условия позволяет создавать контракты любой сложности и глубины вложенных уровней. Кроме того, сначала в смарт-контракте можно определить первое условие и только после его выполнения задавать параметры для следующего условия, то есть формально условие прописывается, а параметры для него могут задаваться уже во время его работы.

> **Другие сложности**
>> * *Ошибка в коде контракта может привести к печальным последствиям* 
>> * *Данные для всех триггеров должны быть в базе платформы контрактов* 
>> * *Активы нужно оцифровывать и учитывать на платформе контрактов* 
>> * *В ряде случаев практически невозможно обеспечить свойство trustlessness*

### Классификация платформ смарт-контрактов

Для классификации можно задавать разные группы критериев. Однако на данный момент развития технологий актуальными являются четыре из них:

* Среда выполнения 
* Способ исполнения 
* Метод инициации 
* Уровень приватности

По уровню приватности смарт-контракты могут быть либо полностью открытыми, либо частично конфиденциальными, либо полностью конфиденциальными (сторонние наблюдатели не могут видеть условия смарт-контрактов). Однако тема приватности очень обширная, и ее лучше рассмотреть отдельно.

### Отличия платформ по среде выполнения

По среде выполнения различают централизованные и децентрализованные платформы смарт-контрактов. В случае централизованных цифровых контрактов используется один сервис, где существует только один валидатор, а также может быть служба резервного копирования и восстановления, которая также управляется централизованно. Есть одна база данных, которая хранит всю необходимую информацию для задания условий смарт-контракта и распределения ценности (оцифрованное право собственности на актив). У централизованного сервиса есть клиент. И поскольку платформа централизованная, механизмы аутентификации могут быть более примитивными, чем в Bitcoin (рис. 6.23).

![Рисунок 6.23 – Централизованная платформа смарт-контрактов](/resources/img/volume-1/6.3-introduction-to-smart-contracts/6.23-centralized-smart-contract.png)

В качестве примера можно привести провайдеров мобильной связи, то есть разных мобильных операторов. Допустим, некоторый оператор централизованным образом ведет на своих серверах учет трафика, который может передаваться в различной форме (например в виде голосовых звонков, SMS, трафика мобильного Интернета), и средств на балансах пользователей. Соответственно, провайдер мобильной связи может составлять контракты по учету предоставляемых услуг и их оплате с разными условиями. Тогда легко задавать условия вроде «отправь SMS с таким-то кодом на такой-то номер – и получишь такие-то условия распределения трафика».

Можно привести еще один пример: традиционные банки с расширенной функциональностью интернет-банкинга и очень простые контракты, такие как регулярные платежи, автоматическая конвертация входящих платежей, автоматическое отчисление процента на указанный счет и т. п.

Если среда выполнения смарт-контракта децентрализованная, то имеется группа валидаторов, которые обрабатывают контракты, хранимые в неизменном виде (рис. 6.24). В идеальном случае валидатором может стать вообще кто угодно.

![Рисунок 6.24 – Децентрализованная платформа смарт-контрактов](/resources/img/volume-1/6.3-introduction-to-smart-contracts/6.24-decentralized-smart-contract.png)

Здесь транзакции будут содержать инструкции по выполнению контракта в соответствии со строгой спецификацией. Эта спецификация открыта, поэтому сами пользователи платформы могут проводить аудит и валидировать смарт-контракты. Здесь мы видим, что децентрализованные платформы превосходят централизованные по *независимости* и *отказоустойчивости*, но их проектирование и обслуживание при этом гораздо сложнее.

### Отличия платформ по способу исполнения контрактов

Теперь разберем, как смарт-контракты могут отличаться по способу задания и выполнения условий.

*Полный по Тьюрингу* смарт-контракт позволяет задавать почти любые алгоритмы в качестве условий выполнения контракта: от написания функций, использующих циклы, и функций расчета вероятностей до собственных алгоритмов цифровой подписи и даже написания собственных смарт-контрактов. Здесь речь идет о действительно произвольном написании логики. Преимущество такого подхода заключается в большей гибкости при программировании смарт-контракта. Недостатком является невозможность гарантировать безопасность платформы, поскольку существуют ситуации, при которых выполнение смарт-контракта, написанного на полном по Тьюрингу языке программирования, может быть непредсказуемым. К произвольным полным по Тьюрингу контрактам относят платформу Ethereum [115] и RootStock.

*Неполные по Тьюрингу* языки программирования смарт-контрактов (такие, как скрипты в Bitcoin и Litecoin) позволяют в произвольном порядке использовать только определенные операции. Однако использовать циклы и реализовывать собственные алгоритмы уже нельзя. При помощи такого подхода возможно создать более безопасную среду для выполнения контракта.

*Предопределенные (шаблонные)* смарт-контракты поддерживают ограниченный список шаблонов (обычно несколько десятков наиболее популярных контрактов, которые реализованы заранее). Это позволяет обеспечить больший контроль над безопасностью в отличие от предыдущих способов. К платформам, которые используют такой подход, можно отнести Stellar, BitShares и Steemit. BitShares имеет целый ряд смарт-контрактов для торговли, управления аккаунтами, управления самой платформой и ее параметрами. Steemit – похожая платформа, но она ориентирована не на выпуск токенов и торговлю, как BitShares, а на ведение блогов, т. е. она хранит и обрабатывает контент децентрализованным образом.

### Отличия платформ по способу инициации контрактов

По способу инициации смарт-контракты тоже можно разделить минимум на две группы: *автоматизированные* и *ручные (неавтоматизированные)*. Для автоматизированных характерно, что при всех известных параметрах и наступивших условиях, смарт-контракт полностью выполняется автоматически, то есть не требует отправки каких-то дополнительных транзакций и траты дополнительной комиссии при каждом следующем выполнении. Сама платформа имеет все данные, чтобы рассчитать, как именно смарт-контракт завершится. Логика в этом случае не произвольная, а заранее заданная, поэтому результат предсказуем. Это позволяет заблаговременно оценить сложность выполнения смарт-контракта и, например, рассчитать комиссию для его выполнения.

Чаще всего для смарт-контрактов, которые написаны на полном по Тьюрингу языке, инициация исполнения не автоматизирована. Для инициирования каждого этапа такого смарт-контракта нужно создавать новую транзакцию, которая будет активировать следующий шаг контракта и платить соответствующую комиссию. Кроме того, нужно ожидать подтверждения этих транзакций и фиксации промежуточных результатов. Выполнение каждого шага может завершиться успешно или нет, потому что код смарт-контракта произвольный и могут появится непредсказуемые ситуации, такие как бесконечный цикл, отсутствие входных данных, непредусмотренные значения аргументов и т. п.

### Итоги

Внедрение смарт-контрактов связано с большими ожиданиями со стороны бизнеса. Но стоит помнить, что смарт-контракт сам по себе – это кусок кода. Результатом выполнения этого кода должно стать согласие всех участников системы относительно балансов аккаунтов (взаиморасчетов). Отсюда можно сделать несколько выводов:

* Смарт-контракт становится «смарт», только когда его выполняют все заинтересованные участники одновременно и когда большинство из них соглашается с результатами выполнения смарт-контракта.
* Результат выполнения смарт-контракта – изменения в реестре, содержащем оцифрованные активы.

Таким образом, смарт-контракт может управлять только активами, которые уже оцифрованы, а реестр, в котором ведется учет этих активов, должен быть главным источником информации о правах собственности на эти активы. Если эти требования не выполняются, то использование смарт-контрактов имеет крайне мало смысла.

Использование смарт-контрактов в централизованной системе может иметь смысл, однако свойства *transparency*, *auditability* и *trustlessness*, скорее всего, не будут обеспечиваться.

Создание условий для функционирования смарт-контракта – необходимый шаг в направлении автоматизации бизнес-процессов. Тем не менее, следует подчеркнуть понятие *социальный консенсус*. Оно может повлиять на ожидаемые результаты смарт-контракта вплоть до изменения состояния базы данных. Такие ситуации могут возникать даже в permissionless учетных системах. Яркий пример социального консенсуса – принятие обновления типа hardfork в Ethereum, когда значительная часть сообщества была против (подробнее в 6.1).

**Распространенные мифы**

*Смарт-контракты должны функционировать в автономном режиме.*

Ошибочно полагать, что смарт-контракты умеют анализировать окружение и действовать согласно внесенным изменениям. Их код запускается в случае поступления платежа или сообщения о некотором выполненном условии. Его активируют посредством внешнего аккаунта компании или через другие механизмы инициации выполнения. Таким образом, не все платформы реализуют полностью автономное выполнение смарт-контрактов.

*Смарт-контракты можно изменить при обнаружении ошибки так же, как и обычный контракт.*

Если при заключении традиционных договоров возникает ситуация, когда что-то нужно исправить, к договору пишут приложения. Но в децентрализованной среде нет «администратора», который мог бы внести исправления в контракт, и нет центра, который мог бы остановить запущенную программу. Единственное решение при обнаружении ошибки – создание «корректирующего» смарт-контракта, если все участники сделки с этим согласны.

На момент написания книги за время существования смарт-контрактов был зафиксирован только один случай, когда потребовалось ручное регулирование. В июне 2016 года злоумышленники взломали систему компании The DAO и начали выводить токены на свои кошельки, что вызвало не только обрушение DAO, но и снижение курсов ether и даже bitcoin. Такую возможность для атаки дала ошибка при написании смарт-контракта. При исправлении ситуации смарт-контракты не переписывались, поскольку это невозможно. Решением стало проведение hardfork, в результате которого появился Ethereum Classic.

**Часто задаваемые вопросы**

*– Разве смарт-контракты исключают доверие из взаимоотношений между людьми? Ведь здесь есть оракулы – это ли не третья сторона?*

Принципиальная разница состоит в возможности выбора. В случае с обычным магазином, покупатель должен доверять администрации этого магазина. Он может только поверить, что товар на витринах качественный, маркировки не подделаны и т. д. Администрация может заставить сотрудников давать ложные данные покупателям, чтобы поскорее избавиться от залежавшейся продукции. А в случае со смарт-контрактом можно выбрать доверенных лиц, которые могут даже не знать друг друга, поэтому договориться им будет сложно. Решение о наступлении определенных условий будет приниматься путем голосования. Убедиться, что голосование и подсчет результатов происходят в соответствии с правилами протокола, позволит автоматизированный аудит.

*– Возможно ли в смарт-контракте использовать таймер, чтобы платформа могла знать, когда совершить платеж?*

Нет, таймеры в смарт-контрактах не используются. Вместо этого можно запрограммировать проверку текущего времени на превышение некоторого константного значения перед выполнением определенной операции или платежа. А заинтересованная сторона может иметь возможность инициировать выполнение этой проверки.

## 6.4 Введение в токенизацию активов

Когда где-либо употребляется слово blockchain или токенизация, многие люди склонны думать о криптовалюте и продаже токенов, о темах, которые не покидали заголовки прессы в 2017 году. Токенизация преимущественно рассматривалась просто как процесс выпуска и продажи utility токенов (см. ниже), которые слепо копировали основную идею Bitcoin как децентрализованной валюты. Это применялось к платежам между пользователями определенного бизнес-приложения. Именно таким образом мир стал свидетелем возникновения токенов для продажи марихуаны, токенов на использование автомойки, для обмена активами на бирже, для IoT, браузеров, социальных сетей, хранилищ данных, телефонов, средств инвестирования и многих других целей (странных и не очень). Идея, которую старались передать стартапы, создававшие такие проекты, касалась демократизации инвестиций, прозрачности операций и возможности использования смарт-контрактов между людьми и машинами. На самом деле большинство из этих идей оказались провальными по разным причинам (таким как отсутствие компетентности, устойчивой бизнес-модели, иногда даже по причине жадности или попытки мошенничества). Однако это только одна сторона всей истории.

Идея оцифровки всех активов и использования приложений с  программируемой логикой управления активами уже давно обратила на себя внимание и обретает все большую популярность. Один, максимум два раза в десятилетие происходят значимые инновации, которые сотрясают всю инфраструктуру управления данными. Появление первой криптовалюты стало примером, как финансовая система может надежно функционировать в абсолютно «враждебной среде»: полностью анонимной, permissionless, распределенной и без каких-либо администраторов безопасности, межсетевых экранов и физической защиты периметра. Множество идей могут быть заимствованы из такого сценария и применены в гораздо более дружественных к пользователю (с точки зрения условий для работы) системах управления активами предприятия.

Изначально слово *токен* использовалось, когда люди говорили о выпуске проектами собственных монет. Позже этот термин приобрел более точное значение в контексте цифровых активов. *Токен* – это возможность доказать право собственности на некоторый актив. Он выпускается и передается в пределах учетной системы, которая может находиться под управлением как одной компании, так и группы независимых валидаторов. Одна из главных задач *токенизации* заключается в том, чтобы сделать такую учетную систему главным источником информации о правах собственности. В финансовом мире люди часто используют понятие *security token*, когда подразумевают ценную бумагу в качестве базового актива (регулируемый торгуемый финансовый инструмент), но на самом деле это только частный случай.

*Токенизация – это процесс трансформации учетной системы, который состоит в том, что все балансы находятся под управлением пользователей через криптографические ключи и право собственности на актив представляется в виде цифрового токена.*

Цель *токенизации* состоит в ускорении и повышении безопасности работы с активами [97].

Если задуматься, с токенами мы знакомы достаточно давно. Ваучер на одну стрижку в парикмахерской также можно считать токеном. Еще один пример – жетон в метрополитене. Даже доллар США до момента, когда отменили золотой стандарт, тоже был токеном, который подразумевал право на определенное количество золота.

Термин *токен* может употребляться в контексте аутентификации: так называют некоторые идентификаторы или секреты, которые используются для электронной аутентификации. Токен может быть представлен в виде строки или в виде физического устройства для подтверждения доступа к определенным системам, информационным ресурсам и т. д. Далее постараемся дать наиболее четкое и компромиссное определение токена как цифрового актива.

*Токен* (как цифровой актив) – *это единица учета, которая используется для представления цифрового баланса в некотором активе*. Владение токеном доказывается с помощью криптографических механизмов, например цифровой подписи [98].

Токены и токенизация могут быть рассмотрены на четырех концептуально разных уровнях, поскольку обычные пользователи, бизнесмены, разработчики и исследователи воспринимают ситуацию по-разному.

*Уровень пользователя*. Владельцу токена предоставляется юридическое право собственности на соответствующий актив. Он также может быстро и надежно передать это право другим пользователям, не перемещая при этом сам актив. Предполагается, что владельцы токенов признают законность и уникальность конкретного реестра, в котором ведется учет токенов. Также они должны доверять хранителю физических активов (в случае, если токен обеспечен физическим активом).

*Уровень бизнес-процессов*. Прежде всего токенизация предполагает наличие реестра прав собственности на основе технологии blockchain. Передача токена из рук в руки значит изменение владельца актива с внесением соответствующей записи в реестр, который считается основным источником информации для всех пользователей системы.

*Уровень IT-инфраструктуры*. В этом случае токен можно рассматривать как механизм внесения изменений в реестр прав собственности, который хранит конечное состояние балансов пользователей. В то же время с токеном связаны функции резервного копирования данных, управления ролями и инфраструктурой в целом, проверки целостности истории транзакций и осуществления автоматического аудита в режиме реального времени.

*Уровень технологии*. Токен – это запись в структуре аккаунта, чьи все поля защищены при помощи криптографических механизмов, таких как цифровая подпись, хэширование, доказательств с нулевым разглашением и т. д. Каждый аккаунт поддерживает операции, связанные с обновлением его состояния, определяет набор возможных транзакций, этапы их жизненного цикла, правила обработки и т. д.

### Проблемы существующих учетных систем

Оцифровка учетных систем является относительно новой тенденцией, появившейся в 1970-х годах. Интернет-атаки, очевидно, не являлись в те дни проблемой, поэтому о них не было острой необходимости задумываться. Это можно считать одной из причин, почему механизмы безопасности не были реализованы в оригинальной архитектуре. Процессы коммуникации в учетных системах не оцифровывались до 1990-х годов, а регулирование (отчетность, AML, KYC) было введено еще позже.

С архитектурной точки зрения доверие к стороне, с которой проходит взаимодействие, не считалось проблемой, поскольку менталитет делового поведения всецело основывался на доверии, поддерживаемом законодательством и правоохранительными органами. Другой распространенной практикой, которая рассматривалась в качестве хорошего метода обеспечения безопасности, являлась закрытость программного обеспечения.

В результате, в большинстве случаев учет продолжал осуществляться в бумажном виде, поскольку большинство учетных систем (которые унаследовали устаревшие механизмы) не были готовы к цифровому веку. Собрав воедино проблемы существующих учетных систем, получим следующий перечень:

* Отсутствие прозрачности в учетных процессах, в частности в истории изменений
* Низкий уровень интеграции с другими платформами
* Необходимость доверять управление системой третьей стороне
* Высокая сложность аудита
* Уязвимость к непреднамеренным и несанкционированным изменениям

Вышеперечисленные проблемы возникают по следующим причинам:

* Техническая несовместимость форматов данных
* Отсутствие открытого и защищенного API
* Отсутствие строгой упорядоченности транзакций, а также возможности проверить их целостность
* Отсутствие методов защищенной синхронизации данных между заинтересованными сторонами

Все вышеперечисленные факторы приводят к неэффективной работе, необходимости ручного обслуживания и дополнительным расходам на аудит и страхование. 

### Что такое платформа токенизации?

*Платформа токенизации – это совокупность компонентов, которые позволяют осуществлять учет и операции с некоторым активом посредством использования цифрового токена, а также обеспечить безопасность его хранения, обработки и управления*.

Компоненты платформы токенизации следующие:

* Реестр
* Внутренняя платежная система
* Внутренняя биржа
* Модуль управления аккаунтами
* Шлюзы и интеграционные модули
* Кошельки
* Модуль управления жизненным циклом актива

Чтобы снизить риск мошенничества и сговора, разные (иногда независимые) субъекты должны выполнять различные типы действий. Следовательно, существует набор ролей, которые должны поддерживаться платформой токенизации. Самыми важными из них являются валидатор, аудитор, хранитель, эмитент и администратор.

*Валидатор* поддерживает нормальное функционирование системы в соответствии с протоколом учета токенов. Роль валидатора может выполнять как отдельный человек, так и целая организация.

*Аудитор* – это назначенная сторона, которая имеет право проверять транзакции и именно он нажимает на «тревожную кнопку», если замечает что-то подозрительное. Аудитор хранит полную копию реестра транзакций и проверяет законность действий, происходящих на платформе.

*Хранитель (custodian)* – это лицо, ответственное за предоставление внешних активов, которые токенизированы на платформе (если они есть). Эта роль является очень важной, поскольку IT-платформа самостоятельно не может предотвратить кражу.

*Эмитент* – это сторона, которая осуществляет эмиссию на основании данных, поступивших от хранителя (в некоторых случаях роли эмитента и хранителя могут выполняться одной стороной). Токены могут выпускаться либо централизованным (сумму, которую необходимо выдать, назначает ответственная сторона), либо децентрализованным (несколько валидаторов достигают консенсуса относительно количества выпускаемых токенов) образом.

*Администратор* принимает решение по обновлению и настройке платформы, а также по настройке бизнес-правил.

> **Базовые принципы токенизации**
>> * *Прямое управление активом для его владельца* 
>> * *Надежный автоматизированный аудит всей истории транзакций* 
>> * *Распределение ответственности за управление процессами на платформе по ролям* 
>> * *Повышение отказоустойчивости инструментов хранения, передачи и обмена активов* 
>> * *Открытость спецификации учетной системы и цифровых кошельков* 
>> * *Отделение процессов хранения актива от процессов управления активами*

### Принципы функционирования платформы токенизации

Перечислим роли и процессы, которые присутствуют на платформе токенизации:

* Управление системой (governance) – выполняется тем, кого назначил создатель или владелец системы
* Хранение активов – выполняется хранителем (custodian)
* Эмиссия – выполняется эмитентом (эмитируемые токены обеспечиваются хранителем на платформе токенизации)
* Валидация транзакций – выполняется валидаторами
* Аудит – выполняется аудитором

Рассмотрим простой случай токенизации какого-либо физического товара, например расписок на зерно. Очевидно, что управление системой осуществляет сам элеватор, он же выполняет хранение зерна. Эмитентом может являться иная сертифицированная организация (она будет производить изначальную оценку качества зерна и подтверждать, что на складе оно действительно присутствует). Валидацию транзакций может осуществлять как сам элеватор, так и группа субъектов, ответственных за корректность транзакций (эта группа может включать в себя элеватор, эмитента, сторонние организации и т. д.). Аудит корректности транзакций может выполняться как пользователями системы, так и специально назначенными организациями, которым доверяют пользователи.

Существенная разница для пользователей состоит в том, что теперь они могут хранить подписанные версии всех транзакций на своих устройствах и в случае разногласий доказать в суде, что их текущий баланс был результатом выполнения корректных транзакций.

Если провести аналогию с permissionless учетной системой (например с Bitcoin), то окажется, что все процессы в ней децентрализованы. Физического обеспечения не существует, поэтому роль хранителя не актуальна, а эмиссия выполняется на основании предварительно заданной формулы. Валидатором может стать кто угодно, и учетная система общедоступна. Все процессы в ней прозрачны, и кто угодно может проверить целостность данных или провести аудит. Доверие пользователей к валидаторам здесь почти не требуется. Такая система наиболее устойчива к цензуре.

Отметим, что и permissioned, и permissionless системы кардинально отличаются с точки зрения области применения, но при этом решают возложенные на них задачи по обеспечению безопасности транзакций и прозрачного аудита.

### Возможности, которые предоставляет токенизация

За счет технических особенностей новой инфраструктуры появляется ряд новых возможностей.

> * *Создание глобальных децентрализованных реестров собственности* 
> * *Создание плотно интегрированных систем, которые обладают высокой модульностью и распределением ответственности за работу каждого конкретного модуля* 
> * *Простой аудит системы учета в режиме реального времени* 
> * *Перемещение активов и торговля ими в Интернете без границ (возможность создания Финансового Интернета)*

### Прозрачность процессов учетной системы

С помощью платформы токенизации можно построить прозрачные бизнес-процессы. Как показывает практика, более эффективным является предупреждение нечестного поведения, чем борьба с ним. Платформа токенизации может работать по строгим правилам, целью которых является предотвращение возможностей для злонамеренных действий. В пределах такой учетной системы партнеры по бизнесу всегда могут проверить действия друг друга.

Чем больше независимых валидаторов в учетной системе, тем устойчивее она к отказам в работе. Поскольку локальные копии синхронизируются между собой в режиме реального времени и автоматически создаются резервные копии, токенизация повышает надежность системы.

### Как токенизация приводит к увеличению стоимость активов?

Токенизация позволяет увеличить доверие к данным учетной системы за счет использования цифровой подписи и достижения консенсуса между ее валидаторами. Это косвенно влияет на стоимость токенизированных активов по сравнению с теми, учет которых ведется традиционным путем.

Лучше понять, как токенизация может повлиять на ценность активов, а следовательно, и на стоимость, поможет простой пример. Представьте, что вы приходите в аптеку покупать лекарство. Перед вами кладут прозрачный коробок без опознавательных знаков с белыми таблетками внутри. Вы станете принимать эти таблетки? Конечно же нет. На них же ничего не написано. А что, если бы за прилавком аптеки стоял ваш друг-провизор, который сказал бы, что эти таблетки вам действительно помогут? Скорее всего, у вас все равно остались бы сомнения, причем даже если бы вы ее приняли. Ведь все равно непонятно, откуда они взялись и кто их производил.

А если это будут таблетки в заводской упаковке с прилагающейся инструкцией, где указано, что лекарство сертифицировано одним из ведущих производителей лекарственных средств? При этом известно, что эффективность действующего вещества доказана многократно в ходе клинических исследований. Очевидно, что такие таблетки вызывают большее доверие, чем в предыдущих случаях. Если же у вас и рецепт врача на это лекарство имеется, то сомнений почти не останется.

Казалось бы, куда надежнее? Но давайте поразмыслим слегка футуристично и представим, что вы можете достоверно проверить таблетку на совместимость содержащихся в ней веществ с биохимическими процессами, которые происходят в вашем организме.

Например, Всемирная организация здравоохранения позаботилась о том, чтобы в каждой аптеке стоял аппарат, который по желанию покупателя берет маленькую каплю его крови (или любой другой материал для анализа) и крошечную частицу образца лекарства из купленной упаковки, после чего анализирует текущее состояние здоровья покупателя и качество лекарственного вещества. Оценив данные, аппарат выводит результат о пользе лекарства в данном случае.

Как думаете, стало бы такое лекарство более ценным для вас? Безусловно.

Как видим, ценность лекарства повышается по мере роста объема полезной информации о нем. Заметьте, что свойства самой таблетки при этом не изменяются. Это является результатом возможности доверия (и независимой проверки) ко всем предыдущим операциям с активом, истории его происхождения (provenance), надежной аутентификации источников данных.

### Условия эффективного применения платформ токенизации

Для эффективного функционирования платформы токенизации необходимо присутствие следующих основных компонентов:

* Реализация digital identity, которое позволит связывать действия участника в системе с его личностью
* Эффективные методы децентрализованного принятия решений
* Налаженная схема хранения и управления ключами

Этот список неполон. Также необходимо выполнение ряда условий, прежде чем системы токенизации активов смогут полноценно работать. Они совпадают с необходимыми условиями применения blockchain, о которых мы писали в 5.3.

### Риски

Как мы упоминали ранее, токенизация предполагает, что оцифрованные реестры прав собственности являются основным источником информации о владельцах активов. Поэтому с юридической точки зрения смена владельца токена должна означать смену собственника актива.

Таким образом, некоторые из основных рисков связаны именно с обеспечением токенов. Например, в то время как на балансах пользователей в системе учета все корректно, реальные активы могут быть подменены, уничтожены или похищены. Эта проблема больше связана со свойствами материального актива, чем с работой платформы токенизации: оцифровка позволяет добиться многих преимуществ, но не гарантирует целостность своего обеспечения. Следует также помнить, что личные ключи пользователей могут быть утеряны или украдены, что приводит к необратимой потере права на владение активом. Этот риск тяжело оценить и от него тяжело защититься.

### Отличие токенизации от оцифровки

Простой оцифровки документов, счетов и прав собственности недостаточно, чтобы получилась самодостаточная автоматизированная учетная система, которую можно использовать полностью удаленно. *Токенизация трансформирует управление активом: модель исполнения заявок оператором (например, в банке) сменяется моделью прямого управления активом с помощью криптографических механизмов*. Основным отличием является исключение роли (например, администратора или модуля, который работает с соответствующими разрешениями), которая может напрямую изменять баланс на счетах пользователей. Именно на этом основывается модель системы, которая построена по принципу исполнения заявок. Токенизация предполагает, что пользователи контролируют свои балансы при помощи криптографических ключей, которые никто другой (в т. ч. администраторы) не знает.

Также существует принципиальное отличие между реестром подлинности и реестром прав собственности. *Реестр подлинности* связывает определенный актив (например, дизайнерскую сумку) с его производителем и позволяет проверить подлинность этого объекта. Этот реестр содержит только объекты (без их текущих владельцев). *Реестр прав собственности* является информационным ресурсом, содержащим данные о существующих и прошлых правах собственности на конкретные активы.

### Почему именно технология blockchain?

Ключевой вопрос таков: почему blockchain лучше традиционного подхода к построению и управлению базой данных? Существует несколько причин использовать blockchain для токенизации и защиты реестра. Ранее мы уже описали некоторые основополагающие свойства, которые блокчейн может обеспечить в зависимости от среды (см. 5.1). Сейчас мы хотели бы сконцентрироваться на практических особенностях:

* Каждый держатель токена может доказать, что его баланс отображает результат корректного исполнения набора транзакций – *возможность осуществления аудита (auditability)*.
* Никто не может изменить баланс аккаунтов, не будучи при этом замеченным, – *целостность (integrity)*.
* Крайне сложно изменить состояние реестра, поскольку множество копий синхронизируются в режиме реального времени, не имея при этом единой точки отказа, – *надежность (robustness)* и *доступность (accessibility)*.
* Легко доказать, кто какое действие инициировал, – *неотказуемость (non-repudiation)*.
* Возможно гарантировать, что транзакция была одобрена всеми требуемыми участниками, – *децентрализованное принятие решений (decentralized decision-making)*.
* Некоторые участники могут осуществлять аудит без возможности модифицировать данные, – *прозрачность, не требующая доверия (trustless transparency)*.

If you try to achieve all these properties using the possibilities of a traditional database, it would rather be wheel 
reinventing—you would eventually come up with the blockchain solution.

### Итоги

Токенизация – новый тренд совершенствования учетных систем и IT-инфраструктуры в целом.

Платформы токенизации дают свои преимущества при работе с цифровыми активами: прозрачность их учета, легкий аудит, надежность хранения и синхронизации данных между валидаторами учетной системы, а также возможность доказательства целостности и неизменности этих данных. Благодаря этим свойствам можно создавать учетные системы, в которых доверие между сторонами не обязательно: *честность* их поведения будут гарантировать правила системы. Поэтому логично предположить, что в будущем все активы будут токенизированы.

**Часто задаваемые вопросы**

*– Какая разница между токенами и валютами (деньгами)?*

Несмотря на то, что люди уже используют это слово в своей повседневной жизни, токен является техническим термином, который на практике может означать право на любой актив (включая валюту). Токены представляют собой оцифрованное право собственности на актив и могут также быть использованы в качестве средства оплаты. Обмен токенов или оплата токенами любого рода товаров или услуг имеют некоторые сходства с бартером.

*– Как связаны токенизация и технология blockchain?*

Цифровой учет ценности сопровождается рядом рисков. Важно, чтобы система, в которой выполняется эмиссия, хранение и передача ценности, обладала достаточным уровнем безопасности. Технология blockchain хорошо для этого подходит. Безопасность данных гарантируется криптографией и любые попытки нарушения правил протокола учетной системы прозрачны для аудитора. Кроме того, обычные пользователи, если они обнаружили какое-либо нарушение при функционировании платформы токенизации, также имеют возможность доказать, что они были обмануты.

*– Кто контролирует платформу токенизации?*

Если компания решает токенизировать свой актив и контролирует валидаторов на платформе токенизации, то именно эта компания и является фактическим владельцем платформы токенизации. Компания централизованно принимает решение об обновлении протокола и соответствующих правил учета токенов. Если задача состоит в децентрализации учетной системы, то роль валидатора может быть распределена между партнерами или даже клиентами компании. В этом случае платформа приобретает большую независимость в отношении обработки и подтверждения транзакций. Таким образом можно обеспечить свойство trustless для работы с соответствующими токенами. 

*– Что такое utility tokens?*

Utility tokens представляют собой права на использование функциональности системы. Они могут одновременно обладать свойствами как заявки на использование услуги, так и части стоимости, созданной системой; а также определенными свойствами внутренней валюты. Принятие решений и выдача таких токенов зачастую выполняются централизованно.

*– Что такое non-spendable tokens?*

Такие токены можно по определенным правилам получать и накапливать, но нельзя передавать. В некоторых случаях их можно потратить (например на получение прав, изменение ограничений и т. п.). Non-spendable tokens может выдавать/изымать администратор отдельно для каждого участника системы, либо у таких токенов может быть ограниченное время жизни. Чаще всего использование таких токенов похоже на предъявление проездного документа в общественном транспорте. Они отлично подходят для учета репутации, персональных скидок, личных прав доступа, количества написанных на форуме сообщений и т. п.

*– Кто ответственный за ошибки на платформе токенизации?*

Если платформа токенизации централизована, тогда ответственность за нее несет владелец. Если же платформа децентрализована, то ответственность распределяется между валидаторами и клиентами платформы.

*– Кто может быть валидатором в системе учета токенов?*

Валидатором может быть любой, кто способен поддерживать нормальное функционирование системы в соответствии с протоколом учета токенов. Роль валидатора может выполнять как один человек, так и целая организация. В общем случае валидаторами транзакций могут быть и аудиторы, и регуляторы, и партнеры владельца платформы (например, члены консорциума, выполняющие определенную бизнес-функцию).

[ПРИВАТНОСТЬ ПОЛЬЗОВАТЕЛЕЙ В ОТКРЫТЫХ СИСТЕМАХ](https://github.com/distributed-lab/blockchain-and-decentralized-systems-book/blob/main/chapters/volume-1/ru/7-user-privacy-in-open-systems.md) 




















