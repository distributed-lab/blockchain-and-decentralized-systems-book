# 5 ТЕХНОЛОГИЯ BLOCKCHAIN


## 5.1 Технология blockchain и ее возможности

О технологии *blockchain* вне контекста криптовалют люди начали активно говорить в 2014 году. В то время люди начали осознавать, что децентрализованный подход, который используется в Bitcoin, может быть применен в других областях, и что технология blockchain является ключевой. Например, использование этой технологии в учетных системах может защитить данные от несанкционированных модификаций. Обеспечение в системах свойств, таких как *неизменяемость*, *целостность*, *trustlessness*, *надежное согласование* и т. д., получило широкий отклик в обществе.

До появления Bitcoin все финансовые системы были закрытыми и защищались «традиционными» методами: межсетевыми экранами (фаерволами, брандмауэрами), системами управления доступом и администраторами безопасности. Очень немногие организации поддерживали открытое API или позволяли создавать расширения или альтернативные приложения сторонним разработчикам. Bitcoin впервые показал, что финансовая система может не только существовать без центра принятия решений, но также может быть прозрачной для всех, доступной для проведения аудита и при этом может обеспечивать более высокий уровень приватности пользователей.

*Технология blockchain позволила организовать хранение и синхронизацию данных среди сторон, которые не доверяют друг другу*. Вместо того, чтобы полагаться на доверенные стороны и связь с ними для достижения целостности базы данных, технология blockchain предполагает, что все данные о существующих транзакциях (или других записях) сгруппированы в блоки, каждый из которых криптографически связан с предыдущим.

> **_Замечание._** *Отсутствие доверия между участниками учетной системы на основе blockchain не обязательное. Вы можете доверять определенным участникам. Но главное преимущество blockchain как раз состоит в том, что даже тогда, когда доверять некому, вы можете полноценно работать с системой.*

Когда слово блокчейн употребляют в повседневной речи, в него могут вкладывать совершенно разный смысл. Поэтому необходимо оговаривать и понимать эту разницу. Мы рассмотрим три значения из наиболее часто встречаемых. Словом blockchain можно описать базу данных конкретной учетной системы (например Bitcoin). Второе возможное значение – реализация технологии в частном случае. Третий (и наиболее правильный) вариант употребления термина – обозначение способа организации данных в целом. Поэтому следует аккуратно использовать этот термин, принимая во внимание контекст.

На самом деле результат многочисленных дискуссий о полезности blockchain можно поместить в одну фразу: в отличие от традиционных учетных систем, в которых пользователи вынуждены слепо доверять предоставленным данным (вне зависимости от того, добыты ли данные внутри системы или за ее пределами), *в учетных системах на базе технологии blockchain есть возможность проверить целостность и хронологическую упорядоченность данных*. Вследствие этого участники могут в большей степени полагаться на эти данные (причем как обычные пользователи, так и владельцы системы).

> **_Замечание._** *Фразу «в большей степени полагаться» следует понимать как возможность независимо хранить и верифицировать целостность и упорядоченность данных, полагаясь на некоторые внешние данные, такие как сертификаты открытых ключей, сторонние криптографические библиотеки и т. д. Это также подразумевает наличие строго определенных правил, по которым можно математически проверить корректность транзакции, построенной на их основе.*
> *Blockchain – это не панацея, которая делает все данные внутри системы достоверными.*

### Степени децентрализаци

Оценка степени децентрализации определенной системы является довольно сложной задачей (за исключением полностью централизованной системы). Конечной целью любой учетной системы является не децентрализация как таковая, а, скорее, достижение некоторой комбинации свойств, таких как конфиденциальность, целостность, доступность, устойчивость, надежность и производительность. Децентрализация выгодна настолько, насколько она позволяет достичь этих свойств. Например, если система полностью анонимна, то в таких условиях гораздо проще обеспечить устойчивость к цензуре, проверку данных без доверия к третьей стороне и экономическое стимулирование для распределения принятия решений.

Если мы попытаемся построить линейную шкалу возможных степеней децентрализации системы, она может выглядеть так, как на рисунке 5.1.

![Рисунок 5.1 – Возможные степени децентрализации системы](/resources/img/volume-1/5.1-blockchain-technology-and-its-capabilities/5.1-degree-of-decentalization.jpg)

Все эти случаи можно оценить и в дальнейшем сравнить по следующим критериям: количество валидаторов, их анонимность, необходимость наличия у валидаторов репутации и необходимость разглашения репутации валидаторов остальным участникам системы.

*Реестр цифровой собственности (digital ownership ledger)*. С левой стороны шкалы находится система, в которой есть один владелец, который управляет всеми бизнес-активами. В такой системе достижение консенсуса не требуется и необходимость доверия пользователей к владельцу системы наиболее выражена. Подобный подход можно описать как применение технологии blockchain в централизованной среде (такой подход имеет свои преимущества, которых мы коснемся в 6.4).

Если существует два партнера, которые совместно управляют аккаунтом компании и при этом не доверяют друг другу в отношении осуществления платежей, авторизации транзакций и ведения учета этих транзакций, ситуация будет кардинально отличаться. Они оба должны подписывать каждую транзакцию и хранить информацию об этой транзакции в локальных копиях базы данных. Технология blockchain помогает автоматизировать этот процесс. Самый простой способ достичь консенсуса здесь – использовать мультиподпись (каждую транзакцию заверять двумя подписями). Требование анонимности отсутствует, поскольку партнеры должны видеть транзакции, которые они подписывают. Согласование транзакций может происходить очень быстро, проблем с очередностью быть не может, поскольку каждая из них содержит временную метку. Защита от цензуры не имеет смысла. Каким-то образом мотивировать партнеров поддерживать узел не нужно.

*Взаиморасчет (reconciliation)*. Этот случай детально будет рассмотрен ниже. Его ключевой особенностью по сравнению с предыдущим вариантом применения является большее количество участников, между которыми должен быть достигнут консенсус, и оно может доходить до нескольких десятков (в большинстве случаев их количество ограничено и известно изначально). В этом случае система носит более децентрализованный характер, а подхода с использованием мультиподписи уже не достаточно для достижения консенсуса. В таких ситуациях и находят применение алгоритмы достижения консенсуса, такие как BFT, FBA, PoI, PoA (подробнее в 5.2).

*Платформа токенизации (tokenization platform)*. В таких системах можно добиться более высокого уровня децентрализации, а число сторон, участвующих в достижении консенсуса, может изменятся и не ограничивается. Для достижения консенсуса часто используется алгоритм FBA.

*Платформа голосования (voting platform)*. Публичное голосование подразумевает, что все его участники должны достичь консенсуса и иметь возможность подтвердить результаты выборов. Тем не менее, всем участникам необходимо пройти процесс идентификации, в результате которого их личность может быть подтверждена (даже если участники непосредственно не знакомы друг с другом и не могут друг другу доверять). Алгоритм достижения консенсуса FBA также хорошо подходит для таких систем.

*Криптовалюта (cryptocurrency)*. Протокол первой криптовалюты (Bitcoin) заранее подразумевал, что количество участников не определено, все они анонимные и не имеют репутации. Для работы в таких условиях был выбран один подход к достижению консенсуса – proof-of-work. В этом случае пропускная способность системы сильно ограничена по сравнению с системами, которые мы описывали ранее. Кроме того, в таких системах необходим экономический механизм для мотивирования участников системы действовать по правилам протокола и гарантирования, что сеть не утратит децентрализованный характер с течением времени. Это влечет потребность иметь в системе внутреннюю валюту с соответствующими свойствами.

Существует несколько проблем, присущих архитектуре Bitcoin. Во-первых, транзакции могут быть отслежены (эта проблема частично решена в криптовалютах ZCash и Monero). Во-вторых, существует некоторая концентрация вычислительных мощностей среди небольшого количества майнинговых пулов.

*? – новые криптовалюты* (еще не изобретены). Последняя точка на шкале указывает на системы с максимальным уровнем децентрализации и приватности. По свойствам такие системы идеальны и встречаются только в теории, но мы можем сформулировать ряд требований к ним, которые позволят создать новые, приближенные к таким системам модели. Прежде всего, это **полная** конфиденциальность транзакций (что-то наподобие ZCash, но без механизма trusted setup). Это значит, что посторонний наблюдатель не может увидеть факт осуществления транзакции, не говоря уже о ее содержимом. Такие криптовалюты должны поддерживать полностью децентрализованный майнинг без каких-либо стимулов для создания пулов (аналогично тому, что позволяет DAG, но при отсутствии централизованного координатора). Кроме того, пользователи такой сети могут общаться р2р способом, используя подход mesh-сетей вместо централизованного интернет-провайдера, который находится на пути от пользователя к децентрализованной системе.

В итоге, любая система, в которой необходимо приходить к согласию между определенным (медленно меняющимся) количеством участников, будет использовать разновидности алгоритма BFT. Примером является любое голосование: от совета директоров до общенационального. И, естественно, ей не нужна собственная валюта. Вопрос цензуры будет решаться не технической возможностью ее предотвращения, а немедленным разглашением самого факта (за счет того, что «все знают все»).

В зависимости от того, какие задачи будет решать учетная система, ее база данных будет обладать совершенно разными свойствами. В сообществе используют несколько терминов для определения ее типа по уровню доступности.

*Permissionless*. Кто угодно может принять участие в определенном процессе системы без каких-либо ограничений и разрешений. Если некоторая система заявляет, что она permissionless, это означает, что абсолютно все процессы, которые протекают в системе, доступны любому желающему. Иногда эти системы называют *public blockchains*.

*Permissioned*. Это свойство подразумевает, что для участия по меньшей мере в одном определенном процессе требуется отдельное разрешение. Иногда эти системы называют *private blockchains*.

### Архитектура blockchain

В цепочке блоков каждый следующий блок содержит хэш-значение от предыдущего (рис. 5.2). Все попытки изменить данные, записанные на определенном уровне, влекут изменения на всех последующих уровнях и будут замечены остальными участниками системы. Так обеспечивается проверка целостности данных (database integrity verification).

![Рисунок 5.2 – Связь между блоками в цепочке](/resources/img/volume-1/5.1-blockchain-technology-and-its-capabilities/5.2-link-between-blocks.png)

Таким образом формируется последовательность блоков – цепочка (откуда и пошло название blockchain), где каждый следующий блок содержит хэш-значение от предыдущего. Для связівания блоков должна использоваться стойкая хэш-функция. Если внести изменения в прошлые блоки, то все последующие станут некорректными, то есть их придется пересоздать. Эта особенность делает невозможным изменение истории задним числом незаметно для всех остальных участников.

### Свойства блокчейна

Теоретически технология блокчейн может быть применена для организации данных в любой СУБД. Цепочка блоков может быть организована на абстрактном уровне, ПО не обязательно будет хранить данные транзакций в организованных блоках, достаточно, чтобы заголовок блока удовлетворял соответствующему формату. Следовательно, узел сети может организовать хранение и обработку транзакций любым удобным ему образом, а для выполнения синхронизации с другими узлами данные сериализуются в блоки определенного формата и передаются по сети.

> **Свойства учетной системы, которые могут быть обеспечены с помощью технологии blockchain**
>> * *Целостность истории изменения базы данных* 
>> * *Минимизация задержек синхронизации и резервного копирования* 
>> * *Возможность работы группы валидаторов одновременно* 
>> * *Возможность осуществления аудита в режиме реального времени* 
>> * *Возможность использования легких клиентов и SPV-узлов* 
>> * *Timestamping (anchoring, фиксация данных с привязкой ко времени)*
>> * *Trustlessness (требуемый уровень доверия пользователя минимален)*

Особенности реализации свойств блокчейн для различных сред показаны в таблице 5.1.

![Таблица 5.1 – Свойства, которые может предоставить blockchain](/resources/img/volume-1/5.1-blockchain-technology-and-its-capabilities/table-5.1.png)

Когда степень децентрализации учетной системы повышается, то есть увеличивается количество валидаторов, появляется необходимость в механизме достижения консенсуса касательно правильного состояния системы.

Владелец полного узла может убедиться в корректности состояния истории всех транзакций, что делает работу в учетной системе прозрачной для аудитора. Если кто-то из пользователей умышленно составит некорректную транзакцию и отправит ее в сеть, все честные участники сразу это заметят и отбросят ее. А если злоумышленный валидатор создаст блок с некорректной транзакцией, то все честные участники это тоже заметят и отбросят весь блок целиком.

Если транзакцию, которая была уже принята в учетной системе,  позже отменяют валидаторы, то у пользователя будет неопровержимое доказательство того, что его обманули. Ведь соответствующий блок содержит доказательство (цифровую подпись или PoW) того, что валидаторы ранее отдали свой голос за эту транзакцию. Таким образом, у пользователя есть возможность доказать, что в учетной системе имело место мошенничество со стороны валидаторов, если они, например, перепишут историю нескольких последних блоков.

Если речь идет о системе учета, которая контролируется одной организацией, и по каким-то причинам цепочка блоков была переписана, то в цифровом кошельке пользователя остаются доказательства в виде транзакций, заверенных цифровой подписью организации.

Поэтому вопрос доверия между партнерами в учетной системе с применением блокчейна не так актуален. Надежность ее работы могут обеспечить правила протокола.

У пользователя есть возможность установить легкое клиентское приложение, где будет отображаться текущее состояние базы данных, не запуская полный узел. Это свойство важно для permissionless системы при условии, что пользователь полагается на то, что система работает надежно (в Bitcoin это значит, что большая часть вычислительной мощности принадлежит честным пользователям).

Когда учетная система достигает достаточного уровня децентрализации и неизменяемости записей, большое значение обретает временная метка. Она позволяет зафиксировать факт знания определенных данных в определенный момент времени и, что самое важное, впоследствии доказать этот факт кому угодно. В результате, пользователи могут быть уверены, что изменения состояния базы данных с высокой вероятностью соответствуют последовательности, в которой эти изменения были инициированы.

### Применение технологии блокчейн

Теперь обсудим, в каких ситуациях стоит применять блокчейн. Ведь эта технология позволяет спроектировать надежную систему, где человеческий фактор сводится к минимуму. Рассмотрим пять наиболее уместных и многообещающих областей применения технологии blockchain.

> * *Электронное голосование* 
> * *Цепочки поставок* 
> * *Децентрализованная торговля* 
> * *Публичные реестры* 
> * *Взаиморасчеты*

*Электронное голосование*. Каждый голосующий может быть уверен, что его голос будет учтен. При этом сложно получить право голоса два раза и сложно украсть чужой голос. Все транзакции в сети могут быть конфиденциальны, что уменьшает вероятность установить личность голосующего. В течение голосования любой желающий может проверить корректность всех транзакций с голосами, чтобы убедиться, что все они будут учтены (рис. 5.3).

![Рисунок 5.3 – Электронное голосование](/resources/img/volume-1/5.1-blockchain-technology-and-its-capabilities/5.3-evoting.png)

Голосующий должен иметь возможность доказать, что он имеет право голоса. При этом нужно сделать так, чтобы он мог воспользоваться им только один раз. Скорее всего, это указывает на необходимость создать центры сертификации, где голосующие будут регистрировать свои открытые ключи. Эти пункты должны находиться под управлением одной организации, которая будет проверять, что один человек не зарегистрировал несколько ключей. Поэтому доверие переходит от избирательных органов к центрам сертификации, которые, в свою очередь, также должны быть проверены. Digital identities в некоторых государствах, прежде всего в Эстонии, частично решают эту проблему.

Нужно выбрать такой алгоритм достижения консенсуса, который позволяет каждому участнику провести подсчет голосов и сопоставить свои результаты с результатами других участников. Для этого можно применить алгоритмы PoS, FBA, BFT (подробнее в 5.2).

Распространение программного обеспечения для голосования и аудита также представляет собой большую проблему. И угрозы встречаются на всех этапах: от разработки до установки и выполнения.

Таким образом, вследствие применения блокчейна система электронного голосования получает очень хорошие свойства. Но есть ряд задач, которые необходимо решить для внедрения такого проекта в жизнь.

*Цепочки поставок*. От производителя до потребителя товар проходит сквозь коридор посредников – так называемую цепочку поставок (supply chain). Однако наличие логотипа производителя на товаре еще вовсе не значит, что сам товар оригинальный. На пути следования продукта существует множество рисков, в том числе риск подмены.

Внедрение блокчейна в системы учета цепочек поставок может обезопасить товары (точнее, данные об их состоянии, местонахождении и т. д.) на пути их следования. Тогда покупатель сможет получить исчерпывающие данные о состоянии товара. Но вносить эти данные в базу могут только определенные должностные лица, ответственные за производство, сборку, погрузку на корабль, перевозку до следующего пункта и т. д.

Если злоумышленник захочет подделать транзакции, уже добавленные в цепочку блоков, то ему нужно будет заставить валидаторов войти в сговор или взломать сразу несколько разных серверов, на которых запущены эти узлы-валидаторы. Кроме того, использование надежных механизмов синхронизации данных между участниками позволяет предотвратить появление несоответствий в их учетных системах. Такой подход предоставляет определенные гарантии покупателю и делает систему управления цепочкой поставок более безопасной. Подходящими алгоритмами для этой задачи являются FBA и BFT.

В итоге, именно потребитель может просигнализировать в случае обнаружения подделки. Имея систему управления поставками, построенную с применением технологии blockchain, достаточно легко проверить, какой именно продукт должен быть доставлен и в дальнейшем продан через конкретный магазин. Если потребитель приобретает упаковку таблеток в Риме, а система проверки (которую он использует, например, путем сканирования штрихкода при помощи мобильного приложения) сообщает, что упаковка была доставлена в Париж, это приведет к явным сомнениям в честности импортера. Можно также сделать вывод, что товар, который был доставлен в Париж, поддельный (если штрихкоды уникальны).

*Децентрализованная торговля.* С применением технологии блокчейн и децентрализованного подхода можно осуществлять аукционы на многих мелких торговых площадках. Товар, который выставляется на продажу на одной из площадок, будет доступен и на всех остальных (рис. 5.4). Таким образом, у продавца появляется возможность представить товар максимально широкой и заинтересованной аудитории покупателей.

![Рисунок 5.4 – Пример децентрализованного аукциона](/resources/img/volume-1/5.1-blockchain-technology-and-its-capabilities/5.4-auction.png)

Поскольку исключается необходимость дублировать товар на каждой площадке, продавец экономит много времени. Более того, торги ведутся на них одновременно и данные о ставках синхронизируются в режиме реального времени. Поэтому каждая площадка всегда знает все ставки по каждому лоту, соответственно, победитель для всех очевиден.

Человеческий фактор в такой системе сведен к минимуму – провести аудит в такой системе не представляет сложности и много времени для этого не требуется. Измененные данные обо всей истории сделок не смогут остаться незамеченными. Подходящими алгоритмами достижения консенсуса для этой задачи являются PoW, PoS, FBA и BFT; выбор конкретного из них зависит от требований к анонимности и устойчивости к цензуре.

*Публичные реестры*. Публичный реестр доступен всем по определению. Если такой реестр управляется одной организацией, то в него могут вноситься любые изменения, в том числе задним числом. Причем доверять этим данным можно ровно настолько, насколько вы доверяете этой организации.

Основная причина, по которой публичные реестры управляются государственными органами, заключается в том, что пользователи не хотят, чтобы управление blackbox-системой (системой, в которой пользователю известны только входные и выходные данные, а все процессы, происходящие внутри, неизвестны) совершали коммерческие организации. Реестр, созданный с применением блокчейна, может решить проблему доверия путем децентрализации базы данных и процесса синхронизации, не позволяя какой-либо отдельной организации вносить скрытые изменения в систему. Копия базы данных может вестись несколькими организациями или широкой публикой (рис. 5.5). Следовательно, цензурирование единственной стороной становится невозможной: существует много владельцев реестров, которые проверяют все изменения.

Поэтому ведение государственных реестров может быть передано негосударственным организациям, что приводит к сокращению расходов и повышению уверенности граждан в целостности реестра. Наиболее подходящий алгоритмом достижения консенсуса для этой задачи – FBA.

![Рисунок 5.5 – Децентрализованное ведение реестров](/resources/img/volume-1/5.1-blockchain-technology-and-its-capabilities/5.5-registry.png)

*Взаиморасчеты*. Представим, что 10 банков хотят наладить партнерство, чтобы оказывать своим клиентам услуги быстрее и дешевле. Им нужно создать общую платежную систему для организации непосредственных расчетов с предприятиями и частными лицами, с которыми они работают. Поэтому они могут построить частную учетную систему с применением блокчейна, в которую они будут вносить все необходимые данные, и внутри нее они смогут осуществлять взаиморасчеты.

Каждый банк сможет запустить и поддерживать работу своего узла и проверять всю историю транзакций. Поскольку каждый банк имеет свои собственные интересы, то вероятность сговора в системе достаточно низкая (намного ниже, чем в системах, в которых расчетом занимается одна организация). Более того, такая учетная система позволит сделать расчеты более дешевыми и безопасными, потому что участвующим банкам не нужно платить сторонним организациям комиссионные за проведение расчетов. История транзакций хранится в цепочке блоков, которая управляется несколькими независимыми компаниями, что заметно усложняет атаки на систему. Кроме того, достаточно просто провести надежный и автоматизированный аудит по сравнению с традиционными системами. Подходящие алгоритмы достижения консенсуса здесь – FBA и BFT.

### Итоги

Из приведенных выше вариантов применения технологии видно, что учетная система, в которой применяется блокчейн, имеет ряд преимуществ:

* Простота проверки целостности базы данных 
* Timestamping всех изменений (наличие у каждого изменения своей временной метки) 
* Простое резервное копирование в режиме реального времени 
* Безопасная синхронизация данных в децентрализованной среде 
* Простой аудит системы в реальном времени

Технология блокчейн может обеспечить надежное хранение данных и наделить учетную систему рядом ценных свойств. Однако сложность проектирования, настройки и поддержания децентрализованной учетной системы, как правило, намного выше, чем для централизованных альтернатив, поэтому необходимо осознанно подходить к этому вопросу.

Следует учитывать то, что эти преимущества не всегда гарантированы на 100%. Блокчейн – не серебряная пуля: успех функционирования той или иной системы напрямую обусловливают правила ее протокола и способ ее реализации, а не лишь факт, что в ней используется технология blockchain.

**Распространенные мифы**

*Блокчейн может проверять любые данные, которые в нем хранятся.*

Особенность именно этого мифа состоит в том, что ошибки допущены даже в самой его формулировке. Еще он интересен тем, что обсуждается в явной форме, а некоторыми людьми подразумевается по умолчанию. Случалось, что люди хотели заказать систему учета с применением технологии blockchain, в которой должен проверяться и записываться их биржевой индекс. На вопрос о том, зачем им нужен блокчейн, они отвечали просто: «чтобы нашим данным верили».

Когда формируется новый блок, валидаторы могут ориентироваться только на данные о предыдущих блоках, и единственное, чем они  руководствуются, это правила протокола, по которым проверяется корректность транзакций. Невозможно изнутри системы проверить подлинность и корректность данных, которые *кто-то* записал в blockchain извне. Вопрос доверия переходит *к этому участнику*, который записывает данные, а не к валидаторам. Как и в примере с биржевым индексом, валидаторы не знают его цену, не говоря уже о том, является ли он правильным (это не относится к их работе). Единственный факт, который могут подтвердить валидаторы, это целостность данных, которые находятся в цепочке блоков (что она не была нарушена).

*Блокчейн медленный и требует много энергии.*

Учетная система, использующая технологию blockchain, в общем случае, может применять такой механизм достижения консенсуса, который обеспечивает высокую пропускную способность, где транзакции получают полное подтверждение в течении нескольких секунд. Причем этот механизм достижения консенсуса не обязательно будет требовательным к вычислительным ресурсам валидаторов. Именно благодаря правильному проектированию механизма достижения консенсуса можно построить с помощью технологии blockchain учетную систему, которая будет обладать необходимыми характеристиками (в нашем случае характеристиками пропускной способности).

*Блокчейн гарантирует надежность и прозрачность данных.*

Историю транзакций действительно изменить невозможно, но чтобы изменить состояние актуальных данных, не обязательно изменять существующие блоки и их связи. Достаточно создать альтернативную цепочку и добиться того, чтобы она стала основной. Это всецело зависит от согласия сторон, которые достигают консенсуса.

Допустим, пять банков решили создать систему взаимодействия с применением блокчейна. Чтобы совершать платежи, им нужно договориться. Для этого они устанавливают правила, по которым они будут достигать согласия. Это имеет смысл только тогда, когда каждый из них действует согласно своим интересам. Но если они сговорятся, то они могут переписать цепочку блоков как угодно просто заменив ее альтернативной. Таким образом, факт применения блокчейн, на самом деле, не гарантирует прозрачность и надежность системы учета для внешнего наблюдателя. Однако аудиторы, имеющие доступ к истории транзакций (и даже клиенты), заметят атаку и смогут безоговорочно доказать факт ее проведения.

*Блокчейн в Bitcoin зашифрован.*

Несмотря на ошибку в формулировке, мнение о том, что совместная база данных зашифрована, действительно распространено. А некоторые даже утверждают, что биткоины – это зашифрованные деньги. Конечно же, это не так. Сама по себе технология блокчейн может быть применена для организации любых данных, в том числе и зашифрованных. Если система используется для прозрачного учета монет, то данные транзакций должны быть открытыми, чтобы любой желающий мог убедиться в их корректности. Следует также отметить, что некоторые расширения, такие как механизм confidential transactions, позволяют сделать транзакции более приватными (см. 7.2).

*Блокчейн заменит серверы.*

Подобное мнение часто встречается среди людей, которые не владеют достаточными знаниями о способах организации больших объемов данных в частности и об информационных технологиях в целом. Даже если некоторая бизнес-логика будет реализована (например, выполнение смарт-контрактов) узлами системы, нельзя пренебречь простым фактом: узлы сети являются серверами. Заявление, что сервера больше не нужны, было также популярным в момент бума облачных вычислений. Серверы никуда не пропали, а просто поменяли свое местоположение (Amazon, IBM, Google). 

*Блокчейн заменит нотариусов.*

Этот миф относится не только к нотариусам, а к любым посредникам. Это не правда. Если ваша учетная система имеет дело с какими-либо данными из внешнего мира, блокчейн не исключит тех, кому необходимо эти данные проверять и регистрировать в базе данных.

Представим, что Алиса продает свой дом Бобу. Технология blockchain может оптимизировать этот процесс, но не может заменить посредников, таких как нотариусы. У валидаторов нет возможности узнать, что Алиса действительно использовала свой ключ для продажи дома, что Боб является настоящим человеком, что Алиса продает дом по собственному желанию и т. д.

Технология blockchain позволяет валидаторам убедится только в том, что математически верно, но она не отвечает за то, что происходит за пределами учетной системы. Стороны, которые передают данные из внешнего мира в учетную систему, называются оракулами (детальнее см. 6.3).

**Часто задаваемые вопросы**

*– Нужна ли стандартизация blockchain как технологии?*

В контексте протоколов децентрализованных учетных систем стандартизация может не принести желаемого результата, поскольку каждый из них спроектирован по-своему. Но для решения проблем, которые являются общими для многих систем, стандартизация пригодится. Например, порядок генерации, хранения и резервирования ключей.

*– Существуют ли такие модификации технологии blockchain, в которых пользователи имеют разные уровни доступа?*

Было бы действительно удобно, если, например, нотариусы имели бы доступ ко всем данным и могли бы заключать сделки, а остальные пользователи имели бы доступ только к тем данным, которые непосредственно касаются их самих. Но технология blockchain определяет только способ организации данных и не имеет прямого отношения к управлению уровнями доступа к этим данным. Очевидно, что при использовании комбинации различных подходов можно создать комплексное решение для этой задачи (но описывать такое решение в рамках этой книги не планировалось).

*– Как появление технологии blockchain повлияло на мировую финансовую отрасль*

Эта технология подтолкнула людей к созданию новых систем, где обеспечиваются свойства, такие как прозрачность (аудит в реальном времени), отказоустойчивость, неотменяемость действий и соответствующих записей. Кроме того, такими системами может владеть и управлять не одна сторона, как это было с использованием традиционных технологий, а группа независимых сторон. До появления технологии blockchain люди не верили, что возможно одновременно и довольно просто достичь всех вышеперечисленных свойств.

*– Какие недостатки технологии блокчейн?*

В базовом варианте необходимо хранить данные всей цепочки блоков, которая с течением времени только увеличивается.

## 5.2 Отличия подходов к достижению консенсуса

Можно с уверенностью сказать, что механизм достижения консенсуса является краеугольным камнем любой децентрализованной системы. Без понимания принципов работы этих механизмов невозможно спроектировать безопасную и эффективную систему. Иногда проводится сравнение разных децентрализованных учетных систем по критерию производительности, даже если они используют разные механизмы достижения консенсуса. Но если эти механизмы принципиально отличаются, то и сами системы отличаются по множеству критериев, таким как надежность, уровень безопасности, эффективность использования ресурсов, производительность и ограничения. Это, в свою очередь, сильно влияет на область применения систем. Поэтому стоит выяснить, какие характеристики наиболее важны для типичных децентрализованных учетных систем и как они могут зависеть от подхода к достижению консенсуса.

### Механизм достижения консенсуса как ключевой элемент децентрализованной системы учета

*Консенсус – это состояние согласия участников системы по поводу некоторого утверждения или предложения.*

*Алгоритм достижения консенсуса – это свод правил и критериев, по которым участники системы достигают согласия. Алгоритм достижения консенсуса часто называют механизмом, или протоколом, достижения консенсуса.*

Существует множество подходов к достижению консенсуса. Самыми известными среди них являются proof-of-work (PoW) и proof-of-stake (PoS). Образованные люди очень редко спорят между собой о том, какой из подходов лучше, потому что это всего лишь подходы, которые не имеют количественных характеристик, а не конкретные реализации учетных систем. Каждый из них обладает своими преимуществами и недостатками; нет хороших или плохих подходов: есть конкретные требования и допущения. Несомненно, в контексте применения для конкретного случая один из них может оказаться более подходящим, или даже «наилучшим».

Ранее (см. 5.1) мы кратко упомянули некоторые механизмы достижения консенсуса для разных случаев применения. Вероятно, идея использования мультиподписи (multisignature) для достижения консенсуса между валидаторами учетной системы является наиболее простой. Такой алгоритм применяется преимущественно для достижения консенсуса внутри ограниченного круга лиц. Его применение имеет смысл, когда все участники процесса знают друг друга и состав участников редко подвергается изменениям. Отличный пример – голосование жильцов дома по поводу ремонта (рис. 5.6).

![Рисунок 5.6 – Достижение консенсуса относительно ремонта дома](/resources/img/volume-1/5.2-difference-in-consensus-approaches/5.6-house-repairs.png)

### Proof-of-work

Достижение консенсуса на основе PoW стало популярным благодаря криптовалютам (подробнее о PoW в Bitcoin в 4.2). Этот алгоритм самый простой по устройству и при этом самый надежный в условиях полной децентрализации и анонимности. Однако часто принцип работы PoW сложно объяснить неподготовленному человеку. Постараемся привести простую аналогию.

Представим, что жильцы многоквартирного дома захотели покрасить забор во дворе. Чтобы определить, в какой цвет его красить, жильцы проводят конкурс. Правила таковы: каждый из них покупает трамвайные билеты в киоске неподалеку; тот, у кого будет билет с наименьшим номером, решит, какого цвета будет забор. Допустим, билеты продаются в случайном порядке. Очевидно, что владелец наибольшего количества билетов имеет *пропорционально бóльшую вероятность* стать тем самым счастливчиком.

Если последствия принятых решений действительно важны (т. е. для жильцов дома важно, в какой цвет будет покрашен забор во дворе), это мотивирует каждого участника конкурса покупать все больше билетов. Получается своеобразная «гонка вооружений». Точно так же происходит наращивание вычислительной мощности среди участников системы Биткоин. Если же есть подозрения, что кто-то из жильцов сговорился с продавцом, чтобы тот выдал «выигрышные» билеты, то часть жильцов может отделиться и построить новый дом, где они будут принимать решения по другим правилам.

### Proof-of-stake

Идея PoS похожа на голосование акционеров компании: тот, у кого доля в компании больше, имеет больший вес голоса в принятии конечного решения. Таким образом, решение в системе будет обусловлено не столько количеством голосов, сколько их весом (рис. 5.7).

![Рисунок 5.7 – Схема функционирование PoS](/resources/img/volume-1/5.2-difference-in-consensus-approaches/5.7-pos.png)

Конкретное пороговое значение суммарного веса для разных компаний может отличаться и заранее определяется акционерами. В учетной системе все зависит исключительно от правил конкретного протокола: где-то достаточно простого большинства (то есть 51%), где-то требуется две трети (66%), а может быть такое, что для принятия определенного решения необходимо 90% голосов за него.

Период формирования блока с помощью PoS может быть значительно меньшим, чем с помощью PoW. Однако спроектировать достаточно надежный алгоритм достижения консенсуса на основе PoS для децентрализованной учетной системы, где кто угодно может стать валидатором, весьма сложно.

### Delegated proof-of-stake

Это альтернативный выше представленным идеям достижения консенсуса способ. Основной идеей delegated proof-of-stake (DPoS) является выбор делегатов, которые должны участвовать в принятии решения. Обычно личности пользователей, которые становятся делегатами, известны изначально. Часто это люди, которые известны своими достижениями в определенной отрасли. В системе они имеют аккаунты, ассоциированные с их личностью. Выбирают делегатов сами пользователи.

Отметим, что вес голоса зависит от количества монет на балансе пользователя только на этапе выбора делегата. Сами же делегаты голосуют на равных условиях, то есть исход голосования решается простым большинством делегатов (валидаторов). Поскольку количество делегатов ограничено, их деятельность проще оптимизировать; как следствие, этот алгоритм достижения консенсуса позволяет учетной системе достичь высокой пропускной способности.

Идея создания и внедрения DPoS принадлежит команде разработчиков децентрализованной платформы BitShares.

### Proof-of-importance

Чтобы укрепить демократический подход к принятию решений, придумали надстройку над алгоритмом PoS, которую назвали proof-of-importance (PoI) [81]. Суть ее заключается в том, что теперь на вес голоса участника влияют несколько факторов: алгоритм учитывает не только количество монет, которыми владеет участник, но и степень его участия в работе системы. Здесь имеет значение все: характер взаимодействия пользователя с другими участниками, откуда берутся монеты, кому отправляются монеты и поведение в системе в общем. Таким образом, исключается ситуация, когда богатые становятся только богаче. Первая рабочая реализация PoI применяется в протоколе NEM.

### Механизмы на основе BFT

Название BFT (Byzantine Fault Tolerance) происходит из шуточного описания проблемы при построении высоконадежных систем [82]. В основу описания легла история о византийских генералах, которые организовывают атаку на некоторый город. Задача генералов – прийти к единому решению. Известно, что среди них есть несколько предателей. Предатели могут вести себя произвольным образом (с намерением нарушить функционирование системы). К тому же, необходимо учитывать, что у предателей имеется возможность влиять на передачу сообщений между честными генералами, для которых важно или одновременно атаковать город, или одновременно отступить. Если часть честных генералов отступят, то противник победит армию по частям. Поэтому всем генералам необходимо прийти к согласованному решению. Описанная выше постановка задачи была опубликована в одной научной работе, откуда и пошло название свойства алгоритмов достижения консенсуса – BFT [111]. Сегодня такая проблема может оказаться актуальной не только для генералов, но и, например, для футбольной команды (рис. 5.8).

![Рисунок 5.8 – Достижение консенсуса при помощи BFT](/resources/img/volume-1/5.2-difference-in-consensus-approaches/5.8-bft.png)

> **Условия работы механизма достижения консенсуса на основе BFT**
>> * *Взаимодействующие узлы равноправны* 
>> * *Среди участников могут быть злоумышленники, которые действуют скоординированно* 
>> * *Неизвестно, кто из валидаторов является злоумышленником* 
>> * *Честные участники составляют более ⅔ от общего количества* 
>> * *В сети могут случаться сбои и задержки* 

Также отметим, что количество участников известно заранее и они знают друг друга. Есть два варианта решения задачи: атаковать или отступить. Принимается, что количество честных узлов составляет по меньшей мере ⅔ + 1 участников.

В ходе реализации свойства BFT накладывается ограничение на количество шагов, за которые все честные валидаторы должны прийти к общему решению. Важно также то, что участники BFT-протокола гарантированно приходят к общему решению, которое в будущем не может быть изменено или отменено. Для не BFT-протоколов (в строгом определении) вероятность отмены решения является экспоненциально убывающей, но не нулевой.

### FBA

Federated Byzantine Agreement (FBA) впервые был представлен в Ripple и позже доработан в Stellar [83]. Он позволяет достигать согласия среди большого (потенциально неизвестного) количества участников (порядка нескольких тысяч), каждый из которых в общем случае не знаком со всеми остальными лично.

Каждый участник доверяет только ограниченному кругу других участников (3–10) и, следовательно, достигает консенсуса в узком кругу. Но за счет того, что социальные связи пересекаются, согласие может быть достигнуто во всей системе (рис. 5.9).

![Рисунок 5.9 – Достижение консенсуса при помощи FBA](/resources/img/volume-1/5.2-difference-in-consensus-approaches/5.9-fba.png)

Реализаций или аналогов такого механизма в мире очень мало. Подобным образом распространяются революционные идеи, когда люди делятся новостями и «заражают» идеей других. Принятие окончательного решения в системе, которая применяет этот механизм, требует больше времени по сравнению с системами, где каждый валидатор знаком с каждым другим.

### Протоколы достижения консенсуса, основанные на DAG

Directed acyclic graph (DAG) не является способом достижения консенсуса, но при помощи этого способа организации данных можно улучшить существующие механизмы. Прежде всего, его используют в системах, требующих асинхронного участия большого количества валидаторов. 

Впервые применение этой идеи было предложено в двух протоколах: SPECTRE [84] и PHANTOM [85].

Суть в том, что валидатор включает в заголовок своего блока ссылки на такие блоки, которые считает правильными, но на которые еще не ссылались другие валидаторы (согласно текущему состоянию системы, которое он видит). После этого валидатор отправляет свой блок в сеть. Получается структура, в которую включаются все блоки, видимые валидаторами в текущий момент времени. Таким образом, все блоки, которые могли бы стать orphan blocks, будут включаться в граф (рис. 5.10). Это значит, что голоса честных валидаторов не будут потрачены впустую. Потенциально это один из наиболее эффективных способов организации взаимодействия большого количества валидаторов, работающих одновременно, что положительно сказывается на надежности учета и уровне защищенности системы от атак двойной траты и подобных.

![Рисунок 5.10 – Организация базы данных в виде DAG](/resources/img/volume-1/5.2-difference-in-consensus-approaches/5.10-dag.png)

Слабое место текущих реализаций систем, которые используют DAG, состоит в централизации процесса разрешения конфликтов (транзакций с двойной тратой). Этот процесс выполняют *witness nodes* в ByteBall и *coordinator* в IOTA. В любом случае DAG – относительно новый подход с высоким потенциалом применения в permissioned системах.

### Основные критерии классификации механизмов достижения консенсуса

Рассмотрев особенности каждого из механизмов достижения консенсуса, можно выделить критерии для их классификации:
* Необходимость доверия к валидаторам 
* Анонимность валидаторов
* Требования к репутации валидаторов 
* Право стать валидатором 
* Пропускная способность 
* Время полного подтверждения транзакции

Обратите внимание на таблицу ниже (табл. 5.2). Существуют такие механизмы, в которых доверие к валидаторам не требуется. Этому способствует ряд обстоятельств, таких как правила системы, которые мотивируют валидаторов к честному поведению, а также взаимозаменяемость этих валидаторов, когда не имеет значения, кто именно будет участвовать в подтверждении.

![Таблица 5.2 – Сравнение различных механизмов достижения консенсуса](/resources/img/volume-1/5.2-difference-in-consensus-approaches/table-5.2-comparison.png)

Еще один важный критерий – право стать валидатором. Этот процесс может происходить как на общедоступной основе, так и требовать одобрения группы уже имеющихся валидаторов.

На практике алгоритмы достижения консенсуса могут обеспечивать разную пропускную способность. Теоретически, если необходимо, ее можно повысить для любого из механизмов, например, наращивая вычислительные ресурсы узлов-валидаторов и увеличивая размер блока. Но это может существенно уменьшить степень децентрализации учетной системы. В ряде случаев такая модификация – скорее недостаток, чем преимущество.

Следует понимать, что для PoW и PoS в принципе очень сложно уменьшить время подтверждения транзакций. В то же время алгоритмы DPoS и PBFT устроены таким образом, что достаточное количество валидаторов успевает достичь единогласия в короткие сроки.

### Итоги

Механизм достижения консенсуса – это основа надежной работы децентрализованной учетной системы. В зависимости от потребностей и задач конкретного бизнеса при выборе учетной системы рассматривают конкретный механизм, поскольку от него будут зависеть ее свойства.

Разнообразные механизмы достижения консенсуса нацелены найти оптимальный компромисс между необходимым уровнем доверия, временем, необходимым для принятия решений, степенью неотменяемости принятых решений и пропускной способностью системы. Решение о выборе конкретного алгоритма достижения консенсуса должно основываться на результатах тщательного анализа требований к безопасности системы.

**Распространенные мифы**

*Исходный код Биткоина можно оптимизировать под любую учетную систему.*

По-видимому, распространено заблуждение, что можно взять исходный код Bitcoin или Ethereum и свободно применить его в любом новом проекте. На практике встречаются примеры, когда разработчик собирается спроектировать цифровую валюту и делает форк Биткоина, где изначально предусмотрен майнинг. При этом непонятно, кто будет выполнять роль валидатора, и далеко не всегда майнинг вообще нужен в реализации данной системы. 

*Нет никакого смысла в централизованной учетной системе с применением технологии blockchain.*

Обратим внимание на такой пример. Люди называют Ripple (XRP) централизованной цифровой валютой. Они правы в отношении эмиссии монет и валидации транзакций, но неправы в отношении аудита и хранения копий базы данных. Кто угодно может запустить узел сети Ripple и верифицировать транзакции, но не может формировать блоки и эмитировать новые монеты XRP.

Также ошибочно расценивать децентрализованную учетную систему с ограниченным доступом, как централизованную. Мало смысла в достижении консенсуса только тогда, когда всех валидаторов контролирует одна организация. Даже в случае банка со множеством отделений подходящий BFT консенсус может предотвратить мошенничество или атаку, направленную на единую точку отказа (типичная проблема для многих банков). Правильное использование особенностей технологии blockchain может помочь системе предоставить пользователям основные услуги безопасности: целостность, неотказуемость и доступность.

*При использовании протокола PoW валидаторы бесполезно расходуют электроэнергию.*

Единственный подходящий способ удовлетворить требованиям в системе Bitcoin (см. 2.3 и 4.2) – это PoW, который делает невыгодным спам сети и попытки подтверждения неправильных транзакций, поскольку предприниматели-майнеры платят высокую цену за возможность принять участие в этом процессе и сильно рискуют не получить вознаграждение, если попытаются подтвердить транзакции, не соответствующие правилам протокола. Это не бесполезное энергопотребление. Скорее, это цена, которую необходимо заплатить за использование независимой и устойчивой к цензуре платежной системы, каковой и является Bitcoin. 

**Часто задаваемые вопросы**

*– Возможен ли гибрид proof-of-work и proof-of-stake?*

Да, конечно. Существуют учетные системы, которые так работают, например, Peercoin и Decred.

*– Можно ли организовать двухуровневый консенсус для улучшения характеристик учетной системы?*

Да, по сути, это случай DPoS. Такой подход уже используется в некоторых системах, например, в BitShares, но там другая модель безопасности. Идея в том, что участники по принципу PoS выбирают других участников на пост валидаторов, которые, в свою очередь, формируют блоки. Частота генерации блоков в BitShares в сотни раз выше. 

*– При использовании PoS выходит, что пользователь с наибольшим балансом соберет подавляющее большинство монет и консенсус нарушится?*

Во-первых, пользователь не один собирает монеты. Их собирают все пользователи пропорционально своему балансу. Во-вторых, у каждого также есть потребность тратить монеты. В-третьих, валидаторам невыгодно нарушать процесс достижения консенсуса, поскольку они хранят сбережения в этой системе.

Стоит отдельно рассмотреть случай, когда монет у пользователя вообще нет, но он участвует в добыче блоков. Есть ли у него шансы? Обычно, если система использует механизм достижения консенсуса PoS, начальная эмиссия централизованная. В этом случае пользователю придется монеты приобретать. Другой подход при построении систем предполагает гибридную схему (PoW и PoS), используя которую каждый пользователь может на начальном этапе добывать монеты при помощи майнинга, а после перейти на алгоритм достижения консенсуса PoS.

*– Если DPoS может использовать BFT разве это не решает проблему времени подтверждения транзакции?*

Уже существуют и успешно работают децентрализованные системы с такими алгоритмами достижения консенсуса, где даже с несколькими десятками валидаторов транзакция получает полное подтверждение за 2-3 секунды. И в этих системах проблема времени подтверждения решена, но в системах использующих PoS и PoW удовлетворить требованиям BFT принципиально невозможно.

## 5.3 Ограничения технологии blockchain и сложности ее применения

Блокчейн и смарт-контракты воспринимаются как перспективные и многообещающие технологии для внедрения в существующую регулируемую инфраструктуру, но в настоящий момент все обстоит несколько сложнее, чем кажется на первый взгляд.

Начнем с того, что мы говорим о регулируемой среде, в которой ответственность за риски несут конкретные стороны. Переход в эпоху цифрового взаимодействия требует применения максимально надежных технологий, которые обеспечат участникам системы уверенность в том, что данные, которые они видят, являются подлинными. Информация, которая будет храниться в электронных реестрах, должна быть защищена от несанкционированных изменений.

Технология блокчейн позволяет создавать такие системы. Более того, здесь не требуется доверие участников друг другу или третьей стороне. Однако нужно решить некоторые сложные задачи, чтобы сделать возможным внедрение таких систем в повседневную жизнь.

> **Задачи, которые сопровождают внедрение учетных систем с применением блокчейна**
>> * *Внедрить цифровую идентификацию (digital identity)* 
>> * *Цифровизовать (digitalize) все процессы* 
>> * *Принять единые правила обработки данных* 
>> * *Учитывать все активы в одной системе* 
>> * *Организовать децентрализованное принятие решений*

### Внедрение digital identity

*Digital identity* позволяет связывать определенные действия пользователя с его личностью.

В пределах одной организации (*централизованной среды*) это реализуется достаточно просто. Но когда речь идет о консорциуме компаний либо государстве, реализация становится очень сложной, потому что связь между личностью пользователя и совершаемым им действием в цифровом мире должна быть юридически подтверждена. Подтверждение должно быть таким, чтобы не возникало разногласий при доказательстве факта взаимодействия определенных пользователей.

В этом направлении интенсивно развивается Эстония. Правительство этого государства уже несколько лет активно внедряет электронные паспорта и позволяет своим гражданам голосовать с помощью них.

Как видим, identity – ключевой элемент для взаимодействия в цифровом мире.

### Цифровизация (digitalization) всех процессов

Это не менее важная задача. Любые инновации обычно предполагают постепенный переход и некоторую этапность. Однако в случае использования blockchain очевидно, что пока все внутренние процессы учета компании не будут цифровизованы, ничего работать не будет. Представим, что организации потребовалось произвести проверку клиента в некоторой внешней базе данных. Сейчас это нередко осуществляется с помощью телефонного звонка. Однако вместо этого будет оптимально реализовывать автоматическую проверку по протоколам за время, которое соответствует ожидаемому времени принятия решений (рис. 5.11).

![Рисунок 5.11 – Цифровизация процессов](/resources/img/volume-1/5.3-limitations-of-blockchain-technology-and-its-application-challenges/5.11-digitalization-of-process.png)

### Принятие единых правил обработки данных

Сначала нужно выработать единые правила для решения проблем подтверждения транзакций, обновления системы, ответственности в случае непредвиденных последствий. Данные правила должны быть утверждены заранее.

Нужно создать единую правовую базу. Важно, чтобы обновленный подход учитывал возможность существования децентрализованных систем со всеми их особенностями, включая распределенную ответственность и особенности принятия решений. Криптовалюты являются показательным примером того, насколько сложно решить эту задачу. Многие регуляторы уже начали движение в направлении обновления законодательства, чтобы оборот криптовалют учитывался в мировой экономике. Однако пока у общества больше вопросов, чем ответов.

### Перенос всех цифровых активов в одну учетную систему

В некотором смысле использование технологии blockchain предполагает, что права собственности на все активы обрабатываются в одной учетной системе. Собственно, это и делает его использование настолько эффективным.

Дело в том, что учетная система, спроектированная с применением blockchain, где достаточно хорошо определены правила работы, может гарантировать корректность и безопасность функционирования. Однако это возможно только в том случае, когда сама учетная система является самодостаточной.

В этом случае концепция самодостаточности может быть проиллюстрирована на примере Bitcoin. Система не использует никакие внешние ресурсы для проверки транзакций. Вся информация об адресах и UTXOs сохраняется во внутренних базах данных с момента возникновения Bitcoin. В рамках такой системы полученные данные могут считаться достоверными. Математика и криптография тоже не требуют доверия, поскольку они работают в любом случае одинаково. Следовательно, пользователь может быть уверен, что он работает с прозрачной и корректной системой.

В качестве примера можно привести платформу для смарт-контрактов Ethereum, которая позволяет торговать всеми активами, выпущенными на ее основе. Если мы возьмем любую отдельную систему учета (например, систему учета прав собственности на землю), которая признана правительством, тогда возникает проблема синхронизации данных между двумя системами. На текущий момент единственный способ этого достичь – использование доверенных третьих сторон – оракулов (детальнее в 6.3).

### Организация децентрализованного принятия решений

Пятым аспектом выделим децентрализованное принятие решений, а именно согласованность всех сторон процесса по поводу того, как будут приниматься решения. Этой согласованности на практике очень непросто достичь, потому что людям сложно договориться, когда дело касается личной выгоды от принятого решения. Это может быть обусловлено чем угодно: политическими амбициями, меркантильными интересами и т. д. В рамках одного предприятия еще возможно принять согласованное решение, но как только появляется конкуренция и возникают различные точки зрения, это начинает напоминать политическую борьбу. Именно по этой причине мы наблюдаем так мало рабочих вариантов применения блокчейна в корпоративной среде.

> **Факторы, ограничивающие применение технологии blockchain**
>> * *Высокая избыточность*
>> * *Задержки синхронизации узлов* 
>> * *Проблема управления изменениями (governance)* 
>> * *Проблема ответственности*

Эти ограничения являются фундаментальными, поскольку вытекают из самого децентрализованного подхода. Разберем их подробнее.

### Пропускная способность учетной системы

*Пропускная способность (capacity)* учетной системы обычно определяется как количество подтвержденных транзакций или суммарный объем данных таких транзакций за единицу времени. Соответственно, пропускная способность измеряется в единицах tps (транзакции в секунду) или B/s (байты в секунду). Проблемы ограничения производительности и масштабируемости децентрализованных систем тесно связаны между собой, но на самом деле это абстрактные величины, которые невозможно измерить, и поэтому нет смысла их использовать. Вместо них существуют более точные показатели: пропускная способность, время подтверждения транзакции и максимальное количество валидаторов, которые могут участвовать в достижении консенсуса одновременно.

Для наглядности и простоты понимания разницы в пропускной способности можно привести иллюстрацию (рис. 5.12). Две разные службы доставки за один период времени могут выполнить работу по перемещению разного количества груза. На их пропускные способности будет влиять тип выбранного транспорта.

![Рисунок 5.12 – Пример систем с разной пропускной способностью](/resources/img/volume-1/5.3-limitations-of-blockchain-technology-and-its-application-challenges/5.12-low-and-high-capacities.png)

Децентрализованная система чаще всего обладает меньшей пропускной способностью, чем система с одним центром управления, поскольку внесение изменений в данном случае занимает больше времени. Необходимо распространить данные между всеми участниками, и они должны достичь консенсуса относительно имеющейся информации: решение принимается уже не в одном месте, а в нескольких. Эти задержки ведут к увеличению времени отклика учетной системы.

### Время подтверждения транзакции

Понять ограничение *времени подтверждения (confirmation time)* поможет пример на рис. 5.13. Задачу одного и того же объема данных можно выполнить как быстро, так и медленно в зависимости от того, какой подход к выполнению был выбран. В контексте задачи по доставке груза на время ее выполнения будет влиять тип выбранного транспорта.

![Рисунок 5.13 – Пример систем с разным временем выполнения задачи](/resources/img/volume-1/5.3-limitations-of-blockchain-technology-and-its-application-challenges/5.13-transaction-cong-time.png)

Проблема хранения данных в полном объеме также накладывает дополнительные ограничения. Ведь каждый, кто участвует в принятии решений, должен хранить свою копию базы данных системы, которая постоянно обновляется, синхронизируясь с другими узлами сети (рис. 5.14).

![Рисунок 5.14 – Проблема хранения данных в полном объеме](/resources/img/volume-1/5.3-limitations-of-blockchain-technology-and-its-application-challenges/5.14-redundancy.png)

В зависимости от текущих условий в сети (потока новых транзакций, hash rate, параметра сложности и т. д.) на протяжении февраля–августа 2018 года среднее время первого подтверждения блока Биткоина колебалось от 6 до 18 минут, но отмечались задержки почти до получаса.

### Управление изменениями (governance)

Разработка ПО системы в рамках одной компании – это централизованно управляемый процесс, который характеризуется наличием ответственных сторон и четкого плана. Любые предложения по внесению изменений утверждаются узким кругом лиц, причастных к разработке правил работы системы.

Для правильно примененной децентрализованной учетной системы демократизация управления изменениями является благотворной. Чем более многочисленно открытое сообщество, которое спорит и предлагает решения, тем больше возможностей для ценных улучшений. Если большинство поддержит улучшение, то оно будет добавлено в следующее обновление. Таким образом, каждый может предложить свое обновление и открыто обсудить его преимущества и недостатки (рис. 5.15).

![Рисунок 5.15 – Обновление протокола в децентрализованной системе](/resources/img/volume-1/5.3-limitations-of-blockchain-technology-and-its-application-challenges/5.15-protocol-update.png)

Однако коллективное управление всегда сложнее, чем единоличное, потому что людям сложно достигать единогласия быстро. Решение в такой системе принимается всегда медленнее, так как участникам нужно время, чтобы договориться.

### Распределенная ответственность

На пути к практическому внедрению децентрализованных технологий особняком стоит неготовность общества к принятию следствий децентрализованного подхода. Неготовность состоит в том, что мы привыкли видеть конкретного человека, который за что-то отвечает. Так происходит в системе централизованного управления, которая стала для нас традиционной.

Когда вы обслуживаетесь в определенной организации, то в случае возникновения недоразумений вы связываетесь с ее представителями и выясняете, в чем дело. Например, когда вы приобрели машину, а через неделю она перестала заводиться, вы обращаетесь в компанию, где вы ее купили, и добиваетесь возмещения средств. Иначе (если не удается добиться возмещения) вы обращаетесь в суд, который удовлетворит ваши требования в законном порядке, принудив компанию вернуть деньги и возместить ваш ущерб. В любом случае вы находите «крайнего», то есть того, кто ответственный за принятое решение.

Если в случае управляющего центра ответственность четко определена, то в случае распределенной системы ответственность обретает несколько размытое значение. Здесь более уместно заменить слово ответственность на риск, потому что именно риски несут участники. Гарантией корректной работы системы являются правила, по которым она функционирует, и они известны всем участникам. Каждый может проверить действия остальных на предмет соответствия правилам работы протокола.

Эти риски проявляются либо в поведении самих пользователей, либо в уязвимостях, через которые можно повлиять на правила: атаки на тот же протокол. В последнем аспекте децентрализованная система куда устойчивее централизованной. В по-настоящему децентрализованной системе ни один участник, в том числе разработчик, не способен провести изменения единолично. Поэтому никакой суд не может реализовать решение, тем более противоречащее правилам работы протокола. Чтобы изменить состояние системы, нужно согласие большинства участников, достигнутое без нарушений правил, которые были установлены заранее.

Здесь требуется другая модель законодательного подхода: нужны новые юридические модели и, возможно, законодательная база, которая будет предусматривать существование таких систем. Таким образом, до определенного момента обязательства по обеспечению безопасности и соблюдению некоторых требований возлагаются на создателей этой системы, а после него ответственность переходит на сторону пользователя, который согласился с правилами и принял возможные риски.

### Обновление протокола

Еще одна немаловажная особенность децентрализованных систем состоит в подходе к обновлениям. Когда появляется предложение по улучшению правил работы системы, оно может встретить как единогласное принятие, так и разногласия среди участников. Иначе говоря, мы наблюдаем проблему governance в действии.

Если эти разногласия довольно серьезные, то дело может закончиться форком, то есть разделением цепочки блоков и появлением новой системы на базе старой, но с другими правилами.

Так было с Bitcoin в 2017 году, когда появился его форк – Bсash. Было предложено увеличить размер блока в сети Bitcoin с 1 MB до 8 MB с целью повышения пропускной способности. Участники, поддержавшие предложение, обновили свое программное обеспечение и стали работать по новым правилам. Таким образом, получилось две системы: Bitcoin, участники которой продолжили работать по старым правилам (с блоком размером 1 MB), и Bсash, блоки которой уже имели размер 8 MB (детальнее в 6.1).

В качестве другого примера можно привести ситуацию с Ethereum. В 2016 году злоумышленники похитили монеты ether, что составляло около около 60 млн долларов США, инвестированных в проект DAO, который разрабатывался на платформе Ethereum [86]. Команда разработчиков решила вмешаться и провела обновление протокола, в котором сделала откат (rollback) системы и отозвала смарт-контракты, которые были задействованы в похищении ввиду наличия уязвимости. В итоге, все средства вернулись на баланс проекта. Но не все оценили такой ход положительно. Противники этого обновления и вызванного ним форка продолжили работать в старой системе, которую назвали Ethereum Classic, а поддержавшие откат стали работать в новой – Ethereum.

### Итоги

Правильно внедренная технология блокчейн может обеспечить прозрачную бизнес-модель и доступность автоматизированного аудита. При вовлечении в партнерские отношения компания получает дополнительные перспективы развития бизнеса, так как доверие пользователей к такой системе будет увеличиваться. Однако на пути к воплощению этой идеи стоит череда сложностей, которые нужно учесть и преодолеть: сложность проектирования, настройки и поддержания децентрализованной учетной системы, как правило, намного выше, чем для централизованных альтернатив.

Чтобы говорить о применении blockchain в реальной экономике, нужно создать условия для практической реализации. Для этого нужно цифровизовать большинство процессов взаимодействия в обществе, определить стандарты идентификации личности в цифровом пространстве, подготовить законодательную базу для решения проблем с ответственностью.

[РАЗВИТИЕ ДЕЦЕНТРАЛИЗОВАННЫХ ТЕХНОЛОГИЙ](https://github.com/distributed-lab/blockchain-and-decentralized-systems-book/blob/main/chapters/volume-1/ru/6-development-of-decentralized-technologies.md)