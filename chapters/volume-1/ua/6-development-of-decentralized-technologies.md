# 6 РОЗВИТОК ДЕЦЕНТРАЛІЗОВАНИХ ТЕХНОЛОГІЙ


## 6.1 Відгалуження та клони Bitcoin

Як поміж дикими тваринами, так і поміж освіченими людьми розбіжності завжди існували в цьому світі. Якщо думки людей фундаментально розбігаються, вони більше не можуть ефективно взаємодіяти, обмінюватися інформацією й узгоджувати її: розбіжності не дозволяють сформувати якесь однозначне твердження.

Поміж учасниками мережі Bitcoin також можуть виникати суперечності. Через те, що спільноти по-справжньому децентралізованих систем відкриті та можуть складатися з учасників із цілковито різною освітою, інтересами та цілями, у таких суперечках навіть Мухтар і комісар Рекс можуть сміливо відстоювати право на реалізацію своїх потреб та інстинктів (рис. 6.1). У цій темі ми розглянемо поняття *форків*, а також трохи торкнемося теми *спланованих розділень*, які можуть відбуватися у відкритих спільнотах.

![Рисунок 6.1 – Розбіжності між членами спільноти](/resources/img/volume-1/6.1-bitcoin-forks-and-clones/6.1-disagreements.png)

Коли говорять про форк у контексті криптовалют, можуть мати на увазі одне з двох різних значень.

*Форк* (перше значення) – *це процес клонування вихідного коду деякої криптовалюти до нового репозиторію*. За цього команда розробників запускає нову валюту з нуля: формується новий genesis block, розгортається нова мережа з нових вузлів і користувачів.

Приклади таких форків – цифрові валюти, як-от Litecoin, Dash, Peercoin, Bytecoin і ZСash (їх ми вже згадували в попередніх темах і ще згадуватимемо в наступних).

*Форк* (друге значення) – *це процес появи декількох блоків на одній висоті ланцюжка*. Такі форки можуть бути як випадковими, так і спланованими. Цей випадок найцікавіший; розгляньмо його докладніше.

### Сплановані форки

Деякі вузли можуть навмисно модифікувати правила формування блоків і надалі працювати в межах однієї цифрової валюти. Але якщо водночас порушити правила протокола, то можуть з’явитися розбіжності щодо продовження ланцюжка чи навіть щодо блоків, що були створені у минулому. Це може стати ще однією причиною появи декількох блоків на одній висоті.

Уявіть безліч вузлів, які за взаємодії утворюють мережу Bitcoin. Вони працюють за однаковими правилами досягнення консенсусу та ведуть одну історію транзакцій, яку записано до спільної для всіх послідовності блоків, як зображено на рис. 6.2.

![Рисунок 6.2 – Ведення історії транзакції з боку кожного вузла мережі](/resources/img/volume-1/6.1-bitcoin-forks-and-clones/6.2-maintaining-txs-history.png)

Є спеціальний репозиторій Bitcoin, у якому можна задокументувати та розмістити свою пропозицію щодо покращення роботи протоколу Bitcoin (BIP) [87]. Після того, як пропозицію опубліковано в репозиторії, на відповідних форумах спільнота найактивніших користувачів веде дискусії про доцільність, безпеку тощо. Решта учасників спільноти стежить за дискусіями та роблять висновки, після чого чи приймають, чи відхиляють пропозицію щодо покращення.

Хтось зі спільноти пропонує внести зміни до протоколу, які, припустимо, збільшать пропускну здатність і рівень конфіденційності користувачів. Частина спільноти вважає, що пропозицію дійсно варто прийняти, а для інших учасників її доцільність не очевидна.

Варто відзначити, що в децентралізованих системах, хоча й існує деяка відкрита спільнота, члени якої найчастіше найкомпетентніші у відповідних технічних та організаційних питаннях, влади вона не має. Кінцеве рішення учасники приймають самі незалежно один від одного (рис. 6.3).

![Рисунок 6.3 – Оновлення протоколу з боку частини учасників мережі](/resources/img/volume-1/6.1-bitcoin-forks-and-clones/6.3-particular-protocol-update.png)

Таким чином, якщо власники частини повних вузлів (передусім це стосується вузлів-валідаторів) сумніваються стосовно встановлення цього оновлення, то вони, імовірно, не стануть ризикувати та надалі працюватимуть за старими правилами.

Відповідно, усю мережу може бути розділено на дві підмережі: одні користувачі оновлять програмне забезпечення та чекатимуть, коли оновлення набуде чинності, а інші не поспішатимуть оновлювати чи взагалі не стануть цього робити. Коли оновлення стане чинним, одні вузли матимуть свої правила формування та перевірки блоків і транзакцій, а інші вузли – свої. На цьому ґрунті можуть виникати конфлікти, оскільки на одній висоті генеруватимуть блоки за різними правилами.

Один із варіантів розвитку подій полягає в тому, що звичайні вузли мережі можуть не приймати блоки, які сформували вузли мережі з оновленим програмне забезпечення. У результаті одні починають будувати нову версію ланцюжка, а інші надалі будують стару (рис. 6.4).

![Рисунок 6.4 – Розділення мережі на дві через різні правила роботи](/resources/img/volume-1/6.1-bitcoin-forks-and-clones/6.4-network-division.png)

Вище описано приклад проблеми, на яку може натрапити спільнота протягом оновлення програмного забезпечення. Звернімо ж увагу на те, як саме відбувається це оновлення.

### Методи оновлення ПЗ: softfork і hardfork

Можна виокремити два методи оновлення програмного забезпечення: softfork і hardfork. Фактично, обидва методи – оновлення протоколу, що полягають у зміні деяких правил формування та перевірки транзакцій, а також блоків. Такі оновлення можуть бути зворотньо сумісними, а можуть не передбачати цієї сумісності. Розгляньмо це детальніше.

*Softfork* – зміна протоколу, за якої оновлені правила більш пріоритетні, а раніше дійсні блоки та транзакції все ще підтримуються вузлами з оновленим ПО, але вважаються застарілими. Складно переоцінити значення сумісності при оновленні протоколу. Як приклад із повсякденного життя можливо навести розробклення оновлень для популярних стандартів USB та HDMI. Під час їх розроблення надвелику увагу приділяють зворотній сумісності оновлених версій зі старими, якими продовжують активно користуватися. Без цієї властивості поширення нових стандартів потрапило би в безвихідь, позаяк перехід на нову версію всіх сторін – це процес, що займає доволі багато часу (протягом якого взаємодія має тривати).

Іншими словами, множина допустимих блоків і транзакцій звужується після оновлення. Оскільки вузли зі старою версією ПЗ розпізнаватимуть нові блоки як дійсні (рис. 6.5), *softfork* зворотньо сумісний. Щоби *softfork* відбувся без розділення мережі, має бути оновлено вузли, що контролюють більшість її обчислювальної потужності.

![Рисунок 6.5 – Оновлення протоколу типу softfork](/resources/img/volume-1/6.1-bitcoin-forks-and-clones/6.5-protocol-update.jpg)

*Hardfork* – зміна протоколу, яка робить раніше недійсні блоки та транзакції дійсними. Тому hardfork вимагає, щоб **усі** вузли оновили ПЗ, щоб уникнути роздвоєння ланцюжка. Це може бути впровадження нових форматів даних, нові правила верифікування. Відповідно, блок, який генеруватиме старе ПЗ, не підтримуватиме нове та навпаки. Очевидно, що у разі hardfork можливі два наступні результати: оновлюються всі вузли та формування ланцюжку продовжується за новими правилами; думки учасників розбігаються та ланцюжок розгалужується, а спільнота розколюється на групи, кожна з яких працює згідно зі своїм протоколом (рис. 6.6). 

![Рисунок 6.6 – Оновлення протоколу типу hardfork](/resources/img/volume-1/6.1-bitcoin-forks-and-clones/6.6-hardfork.jpg)

До цього мова йшла про сплановані форки. Проте існують й інші ситуації, у яких форк необхідний та провести його потрібно швидко. Наприклад, одного разу в протоколі Bitcoin було знайдено критичну вразливість, і впродовж невеликого проміжку часу довелося провести незапланований softfork. Далі розглянемо цей випадок детальніше.

### Незапланований softfork у Bitcoin

15 серпня 2010 року в одному з блоків бази даних Bitcoin було виявлено транзакцію, що містила велику кількість монет невідомого походження, відправлену на декілька адресів [88]. Показово, що ці монети не було добуто за допомоги майнінгу. Це сталося не за правилами, закладеними до протоколу, і весь графік емісії повністю було порушено. Транзакція мала один вхід і два виходи. Кожний із цих виходів відправляв по 92 млрд біткоінів на кожну адресу (за того, що максимальна емісія монет Bitcoin має обмеження приблизно 21 млн). Як же це сталося?

Хтось знайшов уразливість у програмному коді: виходи транзакцій не перевіряли окремо, а перевіряли умову, що сума монет на виході не перевищує суму монет на вході. Далі цей користувач підібрав такі значення для кожного виходу, що при складанні вони переповнювали цілочисельний тип даних int. Вийшло, що величезні кількості монет кожного виходу було перетворено на маленьку суму, яка проходила  перевірку, і транзакція ставала валідною.

Коли було виявлено цю транзакцію, на форумі створили окрему тему та запропонували вирішити цю проблему за допомоги softfork. Користувачам запропонували змінити код програмного забезпечення та вручну внести перевірку для кожного виходу транзакції. Тим, хто не міг зробити все самостійно, було запропоновано тимчасово зупинити майнінг і почекати на готовий виконуваний файл із новим програмним забезпеченням.

Вузли з новим програмним забезпеченням стали генерувати нові блоки, почавши з тієї висоти, де ще не було блока з «поганою» транзакцією. Вузли, не повідомлені про цю подію, продовжували ланцюжок блоків із критичною транзакцією. Поступово кількість вузлів із оновленим програмним забезпеченням зростала, і з часом вони стали контролювати більшість обчислювальної потужності. Їхній чесний ланцюжок став довшим, і на нього перейшли неоновлені вузли. Винагороду, що була отримана внаслідок майнінгу в ланцюжку з некоректною транзакцією, за переходу на «правильний» ланцюжок було втрачено.

У цьому випадку спрацював соціальний консенсус: усі розуміли необхідність провести оновлення та підтримали його. Проте так стається не завжди, особливо коли форк *спланований*. У прикладі нижче соціальний консенсус не спрацював.

### Поняття спланованих форків

Поява спланованих форків цілком обґрунтована. Як приклад можливо навести випадок із Ethereum, коли частина спільноти вирішила оновити протокол, змінивши попередню історію блоків, щоби штучно вплинути на кінцевий стан децентралізованої облікової системи. А інша частина спільноти не підтримала цього оновлення та зберегла оригінальні правила протоколу, щоби підтримувати децентралізовану облікову систему відповідно до початкових принципів; ця система отримала назву Ethereum Classic. А Ethereum так і залишився першим із найвідоміших випадків спланованих форків, де було порушено засади незмінюваності історії формування кінцевого стану бази даних.

У 2016 році зловмисники здійснили успішну атаку на децентралізовану організацію The DAO. Ця компанія працювала на платформі Ethereum, і її основною ідеєю було створення повноцінної організації без застосування ієрархічної моделі управління. Було знайдено та проексплуатовано вразливість у вихідному коді. До того, як уразливість усунули, зловмисникам вдалося перевести на свій рахунок монети ether вартістю, еквівалентною $60 млн.

Оскільки постраждало багато користувачів і атака була найзначнішою з усіх попередніх, деякі члени спільноти Ethereum запропонували відкатити ланцюжок блоків до моменту, коли вразливість іще не було використано. Проте пропозицію підтримали не всі, і спільнота розділилася в поглядах: одні вважали, що стан смарт-контрактів потрібно перерозподілити, а інші сказали, що це суперечить принципам децентралізації, та не підтримали цю ініціативу. У підсумку, спільнота розділилася на дві групи, кожна з яких спиралась на свою ідеологію.

Оновлення було випущено. Одні вузли було оновлено, з іншими цього робити не стали. Мережа розділилася на дві групи вузлів, і з ланцюжка блоків, відповідно, було утворено дві гілки, що розвиваються паралельно. Відбулося клонування вихідного коду протоколу та зміна деяких правил, а також роздвоєння ланцюжка блоків і розкол мережі, які є наслідком того, що учасники спільноти не досягли згоди.

### Приклади спланованих форків Bitcoin

Звернімо увагу на випадки, коли були великі роздвоєння блокчейну Bitcoin. Один із них – Bitcoin Cash, коли було здійснено hardfork – оновлення протоколу з метою зміни базових параметрів. Деякі активні учасники спільноти запропонували підвищити пропускну здатність мережі через збільшення розміру блока. Проте далеко не всі у спільноті були згодні, що це оптимальний шлях. Багато хто віддав перевагу активації Segregated Witness, але хтось усе одно наголошував на альтернативних варіантах підвищення пропускної здатності.

Ті учасники спільноти, хто підтримали збільшення розміру блока, оновили програмне забезпечення і стали працювати над паралельною гілкою ланцюжка блоків. Це означає працювати фактично з альтернативною валютою.

Спланований форк Bitcoin Cash стався влітку 2017 року. Після розділення ланцюжка блоків Bitcoin та появи Bitcoin Cash у певний момент виявилося, що прибутковість майнінгу в альтернативному ланцюжку вища, ніж у основному. Звісно, деякі валідатори вирішили переключитися на формування блоків для облікової системи Bitcoin Cash усупереч тому, що насправді вони не підтримують ідею форка та вважають великі блоки «великим злом».

> **_Зауваження._** *Великі блоки проблемні не в контексті вирішення розбіжностей серед учасників системи, а з погляду архітектури: зі збільшенням розміру блоку конкуренція за місце у блоці зменшується, унаслідок чого це місце використовується менш ефективно (наприклад збільшується кількість спаму).*

Як же це вплинуло на частоту генерування блоків? Припустимо, що володільці 50% обчислювальної потужності в мережі Bitcoin переключили своє обладнання на підтримування іншої мережі. Тоді середній період формування блока в ланцюжку Bitcoin став дорівнювати 20 хвилинам. Відповідно, підтвердження транзакцій стало довшим, і пропускну здатність мережі було зменшено вдвічі. Така ситуація триватиме, доки не відбудеться перерозрахунок параметра складності.

Однак останні дослідження мережі Bitcoin Cash показують, що вона має високий рівень централізації. Анонімна група BitPico на підставі проведених досліджень стверджує, що більшість активних вузлів пов'язані один з одним. Після проведеного стрес-тесту виявилося, що 98% повних вузлів Bitcoin Cash розташовано в одній серверній шафі [89]. Метою команди було продемонструвати, наскільки насправді мережа Bitcoin Cash централізована, що загрожує стабільності роботи цієї цифрової валюти.

До певного моменту в мереж Bitcoin Cash і Bitcoin була спільна історія, але після форку для кожної пріоритетним став свій ланцюжок зі своїми правилами.

Схожим чином з'явився форк Bitcoin Gold. Його спільнота підтримує інший алгоритм майнінгу, що має більше децентралізований характер.

Форк під назвою SegWit2x було заплановано дуже давно. Його прибічники хотіли збільшити розмір блока вдвічі й одночасно реалізувати підтримку Segregated Witness. Коли зрозуміли, що це спричинить розкол спільноти, відмовилися його впроваджувати.

В усіх випадках механізм досягнення консенсусу залишається один і той самий – proof-of-work. Проте геш-функції, які використовують для гешування заголовків блоків за вирішення задачі proof-of-work, різні. У Bitcoin і Bitcoin Cash застосовано геш-функцію SHA-2 на довжині 256 біт (звідси можна здогадатися, що майнити валюту в обох випадках можна на спеціалізованих чіпах). У Bitcoin Gold реалізовано геш-функцію, що використано в ZCash – EQUIHASH. Її було спеціально розроблено так, щоби найбільш енергоефективні для обчислень були графічні процесори.

Щоби підлаштовувати частоту формування блоків, є параметр складності ресурсоємної задачі, який оновлюють із визначеною періодичністю. У протоколі Bitcoin цей період часу приблизно дорівнює двом тижням; у протоколі Bitcoin Cash – двом тижням плюс EDA (emergency difficulty adjustment). EDA – це деякий проміжок часу, потрібний для захисту від розгойдування параметра складності. Це розгойдування може бути вигідним валідаторам, але незручним для користувачів, тому що час підтвердження транзакцій різко змінюється що дві тижні. У Bitcoin Gold цей параметр оновлюють із кожним новим блоком. Оновлення SegWit підтримують усі перераховані форки, крім Bitcoin Cash.

**Часті запитання**

*– Чи Litecoin вважають форком Bitcoin?*

Так, авжеж. Знову ж, ми розглянули дві різних суті, які можна прив'язати до поняття форка. Перша – це копіювання вихідного коду проекту та окреме його підтримання: окрема мережа та нова база даних. Виходить нова валюта з новими параметрами. Й інша суть – це відгалуження самого блокчейна. Ось Litecoin – це форк у першому значенні.

*– Чи форк SegWit2x – те саме, що технологія Segregated Witness?*

Ні. І правильно казати, до речі, пропозиція щодо оновлення, яка має на увазі форк. Її було запропоновано до того, як у серпні 2017 року в Bitcoin було додано підтримку Segregated Witness. А після цього проводити ще один форк зі збільшенням розміру блока було недоцільно.

*– Що відбувається в разі softfork із транзакціями з «поганого» ланцюжка після того, як «добрий» обгонить його?*

Якщо вони не конфліктують із транзакціями в основній мережі, то їх буде додано до основного ланцюжка, оскільки валідатори зацікавлені знайти їх і забрати собі комісію.

*– Який максимальний розрив був між «поганим» і «добрим» ланцюжком? Чи було більше за шість підтверджень, що, фактично, значить повне підтвердження транзакцій? (Запитання стосовно softfork у 2010 році.)*

У цьому разі вразливість було знайдено вручну та спрацював соціальний консенсус. Дійсно, ті, хто знали про цю проблему, могли скористатися нею та зробити подвійну витрату. Ті, хто не знав, могли стати жертвою. Однак транзакції з «поганого» ланцюжка, що не конфліктували, було додано до «доброго» ланцюжка, а монети, отримані нізвідки, не було розповсюджено далі.

*– Чи Dogecoin – це також форк Bitcoin?*

Так, у тому сенсі, що було скопійовано вихідний код. Було змінено деякі параметри. Проте зміни стосувалися не механізму досягнення консенсусу, а правил формування ланцюжка блоків: частоти формування блока, максимального розміру блока тощо.

*– Як нараховують монети у форках Біткоіна?*

Якщо, наприклад, ви мали монети в Bitcoin до настання форка, то ви автоматично отримуєте пропорційну кількість монет і в альтернативній гілці. У програмному коді задається висота блока, після якої набувають чинності альтернативні правила.

*– Чи можливо стати членом спільноти Bitcoin?*

Так, звісно, ви можете стати членом спільноти Bitcoin, щоби впливати на рішення щодо розвитку Bitcoin, пропонувати нові оновлення та технологічні новітності.

## 6.2 Альтернативні цифрові валюти та токени

Частину підходів до децентралізації, розглянутих у цій книзі, було чи вперше запропоновано, чи вперше протестовано в Bitcoin. Однак те, що вже реалізоване та працює, не межа можливостей інженерів або професійних розробників і не межа мріянь звичайного користувача й поготів. Є багато людей із намірами протестувати більш інноваційні механізми, але не кожний із них можна просто та швидко впровадити до Bitcoin.

Так виникла аж низка альтернативних валют, деякі з яких ми стисло розглянемо нижче, щоб ознайомитися з основною суттю їхніх інновацій. Серед них – Litecoin, Dash, NXT, BitShares, Monero, Ethereum, Cardano, Ripple, Stellar і ZCash. Але насамперед слід розібрати поняття криптовалюта.

### Що таке криптовалюта?

*Криптовалюта (cryptocurrency) – це незалежна цифрова валюта, у якій децентралізовано управління такими процесами: емісія монет, підтвердження транзакцій, зберігання даних, аудит облікової системи та прийняття рішень щодо оновлень (governance), – а стати учасником системи може будь-хто охочий*. Також зауважимо, що ціну монети криптовалюти визначає виключно відношення попиту та пропозиції на відповідних торговельних майданчиках.

Саме децентралізація – характерна особливість криптовалюти. Якщо хоча б один із цих процесів відбувається централізовано, то перед вами – не криптовалюта. Така система не буде настільки стійкою та надійною, як децентралізована.

Власне, цікавість до криптовалют і зумовлюють їхні властивості, що дозволяють вільно та надійно здійснювати платежі, уникаючи бюрократичного складника, наприклад, реєстрації й обмеження. Навіть більше, ці валюти цілком стійкі до різноманітних атак і до цензури.

Кожний користувач криптовалюти може здійснити аудит усіх транзакцій. Для цього не потрібно отримувати жодних дозволів від когось. Те саме стосується підтвердження нових транзакцій. Таким чином, ні для створення нових транзакцій, ні для їх підтвердження користувачам не потрібно проходити процедуру ідентифікації (KYC).

> **_Зауваження._** *KYC (Know Your Customer) – це процедура, що проводить організація для верифікування осіб клієнтів і коректного початку взаємодії з ними.*

Для криптовалюти характерна повністю децентралізована емісія. Нові монети у системі мають з'являтися згідно з визначеним алгоритмом, на якому базується внутрішня монетарна політика.

Варто згадати про голосування за оновлення протоколу та про участь у прийнятті рішень, оскільки в умовах децентралізації це ключовий нюанс, що визначає вдосконалення валюти. Чим більше учасників можуть запропонувати свої покращення, тим більше шансів провести оптимальне оновлення протоколу.

Цілком очевидно, що властивості криптовалюти може бути досягнуто тільки за умови відкритої специфікації протоколу, його реалізації з відкритим вихідним кодом і за наявності доволі великої відкритої спільноти.

### Litecoin

Огляд альтернативних монет почнемо з Litecoin (рис. 6.7). Це одна з найстаріших криптовалют, що з'явилася ще в 2011 році. Валюту створено на основі вихідного коду Bitcoin, але з деякими змінами. Цільовий період формування блока було скорочено у чотири рази (до 2,5 хвилин), що спричинило збільшення підсумкової емісії монет учетверо.

![Рисунок 6.7 – Litecoin](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.7-litecoin.png)

Litecoin використовує геш-функцію *script* для доказу виконання роботи. Ця геш-функція використовує SHA-256 як підпрограму, покладаючись на велику кількість арифметичних обчислень, але також вимагаючи наявності швидкого доступу до великих обсягів пам'яті, що робить створення інтегральних схем спеціального призначення (ASICs) менш вигідним. Незважаючи на те, що Litecoin має мало принципових відмінностей від Bitcoin, він знайшов свою аудиторію та спільноту, що його підтримує. Завдяки цій підтримці Litecoin зайняв досить сталу позицію.

### Dash

Наступна криптовалюта має назву Dash (рис. 6.8). Проєкт цієї валюти було запущено в 2014 році. Особливість протоколу – скорочення періоду генерування блока та, відповідно, підвищення пропускної здатності. Як алгоритм гешування для PoW застосовується X11, який спочатку дозволяв енергоефективно вирішувати ресурсоємну задачу на графічних процесорах, але пізніше для цих цілей усе-таки спроєктували та випустили спеціалізовані чіпи (ASICs).

![Рисунок 6.8 – Dash](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.8-dash.png)

Dash підтримує технології *PrivatSend* й *InstantSend*. Перша з них – це технологія *перемішування* (*mixing*) монет, інакше кажучи, технологія заплутування історії походження монет. Проєкт Dash пріоритетною задачею зробив підвищення конфіденційності користувачів. Для цього було реалізовано модифікацію підходу *CoinJoin*. Цей підхід передбачає об’єднання кількох платежів в одній спільній транзакції, яка змішує монети та позбавляє можливості відстежити однозначну історію їхнього походження.

На прикладі це має такий вигляд: чотири особи поклали гроші до спільного сейфа, потім незалежно один від одного прийшли та забрали з цього сейфа ту саму суму грошей. Стороння людина ніколи не дізнається, яка доля кожного в цій спільній сумі та які саме банкноти кому належать.

InstantSend – це технологія миттєвих платежів, де отримувачу не потрібно очікувати на підтвердження транзакції; її додавання до блоку основного ланцюжку гарантовано (у разі відповідності транзакції правилам протоколу).

Досягнення консенсусу в Dash також має свої особливості: опції PrivatSend й InstantSend реалізовано за допомоги так званих *masternodes* – окремої групи валідаторів, які досягають консенсусу між собою [90]. Кожний вузол може стати masternode. Потрібно тільки мати певну кількість монет на адресі. Ці монети буде заморожено та використано як депозит.

Управління змінами (governance) в Dash має свої особливості. На розвиток проєкту йде 10% від загального доходу за майнінг, 45% іде звичайним вузлам, а решта 45% – masternodes. Управління бюджетом на розробку протоколу Dash здійснено за допомогою голосування masternodes. Таким чином, усі пропозиції розробників щодо покращення протоколу (підвищення якості мережі, пропускної здатності) можуть приймати чи відхиляти тільки masternodes. Однак вважати систему повністю децентралізованою не можна, оскільки управління покращеннями проєкту не залежить від звичайних учасників системи. Кожний користувач системи може пропонувати свої проєкти з її покращення, які надалі може бути профінансовано. Відбувається фінансування доволі просто: користувачу потрібно залишити *заявку* (*treasury*) з пропозицією ідеї, за яку можуть проголосувати володільці masternodes.

### Відмінність алгоритмів майнінгу Litecoin, Dash і Bitcoin

Зауважимо, що розглянуті вище альткоіни відрізняються від Bitcoin алгоритмами гешування, що й визначає той факт, що майнери, призначені для видобутку біткоінів, неможливо використовувати для видобутку альтернативних цифрових валют (за винятком збігу алгоритму гешування, формату заголовка блока та деяких інших деталей). Основна мета таких заходів – досягнення умов, за яких валідатори Bitcoin не могли б атакувати мережу Litecoin, Dash або будь-якої іншої криптовалюти. Іншими словами, окремі валюти намагаються використовувати унікальний алгоритм майнінгу, щоб унеможливити проведення атаки 51%.

Уявімо, що швидкість гешування (hash rate) мережі Litecoin складає 10% порівняно з Bitcoin і обидві валюти використовують однаковий алгоритм вирішення задачі для створення блока. Тоді валідатори Bitcoin могли би легко переключитися на мережу Litecoin і швидко побудувати альтернативний ланцюжок, що міг би істотно перевищувати за довжиною основний. Це уможливило би проведення атаки подвійного витрачання. Чим більшу потужність спрямовують на створення ланцюжка, тим швидше його створюють. Це особливо актуальне на ранніх етапах розвитку мережі, коли вона ще не має в розпорядженні великої обчислювальної потужності. 

### NXT

Перейдімо до ще однієї незалежної цифрової валюти – NXT (рис. 6.9). Її запустив у 2013 році анонімний розробник. Платформа використовує механізм досягнення консенсусу на основі proof-of-stake. NXT від самого початку було задумано як гнучку платформу, що надає можливість реалізовувати різні фінансові прикладні програми та послуги.

![Рисунок 6.9 – NXT](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.9-nxt.png)

Інфраструктура платформи NXT доволі складна порівняно з Bitcoin. Особливість платформи – наявність внутрішньої біржі цифрових активів і системи обміну повідомленнями [91]. Емісію було проведено централізовано й одного разу. Система NXT дозволяє кожному користувачу створювати та емітувати власні токени для подання та здійснення обліку будь-яких активів або зобов’язань. Цими токенами можна торгувати на внутрішній біржі NXT.

Обмін повідомленнями дозволяє відправляти звичайні чи зашифровані повідомлення та забезпечити зберігання даних до 1 кБ у спільній базі даних на постійній основі та до 42 кБ протягом обмеженого часу.

Через обмеження платформи можливо виокремити доволі низьку пропускну здатність (4–5 транзакцій на секунду), а також час підтвердження транзакції від 10 до 15 хвилин.

### BitShares

Ідею протоколу BitShares було озвучено в 2013 році; вона полягає у створенні інструменту, за допомогою якого можливо було би торгувати різними активами та валютами в децентралізованому середовищі, фактично не депонуючи їх на торговельний майданчик (рис. 6.10).

Платформа BitShares дозволяє будь-кому створювати user issued assets (UIA), або цифрові токени. Таким чином, платформа здійснює облік базової валюти, тобто криптовалюти BitShares (BTS), і багатьох користувацьких токенів.

![Рисунок 6.10 – BitShares](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.10-bitshares.png)

Крім цього, BitShares позиціонує себе як платформа смарт-контрактів. Щоправда, тут смарт-контракти попередньо встановлені та їхня кількість обмежена (реалізовано найпопулярніші контракти), але вони більш енергоефективні та, відповідно, виходять дешевшими в контексті комісій.

Ще одна особливість платформи – підтримка платежів із підвищеним рівнем конфіденційності користувачів. У BitShares ця технологія має назву stealth transfers.

### Monero

Проєкт криптовалюти Monero (рис. 6.11), у якій основний акцент зроблено на підвищенні рівня конфіденційності користувачів, з'явився в 2014 році як форк Bytecoin. Bytecoin було анонсовано в 2014 році, і його позиціонували як проєкт, що реалізує анонімну платіжну систему. Частина спільноти занепокоїлася, коли було виявлено, що 80% монет Bytecoin (BCN) було вже видобуто [92]. У цього вбачали невтішні перспективи: для винагородження валідаторів, що займаються видобутком монет, залишалося близько 20% передбаченого обсягу емісії, а наявність великої кількості монет у ранніх учасників ставило під загрозу ціну валюти BCN, оскільки вони тепер могли маніпулювати ринком. Тому частина спільноти вирішила створити свій проєкт – Monero.

Monero працює за правилами, визначеними в протоколі CryptoNote [93], і дозволяє здійснювати анонімізування трафіку на мережевому рівні, приховувати походження монет у кожній транзакції, приховувати суми платежів від сторонніх спостерігачів, а також приховувати зв’язок між ідентифікаторами користувачів і адресами, до яких фактично прикріплені монети.

![Рисунок 6.11 - Monero](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.11-monero.png)

На рівні моделі транзакції реалізовано механізм заплутування історії походження монет, який взагалі не використовує третю сторону. На відміну від Dash, де в ролі міксеру виступає конкретний сервер або група серверів, у Monero відбувається перемішування монет за спеціальними схемами з застосуванням криптографічних алгоритмів. Створюється транзакція, до якої поміщаються монети, а далі запускається каскад переказів; зрештою монети надходять на вказану адресу. Історія переказів виходить такою заплутаною, що визначити адресу відправника практично неможливо.

Такий механізм використовує *кільцевий підпис (ring signature)*. Його суть полягає в тому, що той, хто відправляє монети, сам формує групу адрес, серед яких буде приховувати перекази. Він створює транзакції та підписує їх від імені групи без згоди решти членів цієї групи. У Monero також реалізовано механізм confidential transactions [94], який приховує ще й суму транзакції (ззовні її неможливо визначити). Проте оскільки розмір групи обмежено, імовірність відстеження транзакції ненульова (складність відстеження безпосередньо залежить від розміру групи).

Щодо анонімізування трафіку на мережевому рівні в Monero реалізовано оптимізовану версію протоколу I2P (Invisible Internet Project) [95], який є більш досконалий порівняно з Tor.

Генерування блоку в системі займає приблизно дві хвилини, а повне підтвердження транзакції – до 30 хвилин.

### Ethereum

Особливість Ethereum полягає у підтримці програмованої цифрової валюти (рис. 6.12). Ethereum можливо назвати по-різному: хтось називає платформою смарт-контрактів, хтось – децентралізованим комп'ютером. Облікова система має базову валюту *ether*.

![Рисунок 6.12 – Ethereum](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.12-ethereum.png)

Емісію в Ethereum не обмежено верхньою межею. Кожного року з'являється 18 мільйонів нових монет, тобто інфляція нескінченна та постійно зменшується. Період генерування блоку становить 10–20 секунд. Зараз алгоритм досягнення консенсусу в Ethereum – proof-of-work, але обговорюють можливість переходу на proof-of-stake.

Кожну здійснювану в мережі транзакцію можуть виконувати згідно з деякими правилами, які учасники завчасно визначають.

Наприклад, Аліса пересилає монети Бобу. Вона ставить умову, у якій обумовлено можливість настання якихось додаткових подій. Якщо ці події настають, то валідатори цю транзакцію підтвердять. Якщо в Bitcoin є тільки одна умова – коректний цифровий підпис, то в Ethereum можливо вказати будь-які потрібні умови. Можливо вказати також джерела зовнішніх даних. Функцію постачання їх до мережі покладено на так званих *оракулів (oracles)*. Суть їх застосування можливо пояснити емпірично.

Припустімо, потрібно створити *смарт-контракт* (докладніше в 6.3), який страхуватиме пшеничне поле на випадок пожежі та реалізовуватиме виплату компенсації володільцю за втрачений врожай. Кілька власників формують спільний страховий бюджет, що поділять між собою постраждалі внаслідок пожежі, якщо вона станеться. Далі керування цим бюджетом відбуватиметься виключно за попередньо описаними у смарт-контракті умовами.

За цього краще використовувати не одного оракула, а кількох, щоби мінімізувати ризик підкупу та змови. Тоді вони незалежно один від одного передаватимуть смарт-контракту дані про пожежі. Кожний із оракулів використовуватиме власні способи стеження: дані супутника, місцеві пункти пожежної безпеки, дані з камер спостереження дронів тощо. Якщо контракт отримує підтвердження пожежі на конкретному полі від більшості попередньо встановлених оракулів, то буде прийнято рішення виплатити страхову суму власнику поля.

Якщо впродовж попередньо встановленого періоду часу пожежа не сталася, то бюджет буде повернено на облікові записи вкладників. Можливо також передбачити, що оракули отримують фіксовану винагороду за свою роботу незалежно від результату.

### Cardano

Проєкт Cardano (рис. 6.13) – це децентралізована платформа смарт-контрактів, які можуть бути запрограмовані за допомогою повних за Тьюрингом мовами. ПЗ повних вузлів мережі реалізовано на функціональній мові програмування Haskell. Як заявляють розробники, їхня платформа використовує доказово стійкий алгоритм досягнення консенсусу, що базується на ідеї proof-of-stake. Алгоритм, що має назву Ouroboros, було розроблено та реалізовано спеціально для застосування в цій децентралізованій обліковій системі.

![Рисунок 6.13 - Cardano](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.13-cardano.png)

Облікова система використовує вбудований механізм голосування для управління змінами. Максимальний обсяг емісії базової валюти платформи становить 45 млрд монет. Одноразову передемісію було здійснено централізовано ще до запуску платформи, а далі емісію здійснювали у формі винагороди учасників за створені блоки.

### Stellar and Ripple

Цифрову валюту Ripple було запущено в 2011 році. Спочатку проєкт мав назву Opencoin, але в 2013 році його було перейменовано в Ripple. Деякі ідеї, закладені в Ripple, з'явилися ще до Bitcoin, а саме в 2005–2006 роках, а принципи роботи знайомі за середньовіковою системою грошових переказів Hawala. Однак уже після появи Bitcoin засновник Ripple вирішив їх упровадити у своєму проєкті.

У засновника Ripple був конфлікт із іншими членами команди, унаслідок якого в 2014 році відбувся форк – Stellar (рис. 6.14). Хоча спочатку код був той самий, Stellar не схожий на форк Bitcoin Cash, який до певного блока має ту саму історію, що й Bitcoin. Stellar почав працювати з окремою історією.

![Рисунок 6.14 - Stellar](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.14-stellar.png)

![Рисунок 6.14 - Ripple](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.14-ripple.png)

Призначення Ripple як системи – створити децентралізовану біржу та механізм розрахунків між сторонами. Усі монети внутрішніх валют в обох системах було випущено та розподілено централізовано. Також користувачі можуть випускати власні активи (IoU) та торгувати ними на децентралізованій біржі.

Основні відмінності цих цифрових валют від Bitcoin полягають у тому, що емісія монет виконується централізовано, механізм досягнення консенсусу базується на FBA, усі валідатори децентралізованої облікової системи не анонімні (навпаки, кожний із них ідентифікований).

### ZCash

ZCash – криптовалюта, основний акцент у функціонуванні якої припадає на забезпечення конфіденційності транзакцій. Результати транзакцій публікують в основному ланцюгу блоків, але деталі, як-от дані відправника, отримувача та сума транзакції, залишають конфіденційними. Криптовалюту було анонсовано в 2016 році (рис. 6.15).

![Рисунок 6.15 - ZCash](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.15-zcash.png)

ZCash – перша у світі криптовалюта, що базується на протоколі *доказу з нульовим розголошенням (zero-knowledge proof)*, що дозволяє користувачам приховувати деталі транзакцій. Архітектура системи ідентична до архітектури Bitcoin. Ключові відмінності – зменшення часу формування та збільшення обсягу блоків (вимушений захід, оскільки транзакції, що використовують докази з нульовим розголошенням, мають значно більший розмір).

Важлива частина функціонування криптовалюти ZCash – механізм під назвою *trusted setup*. Докази з нульовим розголошенням у ZCash базуються на наборі відкритих загальносистемних параметрів, використання яких дозволяє користувачам створювати та перевіряти конфіденційні транзакції на відповідність правилам протоколу. Ці параметри й має бути згенеровано на етапі trusted setup початкового налаштування (за взаємодії шести учасників) [96]. Припускають, що ці шість учасників видаляють матеріал, пов'язаний із проміжним ключем, який залишається після trusted setup (інакше ці учасники можуть змовитися та скомпрометувати транзакції певного користувача). Однак очевидно, що немає способу перевірити, чи дійсно ці дані видалено (наприклад, апаратні пристрої цих користувачів можуть бути модифікованими органами влади).

З особливостей ZCash варто виокремити permissioned аудит транзакцій, що має на увазі, що деталі транзакції можливо бачити, тільки отримавши необхідний дозвіл від сторони, яка безпосередньо сформувала транзакцію. Варто згадати, що 20% усіх видобутих монет автоматично йде на рахунки розробників протоколу.

### Інші цифрові валюти

Для порівняння перерахованих вище цифрових валют між собою ми використали критерії, як-от процес емітування монет й особливості підтвердження транзакцій, аудит транзакцій і процес управління оновленнями. Також було порівняно пропускну здатність систем, час повного підтвердження транзакції та рівень приватності користувачів (табл. 6.1).

![Таблиця 6.1 – Порівняння основних цифрових валют](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/table-6.1-comp.png)

Проаналізувавши, наприклад, базову валюту Ripple (XRP), побачимо, що її емісія та підтвердження транзакцій здійснюють централізовано. Отже, Ripple – це цифрова валюта (а не криптовалюта), тому що не всі процеси в системі відбуваються децентралізовано.

Тепер перейдімо до іншого виду цифрових активів – токенів – і визначимо основні особливості, що допоможуть їх відрізнити від цифрових валют (рис. 6.16).

![Рисунок 6.16 – Класифікація цифрових активів](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/6.16-classification.png)

### Токени

Наприкінці 2016 року почалося різке зростання кількості проєктів, які прагнули запустити власну валюту для фінансування розробки певного сервісу. Найчастіше таку дію було обґрунтовано необхідністю мати мережу, яка би надавала послуги децентралізовано. Серед найвідоміших проєктів – Filecoin, OmiseGo, Steemit, Golem, Basic Attention Token, Bancor тощо. Метою переважної їх більшості не було створення криптовалюти в повному сенсі цього слова, а, скоріше, внутрішнього платіжного засобу, за допомогою якого користувачі могли отримувати доступ до послуг (utility tokens).

Практично всі проєкти такого роду прагнули запустити свою облікову систему, використовуючи технологію блокчейн, однак до того, як це відбувалося, їхні токени випускали на платформі Ethereum та ними торгували на біржах. Після запуску власної облікової системи (для цифрової валюти, платформи смарт-контрактів тощо) ці токени замінювали монетами базової валюти.

Токени відрізняються від монет тим, що їх може бути емітовано як централізовано (під управлінням однієї організації), так і децентралізовано (під управлінням завчасно визначеного алгоритму). Це головна відмінність токенів від криптовалют, де всі процеси децентралізовані.

> **_Зауваження._** *На відміну від цифрової валюти токен – це оцифроване право власності на актив. Він також може бути використаний як платіжний засобу. Суть обмінювання токенів чи оплачування ними інших товарів чи сервісів еквівалентна до суті бартеру.* 

Таблиця 6.2 наочно відображає відмінності цифрових активів за характером здійснення процесів, які відбуваються всередині відповідної облікової системи.

![Таблиця 6.2 – Відмінності між групами цифрових активів](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/table-6.2-dist.png)

### Підсумки

Приведемо визначення криптовалюти, що найбільш точно передає її суть та властивості. *Криптовалюта – це незалежна цифрова валюта, у якій децентралізовано управління такими процесами: емітування монет, підтвердження транзакцій, зберігання даних, здійснення аудиту облікової системи та прийняття рішень про оновлення*. Володіти валютою та здійснювати транзакції може будь-хто, причому на рівних правах із рештою користувачів, а вартість монети не піддається впливу з боку творців.

Опанування правильної термінології необхідно для однозначного сприйняття та подання інформації. У таблиці 6.3 наведено порівняння різних цифрових активів відповідно до основних критеріїв. Вивчення цієї таблиці дозволить вам виділити основні групи активів, а також краще орієнтуватись у багатьох сферах цифрових фінансових технологій.

![Таблиця 6.3 – Порівняння цифрових активів між собою](/resources/img/volume-1/6.2-alternative-digital-currencies-and-tokens/table-6.3-comp.png)

**Часті запитання**

*– У чому полягає принципова різниця між Ripple і Stellar?*

Ripple – комерційна компанія, вона продає свою валюту для отримання прибутку. Stellar зареєстрована як неприбуткова організація, яка продає частину емісії своєї валюти для покриття витрат. Їхні принципи роботи приблизно однакові, але Ripple, передусім, орієнтується на банки, а Stellar – на платіжні системи.

*– Якщо цифрова валюта не реалізує майнінг, то наскільки вона надійна?*

Під надійністю слід розуміти відсутність можливості підробляти транзакції. Ця особливість не залежить від можливості майнити, а визначена в протоколі, де має бути закладено механізм захисту від підтвердження підроблених транзакцій. Перевагою валют, що використовують майнінг на основі PoW, можливо вважати те, що досягнення консенсусу між валідаторами не залежить від окремих осіб, а суб'єктивність прийняття рішень може бути мінімальною.

*– Відомо, що криптовалюта ZCash підтримує два типи адрес, що починаються на «t» та «z» відповідно. У чому полягає різниця між такими адресами?*

Адреси, які починаються з «t», загалом ні в чому не відрізняються від bitcoin-адрес і називаються прозорими. Усі дії з використанням таких адрес прозорі, та їх може бачити кожний користувач мережі.

Адреси, які починаються з «z», містять покращення щодо конфіденційності, які забезпечує використання доказів із нульовим розголошенням. Їх називають shielded addresses (захищені, екрановані адреси).

*– Чи підтримує ZCash multisignature транзакції?*

Так, відкриті адреси в ZCash підтримують multisignature транзакції. Однак shielded addresses на сьогодні ще не підтримують таку функціональність.

*– Чи підтримує BitShares функціонування SPV-вузла?*

Нині BitShares не підтримує функціонування SPV-клієнтів; кожному користувачеві необхідно мати локальну копію бази даних для надійної взаємодії в мережі.

*– Для чого в транзакціях Ethereum ми самостійно задаємо параметр GasLimit? Чи не може бути розраховано його автоматично?*

Параметр GasLimit містить максимальне значення кількості монет, яку користувач готовий витратити на виконання смарт-контракту. Для звичайної передачі монет між користувачами мережі цей параметр розраховано здебільшого автоматично, але в разі смарт-контрактів ситуація відрізняється. Справа в тому, що завчасно дуже складно визначити, чи не зациклиться смарт-контракт (якщо допущено деяку помилку в коді, виконання деяких контрактів може відбуватися нескінченно). Якщо монети з рахунку будуть знімати у міру виконання контракту, тоді користувач ризикує втратити всі свої гроші. Параметр GasLimit дозволяє захиститися від утрати коштів, пов'язаної з виникненням нескінченного циклу. І цей параметр повинен задавати безпосередньо користувач.

*– Чи є реалізація полегшеного вузла для Monero?*

Monero не підтримує функціонування SPV-клієнта. Однак у Monero є реалізація так званого *lightweight wallet*. Особливість функціонування програмного забезпечення такого гаманця полягає в наступному. Ви визначаєте вузол, до якого під'єнуватиметесь і який відстежуватиме ваші транзакції в ланцюжку блоків. Цей вузол знатиме про факт отримання грошей, але суми й адреса відправника для нього буде залишено невідомими. Задля більшої конфіденційності пропонують розгорнути власний повний вузол мережі та підключати до нього свої же lightweight wallets.

*– Що таке masternode у Dash?*

Masternodes відіграють важливу роль в інфраструктурі Dash, дозволяючи забезпечити деякі функції, не доступні (важкодоступні) одноранговим децентралізованим обліковим системам. Фактично, masternode – це комп'ютер, підключений до Інтернету, що виконує такі функції: блокування транзакцій, змішування монет, голосування з питань фінансування мережі та інші. Masternode повинний мати щонайменше 1000 DASH як забезпечення, перебувати в мережі 24 години на добу та мати мінімальні втрати зв'язку.

## 6.3 Вступ до смарт-контрактів

У деякому сенсі ми можемо розглядати технологію blockchain як спосіб дійти згоди щодо минулого. Ця згода ґрунтується на безпеці криптографічних алгоритмів, які захищають цілісність історії транзакцій (подій). Використання смарт-контрактів дозволяє досягти згоди щодо майбутнього завдяки тому, що результат виконання смарт-контракту строго визначений та залежить тільки від заданих умов і вхідних даних. Водночас слід розуміти, що умови задаються до того, як контракт пускається в дію, а вхідні дані може бути визначно пізніше. Варто також зважати на те, що частина умов може не виконуватися, тому всі можливі варіанти його завершення має бути взято до уваги на етапі створення.

З цієї причини смарт-контракти вважають однією з найбільш перспективних технологій, яка має змінити звичні способи ведення бізнесу. Практичний ефект від їхнього використання полягає в автоматизації фінансових та юридичних відносин між двома та більше суб'єктами. Аби детально розібратися у можливостях, принципах й обмеженнях технології, спочатку потрібно розібратися із проблемами традиційних (паперових) контрактів.

Звернімо увагу на складнощі, які часто супроводжують роботу зі звичайними контрактами. Проблеми можуть виникати під час укладення, розуміння, верифікування, виконання тощо.

> **Складнощі під час укладення звичайного контракту**
>> * *Найчастіше грамотно укласти контракт до снаги тільки юристу* 
>> * *Складно досягти повноти умов контракту* 
>> * *Неможливо швидко перевірити контракт на протиріччя іншим контрактам і всім вимогам чинного законодавства*

Коли всі умови враховано та сторони підписали контракт, залишається низка проблем, що можуть виникнути пізніше залежно від ситуації.

> **Складність розуміння та верифікування контракту**
>> * *Мова контракту найчастіше незрозуміла людям без юридичної освіти* 
>> * *Можливі розбіжності між юристами щодо значення деяких слів* 
>> * *Можливо підмінити непідписані сторінки контракту* 
>> * *Підпис може бути підроблено*

Складно уявити масштаб часових і матеріальних втрат, яких зазнають учасники юридичних відносин внаслідок неправильно складених або недороблених контрактів. А якщо врахувати кількість підроблених документів, то це буде нагадувати дещо середнє між економічним і соціальним лихом.

Відзначимо, що основна частина зазначених вище втрат припадає на етап виконання та судових розглядів. Якщо проаналізувати етап виконання, виявимо чимало проблем.

> **Складнощі під час виконання контракту**
>> * *Виконання навіть правильно укладеного контракту може залежати від розумових здібностей юристів сторін-учасників*
>> * *Тривалість судових процесів та витрати на них* 
>> * *Можливість підкупу суду* 
>> * *Гарантувати відшкодування збитків складно, якщо друга сторона збанкрутує*

Рішення для майбутнього з'явилося. Контракт може бути написано такою мовою, яка зрозуміла й людині, і машині.

> **Особливості контракту, який задано програмним кодом**
>> * *Універсальну мову написання однозначно розпізнає комп'ютер* 
>> * *За однакових вхідних даних програмний код надає той самий результат (рис. 6.17)*
>> * *Контракт підписано цифровим підписом, який легко перевірити та складно підробити* 
>> * *Людський фактор виключено на етапах розуміння та виконання* 
>> * *Такий контракт можливо протестувати*

![Рисунок 6.17 – Результат виконання смарт-контакту однаковий для всіх пристроїв](/resources/img/volume-1/6.3-introduction-to-smart-contracts/6.17-result-of-execution.png)

### Що таке смарт-контракт?

*Смарт-контракт (smart contract)* – це угода про перерозподілення цінностей між контрагентами, яка передбачає жорстке й однозначне задання умов, автоматизацію процесів виконання та мінімізацію залучення довірених сторін. Найчастіше цього досягають за допомогою об'єднання механізмів задання умов і механізмів строгого їхнього виконання, для чого зазвичай застосовують комп'ютерні протоколи, що описують порядок створення, обробки та реалізації смарт-контрактів. Систему під управлінням такого протоколу називають платформою смарт-контрактів, де контракти поміщають до спеціальних транзакцій (або запитів), які повинні підписати всі залучені до угоди сторони. Після того, як таку транзакцію було передано на платформу смарт-контрактів, змінити умови контракту, порушити чи скасувати його виконання вже неможливо. Таку ідею, як і сам термін *смарт-контракт*, запропонував Nick Szabo в 1994 році, а відповідний документ [62] було опубліковано в 1997 році (рис. 6.18).

![Рисунок 6.18 – Ідея смарт-контрактів Nick Szabo](/resources/img/volume-1/6.3-introduction-to-smart-contracts/6.18-nick-szabo.png)

> **Що слід знати про смарт-контракти?**
>> * *Дозволяють контрагентам взаємодіяти без залучення третіх сторін* 
>> * *Смарт-контракти простіше аудитувати, ніж систему традиційних контрактів* 
>> * *Є різні способи та протоколи реалізації смарт-контрактів* 
>> * *Дозволяють керувати цифровими активами, облік яких ведеться на платформі* 
>> * *Ініціація створеного контракту виконується або вручну, або автоматично*

Виконання смарт-контрактів має на увазі, що на платформі присутній один валідатор (або мережа валідаторів) і база даних, яка зберігає всі смарт-контракти, що надійшли на виконання у строгій хронологічній послідовності. Важливо, що ця база має містити всі дані, які використовуватимуть умови-тригери під час виконання смарт-контракту. Вона також має враховувати ту цінність, розподілення якої описано в контракті: якщо це стосується деякої цифрової валюти, отже, ця база даних має враховувати цю цифрову валюту.

Іншими словами, валідатори смарт-контрактів повинні мати доступ до всіх даних, якими оперує смарт-контракт. Наприклад, одну базу даних мають використовувати для обліку одночасно цифрових валют, балансів користувачів, транзакцій користувачів і часових міток. Тоді в смарт-контракті умовою може бути баланс користувача у певній валюті, настання деякого часу або факт здійснення якоїсь транзакції, але не більше за те.

Смарт-контракти мають на увазі автоматизацію розподілення цінності, яке може залежати тільки від тих умов, які встановлено заздалегідь. У найпростішому варіанті це програмований контракт зі строго заданими умовами, який зазвичай завіряють всі залучені до угоди сторони за допомогою цифрового підпису (рис. 6.19).

![Рисунок 6.19 – Завірення смарт-контракту з боку залучених сторін](/resources/img/volume-1/6.3-introduction-to-smart-contracts/6.19-validation-od-a-smart-contract.png)

Смарт-контракти повинні мінімізувати довіру до третіх сторін. Іноді навіть повністю виключено центр прийняття рішень, від якого все залежить. Порівняно з паперовими контрактами щодо смарт-контрактів проводити аудит значно простіше. Це наслідок деяких особливостей проектування такої системи. Якщо платформа смарт-контрактів децентралізована та база даних загальнодоступна, будь-хто охочий може проаналізувати базу даних і провести повний аудит виконання контрактів. У таким спосіб досягається захист від змінювання даних заднім числом, які могли би потягти зміни у виконанні одного чи кількох контрактів. Отже, витрати на підтримання інфраструктури смарт-контрактів нижчі порівняно з витратами на підтримання інфраструктури паперових контрактів.

### Роль оракулів для смарт-контрактів

Дуже важливо, з якими вхідними даними працює смарт-контракт. Якщо дані початково створювалися, зберігалися й оброблялися в межах однієї облікової системи, то смарт-контракт, який виконується в цій самій обліковій системі, може працювати з цими даними без посередників. У цьому разі *оракули* не потрібні. Однак робота тільки з внутрішніми даними істотно обмежує можливості смарт-контрактів в контексті практичного застосування.

У низці випадків контракту потрібні зовнішні дані (факт того, що сталася подія, досягнення деякої позначки температури повітря й таке інше), яку має бути доставлено до бази даних облікової системи та які мають підтвердити довірені сторони. Власне, оракули і є постачальники даних про зовнішній світ.

Оракули транслюють дані ззовні до децентралізованої облікової системи. Найчастіше оракул має identity та вимагає деякої довіри користувачів до даних, які він надає. Усі дані, що передає оракул, має бути підписано цифровим підписом, щоби забезпечити цілісність даних і неспростовність (кожний користувач системи може перевірити, що конкретні дані передав конкретний оракул).

Можливо мінімізувати необхідність довіри користувачів через збільшення кількості оракулів (припустимо, задля запобігання корупції). Тоді смарт-контракт отримуватиме відомості від багатьох незалежних оракулів і узгоджуватиме їх, після чого прийматиме деяке рішення (рис. 6.20).

![Рисунок 6.20 – Смарт-контракт отримує дані від незалежних оракулів](/resources/img/volume-1/6.3-introduction-to-smart-contracts/6.20-smart-contracts-and-oracles.png)

### Приклад із купівлею в онлайн-магазині

Розгляньмо дуже простий приклад. Він допоможе наблизитися до розуміння функціональних можливостей смарт-контрактів, а також краще орієнтуватися, в яких випадках їх варто застосовувати. Його можливо реалізувати також з використанням Bitcoin, хоча зараз Bitcoin ще складно назвати повноцінною платформою для смарт-контрактів.

Отже, у нас є певний покупець і є інтернет-магазин. Покупець хоче купити монітор в цьому магазині (рис. 6.21). У найпростішому разі покупець оформляє та відправляє платіж, а інтернет-магазин приймає його, підтверджує, після чого відправляє товар. Однак у цій ситуації необхідна наявність великої довіри: покупець вимушений на всю вартість монітора довіряти інтернет-магазину. Припустімо, інтернет-магазин може мати низьку репутацію, і для покупця є ризик, що з якихось причин після прийому платежу магазин відмовить в обслуговуванні та не відправить товар. Тому покупець (відповідно, й інтернет-магазин) постає перед питанням, що можна у цьому разі застосувати задля того, щоб мінімізувати ось такі ризики та зробити більш надійними такі угоди.

![Рисунок 6.21 – Використання смарт-контракту для купування товару в інтернет-магазині](/resources/img/volume-1/6.3-introduction-to-smart-contracts/6.21-smart-contract-for-buying-good.png)

У разі Біткоіна можна надати можливість покупцеві та продавцеві незалежно один від одного вибрати *медіатора*. Є багато людей, які займаються вирішенням спірних питань. І наші учасники можуть вибрати з загального списку медіаторів того, якому одночасно довірятимуть. Разом вони створюють MultiSig-адресу 2-з-3, де є три ключі та необхідні два підписи будь-якими двома ключами, щоб витратити монети з цієї адреси. Один ключ належатиме покупцеві, другий – інтернет-магазину та третій – медіаторові. І на таку MultiSig-адресу покупець відправить суму, необхідну для оплати монітора. Тепер, коли продавець переконався, що монети на деякий час заблоковано на такій MultiSig-адресі, яка залежить від нього, він сміливо відправляє монітор поштою.

Далі покупець отримує посилку, оглядає товар і приймає рішення про остаточну покупку. Він може бути повністю згодним з наданим обслуговуванням і підписати транзакцію своїм ключем, де він передає монети з MultiSig-адреси продавцеві, а може бути чимось незадоволений. У другому випадку він зв'язується з медіатором для складання якоїсь альтернативної транзакції, яка по-іншому розподілятиме ці монети.

Припустимо, монітор приїхав трохи подряпаним, і в комплекті не було кабелю для підключення до комп'ютера, хоча на сайті інтернет-магазину було написано, що кабель має входити до комплекту. Тоді покупець збирає докази, необхідні для того, щоби довести медіаторові, що його обдурили: він робить скріншоти сайту, робить фотографію чека з пошти, робить фотографію подряпин на моніторі та показує, що пломбу було зірвано та кабель витягли. Інтернет-магазин, зі свого боку, збирає свої докази та передає їх медіатору.

Медіатор зацікавлений у тому, щоби задовольнити одночасно інтерес і покупця, й інтернет-магазину (далі буде зрозуміло, чому). Він складає таку транзакцію, у якій монети з MultiSig-адреси буде витрачено в певній пропорції між покупцем, інтернет-магазином і медіатором, позаяк він бере собі частину як винагороду за свою роботу. Припустимо, 90% всієї суми піде продавцеві, 5% – медіаторові та 5% – покупцеві. Цю транзакцію медіатор підписує своїм ключем, але її ще не може бути застосовано, тому що для цього потрібно два підписи, а поставлено лише один. Таку транзакцію він відправляє і покупцеві, і продавцеві. Якщо хоча б один із них буде задоволений таким варіантом розподілення монет, то транзакцію буде допідписано і розповсюджено мережею. Для її валідування достатньо, щоб один із учасників угоди прийняв варіант медіатора.

Важливо спочатку вибрати медіатора так, щоб обидва учасники довіряли йому. У такому разі він діятиме незалежно від інтересів одного або іншого й об'єктивно оцінить ситуацію. Якщо ж медіатор не надає такий варіант розподілення монет, який задовольнить хоча б одного учасника, тоді, домовившись між собою, і покупець, й інтернет-магазин можуть переспрямувати монети на нову MultiSig-адресу, поставивши свої два підписи. Нову MultiSig-адресу буде складено вже з іншим медіатором, який, можливо, буде більш компетентним у питанні та надасть кращий варіант вирішення конфлікту. У цьому прикладі є дві ключові особливості:

* Медіатор не може вкрасти гроші користувачів.
* Можливо замінити медіатора під час вирішення спору за згодою обох сторін.

### Приклад контракту для спільної купівлі

Розглянемо складніший приклад, який відображає можливості смарт-контракту більш явно. Припустимо, є троє студентів, які нещодавно оселилися в одній кімнаті в гуртожитку. Вони втрьох зацікавлені в тому, щоби купити до своєї кімнати холодильник, яким вони спільно користуватимуться. Один із них зголосився зібрати необхідну суму для купівлі холодильника та вести перемовини з продавцем. Однак вони відносно нещодавно познайомилися один із одним і достатньої довіри між ними немає. Очевидно, що двоє з них ризикують, віддаючи гроші третьому. Водночас їм потрібно досягти згоди у виборі продавця.

Хлопці можуть скористатися escrow service, тобто вибрати медіатора, який проконтролює виконання угоди та владнає спірні питання, якщо такі виникнуть. Тоді, домовившись, вони укладають смарт-контракт і прописують у ньому певні умови (рис. 6.22), де одна з умов полягає в тому, що до настання певного часу (припустімо, один тиждень потому) на відповідний обліковий запис смарт-контракту має надійти три платежі з певних адрес на певну суму. Якщо це не відбувається, смарт-контракт повертає монети всім учасникам і припиняє своє виконання. Якщо ж умову виконано, тоді відбувається задання ідентифікаторів продавця та медіатора та перевірка того, чи всі учасники згодні з вибором продавця та медіатора. Коли всі умови буде виконано, кошти буде переведено на зазначені адреси.

![Рисунок 6.22 – Використання смарт-контракту для спільної купівлі](/resources/img/volume-1/6.3-introduction-to-smart-contracts/6.22-mutual-purchase.png)

Такий підхід убезпечує учасників від шахрайства з будь-якого боку та взагалі виключає необхідність довіряти будь-кому. Ми бачимо на цьому прикладі сам принцип: можливість покроково задавати параметри для виконання кожної умови дозволяє створювати контракти будь-якої складності та глибини вкладених рівнів. Крім того, спочатку в смарт-контракті можливо визначити першу умову та тільки після її виконання задавати параметри для наступної умови, тобто формально умову прописано, а параметри для неї може бути задано вже під час її роботи.

> **Інші складнощі**
>> * *Помилка в коді контракту може спричинити сумні наслідки* 
>> * *Дані для всіх тригерів мають бути в базі платформи контрактів* 
>> * *Потрібно оцифровувати активи та здійснювати їх облік на платформі контрактів* 
>> * *У низці випадків практично неможливо забезпечити властивість trustlessness*

### Класифікація платформ смарт-контрактів

Для класифікації можна задавати різні групи критеріїв. Однак для нинішнього рівню розвитку технологій актуальні чотири з них:

* Середовище виконання
* Метод виконання
* Метод ініціювання
* Рівень приватності

За рівнем приватності смарт-контракти можуть бути чи повністю відкритими, чи частково конфіденційними, чи повністю конфіденційними (тобто сторонні спостерігачі не можуть бачити умови смарт-контрактів). Однак тема приватності дуже розлога, та її краще розглянути окремо.

### Відмінність платформ за середовищем виконання

За середовищем виконання розрізняють централізовані та децентралізовані платформи смарт-контрактів. У разі централізованих цифрових контрактів використовують один сервіс, де є тільки один валідатор, а також може бути служба резервного копіювання та відновлення, якою також управляють централізовано. Є одна база даних, яка зберігає всю необхідну інформацію для задання умов смарт-контракту та розподілення цінності (оцифроване право власності на актив). У централізованого сервісу є клієнт. І оскільки платформа централізована, механізми аутентифікації можуть бути більш примітивними, аніж у Bitcoin (рис. 6.23).

![Рисунок 6.23 – Централізована платформа смарт-контрактів](/resources/img/volume-1/6.3-introduction-to-smart-contracts/6.23-centralized-smart-contract.png)

Як приклад можна навести провайдерів мобільного зв'язку, тобто різних мобільних операторів. Припустімо, певний оператор у централізований спосіб здійснює облік трафіку, який може бути передано в різних форматах (наприклад у формі голосових дзвінків, повідомлень SMS, трафіку мобільного Інтернету), і коштів на балансах користувачів. Відповідно, провайдер мобільного зв'язку може укладати контракти з обліку наданих послуг та їх оплати з різними умовами. Тоді легко задавати умови на кшталт «відправ повідомлення SMS із таким-то кодом на такий-то номер – і отримаєш такі-то умови розподілення трафіку».

Можна навести ще один приклад: традиційні банки з розширеною функціональністю інтернет-банкінгу та дуже прості контракти, як-от регулярні платежі, автоматична конвертація вхідних платежів, автоматичне відрахування відсотка на вказаний рахунок тощо.

Якщо середовище виконання смарт-контракту децентралізоване, то є група валідаторів, що обробляють контракти, які зберігають у незмінній формі (рис. 6.24). В ідеальному разі валідатором може стати взагалі будь-хто.

![Рисунок 6.24 Децентралізована платформа смарт-контрактів](/resources/img/volume-1/6.3-introduction-to-smart-contracts/6.24-decentralized-smart-contract.png)

Тут транзакції міститимуть інструкції з виконання контракту відповідно до строгої специфікації. Ця специфікація відкрита, так що самі користувачі платформи можуть проводити аудит і валідацію смарт-контрактів. Тут ми бачимо, що децентралізовані платформи перевершують централізовані за *незалежністю* та *відмовостійкістю*, але їх проектування й обслуговування водночас набагато складніше.

### Відмінність платформ за способом виконання контрактів

Тепер розберемо, як смарт-контракти можуть відрізнятися за способом задання та виконання умов.

*Повний за Тьюрингом* смарт-контракт дозволяє задавати майже будь-які алгоритми як умови виконання контракту: від написання функцій, що використовують цикли, та функцій розрахунку ймовірностей до власних алгоритмів цифрового підпису і навіть написання власних смарт-контрактів. Тут ідеться про дійсно довільне написання логіки. Перевага такого підходу полягає в більшій гнучкості за програмування смарт-контракту. Недолік – неможливість гарантувати безпеку платформи, оскільки є ситуації, за яких виконання смарт-контракту, написаного повною за Тьюрингом мовою програмування, може бути непередбачуваним. До довільних повних за Тьюрингом контрактів належать платформа Ethereum [115] і RootStock.

*Неповні за Тьюрингом* мови програмування смарт-контрактів (як-от скрипти в Bitcoin і Litecoin) дозволяють у довільному порядку використовувати тільки визначені операції. Однак використовувати цикли та реалізовувати власні алгоритми вже не можна. За допомогою такого підходу можливо створити більш безпечне середовище для виконання контракту.

*Попередньо визначені (шаблонні)* смарт-контракти підтримують обмежений список шаблонів (зазвичай кілька десятків найпопулярніших контрактів, які реалізовано заздалегідь). Це дозволяє забезпечити більший контроль над безпекою на відміну від попередніх способів. До платформ, які використовують такий підхід, можна віднести Stellar, BitShares та Steemit. BitShares має цілу низку смарт-контрактів для торгівлі, управління обліковими записами, управління самою платформою та її параметрами. Steemit – схожа платформа, але її орієнтовано не на випуск токенів і торгівлю, як BitShares, а на ведення блогів, себто вона зберігає й обробляє контент у децентралізований спосіб.

### Відмінність платформ за способом ініціювання контрактів

За способом ініціації смарт-контракти теж можливо розділити щонайменше на дві групи: *автоматизовані* та *ручні (неавтоматизовані)*. Для автоматизованих характерно, що за всіх відомих параметрів й умов, що настали, смарт-контракт повністю виконано автоматично, тобто не потрібно відправляти якісь додаткові транзакції та витрачати додаткову комісію під час кожного наступного виконання. Сама платформа має всі дані, щоби розрахувати, як саме смарт-контракт буде завершено. Логіка в цьому разі не довільна, а заздалегідь задана, тому результат передбачуваний. Це дозволяє наперед оцінити складність виконання смарт-контракту і, наприклад, розрахувати комісію для його виконання.

Найчастіше для смарт-контрактів, які написано повною за Тьюрингом мовою, ініціацію виконання не автоматизовано. Для ініціювання кожного етапу такого смарт-контракту потрібно створювати нову транзакцію, яка активуватиме наступний крок контракту й платитиме відповідну комісію. Крім того, потрібно очікувати на підтвердження цих транзакцій та фіксацію проміжних результатів. Виконання кожного кроку може бути завершено успішно чи ні, тому що код смарт-контракту довільний і можуть з’явитися непередбачувані ситуації, як-от нескінченний цикл, бракування вхідних даних, непередбачені значення аргументів і т. ін.

### Підсумки

Упровадження смарт-контрактів пов’язано з великими очікуваннями з боку бізнесу. Але варто пам'ятати, що смарт-контракт сам собою – це шматок коду. Результатом виконання цього коду має стати згода всіх учасників системи щодо балансів акаунтів (взаєморозрахунків). Звідси можливо зробити кілька висновків:

* Смарт-контракт стає «смарт», тільки коли його виконують усі зацікавлені учасники одночасно та коли більшість із них погоджується з результатами виконання смарт-контракту.
* Результат виконання смарт-контракту – зміни в реєстрі, що містить оцифровані активи.

Таким чином, смарт-контракт може управляти тільки активами, які вже оцифровано, а реєстр, у якому ведуть облік цих активів, має бути головним джерелом інформації про права власності на ці активи. Якщо ці вимоги не виконуються, то використання смарт-контрактів має вкрай мало сенсу.

Використання смарт-контрактів у централізованій системі може мати сенс, проте властивості *transparency*, *auditability* та *trustlessness*, найімовірніше, не буде забезпечено.

Створення умов для функціонування смарт-контракту – необхідний крок у напрямі автоматизації бізнес-процесів. Утім, слід підкреслити поняття *соціальний консенсус*. Воно може вплинути на очікувані результати смарт-контракту аж до зміни стану бази даних. Такі ситуації можуть виникати навіть у permissionless облікових системах. Яскравий приклад – прийняття оновлення типу hardfork в Ethereum, коли значна частина спільноти були проти (докладніше в 6.1).

**Поширені міфи**

*Смарт-контракти мають функціонувати в автономному режимі.*

Помилково вважати, що смарт-контракти вміють аналізувати оточення та діяти згідно зі змінами, що було внесено. Їхній код буде запущено у разі надходження платежу чи повідомлення про деяку виконану умові. Його активують через зовнішній обліковий запис компанії чи інші механізми ініціювання виконання. Таким чином, не всі платформи реалізують повністю автономне виконання смарт-контрактів.

*Смарт-контракти можна змінити за виявлення помилки так само, як і звичайний контракт.*

Якщо за укладання традиційних договорів виникає ситуація, коли щось потрібно виправити, до договору пишуть додатки. Проте в децентралізованому середовищі немає «адміністратора», який міг би внести зміни до контракту, і немає центру, який міг би зупинити запущену програму. Одне тільки рішення за виявлення помилки – створення «коригувального» смарт-контракту, якщо всі учасники угоди з цим згодні. 

На момент написання книги за весь час наявності смарт-контрактів було зафіксовано тільки один випадок, коли знадобилося ручне регулювання. У червні 2016 року зловмисники зламали систему компанії The DAO та почали виводити токени на свої гаманці, що спричинило не тільки обвалення DAO, але й зниження курсів ether і навіть bitcoin. Таку можливість для атаки надала помилка під час написання смарт-контракту. Під час виправлення ситуації смарт-контракти не було переписано, оскільки це неможливо. Вирішенням стало проведення hardfork, унаслідок чого з'явився Ethereum Classic.

**Часті запитання**

*– Хіба смарт-контракти виключають довіру з взаємин між людьми? Адже тут є оракули – чи це не третя сторона?*

Принципова різниця полягає в можливості вибору. У випадку зі звичайним магазином, покупець має довіряти адміністрації цього магазину. Він може тільки повірити, що товар на вітринах якісний, маркування не підроблено тощо. Адміністрація може змусити співробітників надавати хибні дані покупцям, щоб якнайшвидше позбутися від продукції, що залежалася. А у випадку зі смарт-контрактом можна вибрати довірених осіб, які можуть навіть не знати один одного, тому домовитися їм буде важко. Рішення про те, що певні умови настали буде прийнято шляхом голосування. Упевнитися, що голосування та підрахунок результатів відбувається відповідно до правил протоколу, дозволить автоматизований аудит.

*– Чи можливо в смарт-контракті використовувати таймер, щоби платформа могла знати, коли здійснювати платіж?*

Ні, таймери в смарт-контрактах не використовують. Замість цього, можна запрограмувати перевірку поточного часу на перевищення деякого константного значення перед виконанням певної операції чи платежу. А зацікавлена сторона може мати можливість ініціювати виконання цієї перевірки.

## 6.4 Вступ до токенізації активів

Коли будь-де вживають слово blockchain чи токенізація, багато людей схильні думати про криптовалюту і продаж токенів, про теми, що не покидали заголовків преси у 2017 році. Токенізація переважно розглядалася просто як процес випуску та продажу utility токенів (див. нижче), що сліпо копіювали основну ідею Bitcoin як децентралізованої валюти. Це застосовувалося до платежів між користувачами певного бізнес-застосунку. Саме таким чином світ став свідком виникнення токенів для продажу канабісу, токенів на використання автомийки, для обміну активами на біржі, для IoT, браузерів, соціальних мереж, сховищ даних, телефонів, засобів інвестування і для багатьох інших цілей (дивних та не дуже). Ідея, яку намагалися передати стартапи, що створювали такі проєкти, стосувалась демократизації інвестицій, прозорості операцій та можливості використання смарт-контрактів між людьми та машинами. Насправді більшість із цих ідей виявилися провальними з різних причин ( відсутність компетентності, стійкої бізнес-моделі, іноді навіть з причини жадібності чи спроб шахрайства). Однак це тільки один бік усієї історії.

Ідея оцифрування всіх активів і застосування застосунків із програмованою логікою управління активами вже давно привернула увагу та набуває дедалі більшої популярності. Одного разу, щонайбільше два рази на десятиріччя виникають значущі інновації, що стрясають усю інфраструктуру управління даними. Поява першої криптовалюти стала прикладом того, як фінансова система може надійно функціонувати в абсолютно «ворожому середовищі»: повністю анонімному, permissionless, розподіленому і без жодних адміністраторів безпеки, міжмережевих екранів і фізичного захисту периметру. Багато ідей може бути запозичено з такого сценарію та застосовано в набагато більш дружніх до користувача (з погляду умов для роботи) системах управління активами підприємства.

Від самого початку слово *токен* використовувалося, коли люди говорили про випускання з боку проєктів власних монет. Пізніше цей термін набув точнішого значення в контексті цифрових активів. *Токен* – це право власності, що створюється та передається в межах облікової системи, що може знаходитися як під управлінням однієї компанії, так і групи незалежних валідаторів. Одне з головних завдань *токенізації* полягає в тім, щоби зробити таку облікову систему головним джерелом інформації про права власності. У фінансовому світі люди часто використовують поняття *security token*, коли мають на увазі цінний папір як базовий актив (фінансовий інструмент, що регулюється та торгується), але насправді це тільки окремий випадок.

*Мета токенізації* полягає у пришвидшенні та підвищенні безпеки роботи з активами [97].

*Токенізація – це процес трансформації облікової системи, що полягає у тому, що всі баланси знаходяться під управлінням користувачів за допомогою криптографічних ключів, і право власності на актив надається у вигляді цифрового токену*.

Якщо замислитися, з токенами ми знайомі досить давно. Ваучер на одну стрижку в перукарні також можна вважати токеном. Ще один приклад – жетон в метрополітені. Навіть долар США до моменту, коли відмінили золотий стандарт, також був токеном, який мав на увазі право на відповідну кількість золота.

Термін *токен* може вживатися у контексті автентифікації: так називають деякі ідентифікатори чи секрети, що використовуються для електронної автентифікації. Токен може бути подано у формі рядка чи у формі фізичного пристрою для підтвердження доступу до відповідних систем, інформаційних ресурсів тощо. Далі спробуємо надати більш чітке і компромісне визначення токену як цифрового активу. 

*Токен* (як цифровий актив) – *це одиниця обліку, що використовується для представлення цифрового балансу в деякому активі. Володіння токеном доводиться за допомогою криптографічних механізмів, наприклад цифрового підпису* [98].

Токени та токенізація можуть бути розглянуті на чотирьох концептуально різних рівнях, оскільки звичайні користувачі, бізнесмени, розробники та дослідники сприймають ситуацію по-різному.

*Рівень користувача*. Володільцю токена надається юридичне право власності на відповідний актив. Він також може швидко і надійно передати це право іншим користувачам, не переміщуючи при цьому сам актив. Передбачається, що володільці токенів визнають законність і унікальність конкретного реєстру, у якому ведеться облік токенів. Також вони повинні довіряти зберігачу фізичних активів (у випадку, якщо токен закріплюється саме фізичним активом).

*Рівень бізнес-процесів*. Насамперед токенізація передбачає наявність реєстрі прав власності на основе технології blockchain. Передача токена з рук у руки означає зміну володільця ресурса з внесенням відповідного запису до реєстру, який вважається основним джерелом інформації для всіх користувачів системи. 

*Рівень ІТ-інфраструктури*. У цьому разі токен можна розглядати як механізм внесення змін до реєстру прав власності, який зберігає кінцевий стан балансів користувачів. Водночас із токеном пов’язані функції резервного копіювання даних, управління ролями та інфраструктурою загалом, перевіряння цілісності історії транзакцій і здійснення автоматичного аудиту в режимі реального часу. 

*Рівень технології*. Токен – це запис у структурі акаунту, чиї всі поля захищені за допомогою криптографічних механізмів, як-от цифрового підпису, гешування, доказів із нульовим розголошенням тощо. Кожен акаунт підтримує операції, пов’язані з оновленням його стану, визначає набір можливих транзакцій, модель їхнього життєвого циклу, правила обробки тощо. 

### Проблеми наявних облікових систем

Оцифрування облікових систем – відносно нова тенденція, яка з’явилася в 1970-х роках. Інтернет-атаки, вочевидь, не були в ті часи проблемою, тому не було гострої потреби замислюватися про них. Це можна вважати однією з причин, чому механізми безпеки не були реалізовані в оригінальній архітектурі. Процеси комунікації в облікових системах не оцифровувалися до 1990-х років, а регулювання (звітність, AML, KYC) було впроваджено ще пізніше.

З архітектурного погляду довіра до сторони, з якою проходить взаємодія, не вважалася проблемою, оскільки менталітет ділової поведінки цілком засновувався на довірі, яка підтримували законодавство та правоохоронні органі. Іншою розповсюдженою практикою, яка розглядалася як гарний метод забезпечення безпеки, була закритість програмного забезпечення.

У результаті, здебільшого облік надалі здійснювався у паперовому вигляді, оскільки більшість облікових систем (які успадкували застарівші механізми) не були готові до цифрового віку. Зібравши разом проблеми наявних облікових систем, отримаємо такий перелік:

* Відсутність прозорості в облікових процесах, зокрема в історії змін
* Низький рівень інтеграції з іншими платформами
* Необхідність довіряти управління системою третій стороні
* Висока складність аудиту
* Уразливість до ненавмисних і несанкціонованих змін
* Перелічені вище проблеми виникають із таких причин:
* Технічна несумісність форматів даних
* Відсутність відкритого та захищеного АРІ
* Відсутність строгої впорядкованості транзакцій, а також можливості перевірити їхню цілісність
* Відсутність методів захищеного синхронізування даних між зацікавленими сторонами

Усі перелічені вище чинники призводять до неефективної роботи, потреби ручного обслуговування та додаткових витрат на аудит та страхування.

### Що таке платформа токенізації?

*Платформа токенізації – це сукупність компонентів, які дозволяють здійснювати облік та операції з певним активом за допомогою використовування цифрового токена, а також забезпечити безпеку його зберігання, оброблення й управління*.

Компоненти платформи токенізації такі:

* Реєстр
* Внутрішня платіжна система
* Внутрішня біржа
* * Модуль управління акаунтами
* Шлюзи й інтеграційні модулі
* Гаманці
* Модуль управління життєвим циклом активу

Щоби знизити ризик шахрайства та змови, різні (іноді незалежні) суб’єкти повинні виконувати різні типи дій. Отже існує набір ролей, які повинні підтримуватися платформою токенізації. Найважливішими з них є валідатор, аудитор, зберігач, емітент і адміністратор.

*Валідатор* підтримує нормальне функціонування системи у відповідності до протоколу обліку токенів. Роль валідатора може виконувати як окрема людина, так і ціла організація.

*Аудитор* – це призначена сторона, яка має право перевіряти транзакції, і саме аудитор натискає на «тривожну кнопку», якщо помічає щось підозріле. Аудитор зберігає повну копію реєстру транзакцій і перевіряє законність дій, що відбуваються на платформі.

*Зберігач (custodian)* – це особа, що відповідає за надання зовнішніх активів, які токенізовані на платформі (якщо вони є). Ця роль дуже важлива, оскільки ІТ-платформа самостійно не може запобігти крадіжці.

*Емітент* – це сторона, що здійснює емісію на підставі даних, отриманих від зберігача (у деяких випадках ролі емітента і зберігача можуть виконуватися однією стороною). Токени можуть випускатися або централізованим (суму, яку необхідно видати, призначає відповідальна сторона), або децентралізованим (декілька валідаторів досягають консенсусу відносно кількості токенів, що потрібно випустити) чином.

*Адміністратор* приймає рішення щодо оновлення та налаштування платформи, а також щодо налаштування бізнес-правил.

> **Базові принципи токенізації**
>> * *Пряме управління активом для його володільця* 
>> * *Надійний автоматизований аудит усієї історії транзакцій* 
>> * *Розподілення відповідальності за управління процесами на платформі за ролями* 
>> * *Підвищення відмовостійкості інструментів зберігання, передавання й обмінювання активів* 
>> * *Відкритість специфікації облікової системи та цифрових гаманців* 
>> * *Відокремлення процесів зберігання активу від процесів управління активами*

### Принципи функціонування платформи токенізації 

Перелічмо ролі та процеси, що присутні на платформі токенізації:

* Управління системою (governance) – виконується тим, кого назначив творець чи володілець системи
* Зберігання активів – виконує зберігач (custodian)
* Емітування – виконує емітент (токени, що емітуються, забезпечує зберігач на платформі токенізації)
* Валідування транзакцій – виконують валідатори
* Здійснення аудиту – виконує аудитор

Розгляньмо простий приклад токенізації якогось фізичного товару, наприклад розписок на зерно. Очевидно, що управління системою здійснює сам елеватор, він же виконує зберігання зерна. Емітентом може бути інша організація, що має сертифікат на виконання такої діяльності (вона буде виконувати початкову оцінку якості зерна і підтверджувати, що на складі воно дійсно присутнє). Валідацію транзакцій може робити як сам елеватор, так і група суб’єктів, відповідальних за коректність транзакцій (ця група можу включати в себе елеватора, емітента, сторонні організації тощо). Аудит коректності транзакцій може виконуватися як користувачами системи, так і спеціально призначеними організаціями, яким довіряють інші користувачі.

Суттєва різниця для користувачів полягає у тому, що тепер вони можуть зберігати підписані версії всіх транзакцій на своїх пристроях і у випадку розбіжностей довести в суді, що їх поточний баланс був результатом виконання коректних транзакцій.

Якщо провести аналогію з permissionless обліковою системою (наприклад із Bitcoin), то виявиться, що всі процеси в такій системі децентралізовані. Фізичного забезпечення немає, тому роль зберігача не актуальна, а емісія виконується на основі попередньо заданої формули. Валідатором може стати будь-хто, й облікова система загальнодоступна. Усі процеси в ній прозорі, і будь-хто може перевірити цілісність даних чи провести аудит. Довіра користувачів до валідаторів тут майже не потрібна. Така система найстійкіша до цензури.

Відзначмо, що й permissioned, і permissionless системи кардинально відрізняються з погляду галузі застосування, але водночас вирішують покладені на них завдання щодо забезпечення безпеки транзакцій і прозорого аудиту.

### Можливості, які надає токенізація

Завдяки технічним особливостям нової інфраструктури з’являється низка нових можливостей.

> * *Створення глобальних децентралізованих реєстрів даних* 
> * *Створення щільно інтегрованих систем, що мають високу модульність і розподілення відповідальності за роботу кожного конкретного модуля* 
> * *Простий аудит системи обліку в режимі реального часу* 
> * *Переміщення активів і торгівля ними в Інтернеті без меж (можливість створення Фінансового Інтернету)*

### Прозорість процесів облікової системи

За допомогою платформи токенізації можна побудувати прозорі бізнес-процеси. Як показує практика, ефективнішим є попередження нечесної поведінки, а не боротьба з нею. Платформа токенізації може працювати за жорсткими правилами, метою яких є запобігання злонамірних дій. У межах такої облікової системи партнери по бізнесу завжди можуть перевірити дії один одного.

Що більше незалежних валідаторів в обліковій системі, тим стійкіша вона до відмов у роботі. Оскільки локальні копії синхронізуються в режимі реального часу і автоматично створюються резервні копії, токенізація підвищує надійність системи.

### Як токенізація приводить до збільшення вартості активів?

Токенізація дозволяє збільшити довіру до даних облікової системи за рахунок використання цифрового підпису та досягнення консенсусу між її валідаторами. Це опосередковано впливає на вартість токенізованих активів порівняно з тими активами, облік яких ведеться традиційним шляхом. 

Краще зрозуміти, як токенізація може впливати на цінність активів, а отже, і на вартість, допоможе простий приклад. Уявіть, що ви приходите до аптеки за ліками. Перед вами кладуть прозорий коробок без розпізнавальних знаків з білими пігулками всередині. Ви станете приймати ці пігулки? Звичайно ж ні. На них же нічого не написано. А що, якщо б за прилавком аптеки стояв ваш друг-провізор, який сказав би, що ці пігулки вам дійсно допоможуть? Скоріш за все, у вас все одно б залишились сумніви. Адже все одно незрозуміло, звідки вони взялися і хто їхній виробник.

А якщо це будуть пігулки у заводській упаковці з інструкцією, яка додається, де вказано, що ліки сертифіковані одним із провідних виробників лікарських засобів? При цьому відомо, що ефективність діючої речовини доведена багаторазово в ході багатоцентрових випадкових клінічних досліджень. Очевидно, що такі пігулки викликають більшу довіру, ніж у попередніх випадках. Якщо у вас і рецепт лікаря на ці ліки є, то сумнівів не залишається.  

Здавалося б, куди надійніше? Але давайте поміркуємо трохи футуристично і уявімо, що ви можете достовірно перевірити пігулку на сумісність речовин, які в ній містяться, з біохімічними процесами, що проходять у вашому організмі. 

Наприклад, Всесвітня організація охорони здоров’я потурбувалася про те, щоб у кожній аптеці стояв апарат, що за бажання покупця бере маленьку краплю його крові (чи будь-який інший матеріал для аналізу) і мізерну частину зразка ліків із придбаної упаковки, після чого аналізує поточний стан здоров’я покупця та якість лікарського засобу. Оцінив такі дані, апарат виводить результат про користь ліків у даному випадку.

Як гадаєте, чи стали б такі ліки ціннішими для вас? Безумовно.

Як ми бачимо, цінність ліків зростає по мірі росту об’єму цінної інформації про них. Зауважте, що властивості самої пігулки при цьому не змінюються. Це є результатом можливості довіри (і незалежної перевірки) до всіх попередніх операцій з активом, історії його походження (provenance), надійної автентифікації джерел даних.

### Умови ефективного застосування платформ токенізації

Для ефективного функціонування платформи токенізації необхідна присутність наступних основних компонентів:

* Реалізація digital identity, що дозволить зв’язувати дії учасника в системі з його особою
* Ефективні методи децентралізованого прийняття рішень
* Налагоджена схема зберігання й управління ключами

Цей перелік не повний. Також необхідно виконати низку вимог, перш ніж системи токенізації активів зможуть повноцінно працювати. Вони співпадають з необхідними умовами застосування blockchain, про які ми писали в 5.3.

### Ризики

Як ми згадували раніше, токенізація передбачає, що всі оцифровані реєстри прав власності є основним джерелом інформації про володільців активів. Тому, з юридичної точки зору, зміна володільця токена повинна означати зміну володільця активу.

Таким чином, деякі з основних ризиків пов’язані саме із забезпеченням токенів. Наприклад, у той час, як на балансах користувачів в системі обліку все коректно, реальні активи можуть бути підроблені, знищені чи викрадені. Ця проблема більше пов’язана із властивостями матеріального активу, аніж з роботою платформи токенізації: оцифровка дозволяє досягти багатьох переваг, але не гарантує цілісність свого забезпечення. Слід також пам’ятати, що особисті ключі користувачів можуть бути втрачені чи викрадені, що приведе до безповоротної втрати права на володіння активом. Цей ризик важко оцінити і від нього важко захиститися.

### Відмінність токенізації від оцифровки

Звичайної оцифровки документів, рахунків і прав власності недостатньо, щоб вийшла самодостатня автоматизована облікова система, яку можна використовувати повністю віддалено. *Токенізація трансформує управління активами: модель виконання заявок оператором (наприклад, у банку) змінюється на модель прямого управління активом за допомогою криптографічних механізмів*. Основною відмінністю є виключення ролі (наприклад, адміністратора чи модуля, що працює з відповідними дозволами), яка може напряму змінювати баланс на рахунках користувачів. Саме на цьому базується модель системи, що побудована за принципом виконання замовлень. Токенізація передбачає, що користувачі контролюють свої баланси за допомогою криптографічних ключів, які ніхто інший (в т. ч. адміністратори) не знає.

Також є принципова різниця між реєстром справжності і реєстром прав власності. *Реєстр справжності* пов’язує відповідний актив (наприклад, дизайнерську сумку) із його виробником і дозволяє перевірити справжність цього об’єкту. Цей реєстр містить лише об’єкти (без їхніх поточних володільців). *Реєстр прав власності* є інформаційним ресурсом, що містить дані про існуючі і минулі права власності на конкретні активи.

### Чому саме технологія blockchain?

Ключове питання таке: чому blockchain кращий за традиційний підхід для побудови й управління базою даних? Є декілька причин використовувати blockchain для токенізації та захисту реєстру. Раніше ми вже описували деякі основоположні властивості, які blockchain може забезпечити залежно від середовища (див. 5.1). Зараз ми хотіли б сконцентруватися на практичних особливостях:  

* Кожний держатель токена може довести, що його баланс відображає результат коректного виконання набору транзакцій – *можливість здійснення аудиту (auditability)*.
* Ніхто не може непомітно змінити баланс акаунтів – *цілісність (integrity)*.
* Украй важко змінити стан реєстру, оскільки множина копій синхронізується у режимі реального часу, при цьому відсутня єдина точка відмови, – *надійність (robustness)* та *доступність (accessibility)*.
* Легко довести, хто яку дію ініціював, – *неспростовність (non-repudiation)*.
* Можливо гарантувати, що транзакція була погоджена з усіма учасниками, – *децентралізоване прийняття рішень* (decentralized decision-making).
* Деякі учасники можуть здійснювати аудит без можливості модифікування даних – *прозорість, що не потребує довіри (trustless transparency)*.

### Підсумки

Токенізація – новий тренд удосконалення облікових систем й IT-інфраструктури загалом.

Платформи токенізації надають свої переваги при роботі з цифровими активами: прозорість їхнього обліку, простий аудит, надійність зберігання та синхронізації даних між валідаторами облікової системи, а також можливість доведення цілісності і незмінності цих даних. Завдяки цим властивостям можна створювати облікові системи, в яких довіра між сторонами не обов’язкова: *чесність* їхньої поведінки гарантуватимуть правила системи. Тому логічно припустити, що в майбутньому всі активи будуть токенізованими.

**Часті запитання**

*– Яка різниця між токенами та валютами (грошима)?*

Незважаючи на те, що люди вже використовують це слово у своєму повсякденному житті, токен є технічним терміном, який на практиці може означати право на будь-який актив (зокрема  валюту). Токени є цифровим правом власності на актив і можуть також використовуватися як засіб оплати. Обмін токенами чи оплата токенами будь-якого роду товарів чи послуг мають деякі подібності до бартеру.

*– Як пов’язані токенізація та технологія blockchain?*

Цифровий облік цінності супроводжується низкою ризиків. Важливо, щоб система, в якій виконується емісія, зберігання і передача цінності, мала достатній рівень безпеки. Технологія blockchain добре для цього підходить. Безпека даних гарантується криптографією, і будь-які спроби порушення правил протоколу облікової системи прозорі для аудитора. До того ж звичайні користувачі, якщо вони виявили будь-які порушення при функціонуванні платформи токенізації, також мають можливість довести, що вони були обдурені.

*– Хто контролює платформу токенізації?*

Якщо компанія вирішує токенізувати свій актив і контролює валідаторів на платформі токенізації, то саме ця компанія і є фактичний володілець платформи токенізації. Компанія централізовано приймає рішення щодо оновлення протоколу і відповідних правил обліку токенів. Якщо завдання полягає в децентралізуванні облікової системи, роль валідатора може бути розподілена між партнерами чи навіть клієнтами компанії. У цьому разі платформа набуває великої незалежності щодо обробки та підтвердження транзакцій. Таким чином можна забезпечити властивість *trustless* для роботи з відповідними токенами.

*– Що таке utility tokens?*

Utility tokens – це права на використання функціональності системи. Вони можуть водночас мати властивості як заявки на використання послуги, так і частини вартості, що створена системою; а також певні властивості внутрішньої валюти. Прийняття рішень і видавання таких токенів зазвичай виконується централізовано.

*– Що таке non-spendable tokens?*

Такі токени можна за певними правилами отримувати та накопичувати, але не можна передавати. Подекуди їх можна витратити (наприклад на отримання прав, змінення обмежень і т. ін.). Non-spendable tokens може видавати/вилучати адміністратор окремо для кожного учасника системи, або такі токени можуть мати обмежений час життя. Найчастіше використання таких токенів схоже на пред’явлення проїзного документа в громадському транспорті. Вони чудово підходять для здійснення обліку репутації, персональних знижок, особистих прав доступу, кількості написаних на форумі повідомлень і т. ін.

*– Хто відповідальний за помилки на платформі токенізації?*

Якщо платформа токенізації централізована, відповідальність за неї несе володілець. Якщо платформа децентралізована, то відповідальність розподіляється між валідаторами та клієнтами платформи.

*– Хто може бути валідатором у системі обліку токенів?*

Валідатором може бути будь-хто, здатний підтримувати нормальне функціонування системи відповідно до протоколу обліку токенів. Роль валідатора може виконувати як одна людина, так і ціла організація. У загальному разі валідаторами транзакцій можуть бути й аудитори, і регулятори, і партнери володільця платформи (наприклад, члени консорціума, що виконують певну бізнес-функцію).

[ПРИВАТНІСТЬ КОРИСТУВАЧІВ У ВІДКРИТИХ СИСТЕМАХ](https://github.com/distributed-lab/blockchain-and-decentralized-systems-book/blob/main/chapters/volume-1/ua/7-user-privacy-in-open-systems.md) 




















