# ПРИВАТНІСТЬ КОРИСТУВАЧІВ У ВІДКРИТИХ СИСТЕМАХ


## 7.1 Приватність як поняття в цифровому світі

На початку ХХІ сторіччя онлайн-платежі вважалися річчю ризиковою та зазвичай здійснювались із великою обережністю. Використання реальних імен на онлайн-ресурсах було немислимим, а анонімність діяльності в Інтернеті вважалася майже абсолютною.

У деяких країнах і зараз безпека та благополуччя користувачів залежать від ступеню захищеності їхніх персональних даних чи ступеню їхньої анонімності в Мережі. Професор Пенсильванського університету Девід Кросбі (David Crosbie) відзначив, що впровадження дійсно анонімних платежів може покращити ситуацію в країнах, що розвиваються [99]. Саме в країнах, що розвиваються, захищеність даних користувачів має найбільше значення, оскільки рівень довіри населення до органів законодавчої, судової та виконавчої влади зазвичай дуже низький, а політика приватності не завжди сумлінно дотримана під час оброблення персональних даних. У розвинених країнах зазвичай є налагоджена й усталена інфраструктура, де забезпечення інформаційної безпеки має свої особливості регулювання (наприклад GDPR [125]).

Тема приватності та способів її забезпечення досить розлога. Почати її вивчення найкраще з розуміння базових визначень.

### Важливість збереження приватності

На практиці у відкритих системах дотримання приватності має велике значення. Припустимо, на одній вулиці є п’ять ресторанів. Вони конкурують за потік відвідувачів і кожний із них прагне отримати більший прибуток. Відомості щодо внутрішніх процесів ціноутворення і прибутків залишаються таємницею для конкурентів. Однак уявімо, що буде, якщо хтось опублікує відомості про всі внутрішні транзакції й іншу документацію цих п’яти ресторанів у відкритому доступі.

Менш успішні конкуренти можуть керуватися нечесними намірами та просто нашкодити найбільш успішному конкуренту матеріально, наприклад, влаштувати пожежу. За умови, що найбільш успішний ресторан був найпривабливішим для відвідувачів, бо там готували смачні страви з якісних продуктів, від розорення цього закладу ніхто не виграє, окрім менш успішних конкурентів.

Питання приватності актуальне і в галузі наукових досліджень. Може статися так, що група вчених, які зробили значущі відкриття, бажають залишитися анонімними (як у випадку з Bitcoin), наприклад, пояснюючи це тим, що вони працювали у великій команді й кожен її учасник зробив свій внесок у відкриття. У зв’язку з цим може набути актуальності питання щодо можливості легального анонімного фінансування наукових досліджень для розвитку незалежних і вільних від цензури дослідницьких інститутів.

Сьогодні використання аналітичних можливостей дозволяє компаніям не тільки враховувати звички користувачів, але і впливати на їхню поведінку. Усе це стало можливим завдяки обробленню даних про купівлі й інші дії користувачів у Мережі. Ці дані приносять компаніям великі прибутки.

Як приклад можна згадати гучний випадок у мережі магазинів Target [75], коли одна людина прийшла до магазину та була дуже обурена тим, що її дочці на пошту приходить велика кількість купонів на памперси та дитячий одяг, хоча вона ще навіть школу не закінчила та про дітей їй ще думати зарано. Менеджер магазину погодився, що це дивно, та вибачився. Усе би нічого, але дівчина насправді виявилася вагітною. Як би дивно це не звучало, система прогнозування вагітності, яку розробив аналітик Target Ендрю Пол (Andrew Pole), дозволила торговельній компанії дізнатися про вагітність дівчини набагато раніше за її батька, лише аналізуючи вибір її покупок.

Ця історія може викликати різні емоції, але слід підкреслити, що, скоріш за все, конкретній людині не сподобається, якщо вона дізнається, що значна кількість її покупок була спровокована саме в такий спосіб. До того ж, якщо проаналізувати отримані дані, то багато з них можуть виявитися персональними. А якщо врахувати, що ця людина могла не надавати згоду на їх оброблення, то логічно припустити, що вона буде відчувати себе обдуреною. Найімовірніше, людина захоче обмежити доступ до даних, завдяки яким якась компанія отримує можливість маніпулювати її поведінкою через «вигідні пропозиції» в потрібний час.

Тому питання про приватність у цифровому світі посідає одне з чільних місць серед тих, на які слід звертати увагу. А з огляду на розвиток технологій і аналітичних інструментів, це питання стає дедалі актуальнішим.

### Складники приватності

Поняття приватність включає два основні складники: *невідстежуваність (untraceability)* й *анонімність (anonymity)*. Невідстежуваність має на увазі неможливість віднести групу дій до деякого користувача в мережі. Анонімність пов’язана з неможливістю достовірно встановити особу користувача в цій мережі. На рис. 7.1 наведений приклад типової людини, яка бажає захистити себе і, відповідно, свою приватність у мережі.

![Рисунок 7.1 – Принципи забезпечення анонімності користувача в мережі](/resources/img/volume-1/7.1-privacy-as-a-concept-in-the-digital-world/7.1-principles-of-user-privacy.png)

Поняття анонімність має на увазі наявність соціального та технічного компонентів. Соціальна анонімність включає відомості, які може вказувати користувач про свою особу. Технічна анонімність набагато складніша, й основні зусилля із забезпечення анонімності докладаються саме в цій галузі.

Що ж стосується підвищення рівня приватності, то це може забезпечуватися спеціальними механізмами для приховування таких атрибутів активності користувачів:

* Прямого зв’язку між усіма діями, повідомленнями, транзакціями
* Версій застосунків й операційної системи
* Локалізації застосунків
* Часових міток повідомлень і запитів
* Ідентифікаторів (імені користувача, адреси електронної пошти, номера телефону)
* Самого факту дії
* Розташування пристроїв
* Мережевих адрес пристроїв

Деякі реалізації браузера Tor і клієнту BitTorrent уже давно підтримують розширені опції приватності, які допомагають приховувати деякі з перерахованих атрибутів. Методики можуть бути дійсно специфічними, наприклад, використання різних портів на мережевому рівні, висока надлишковість запитів, зміна розрізнювальних характеристик екрану за замовчуванням.

Як згадувалося раніше, Bitcoin довів, що фінансова система може бути прозорою, піддаватися перевірці для всіх учасників мережі за збереження певного рівня приватності користувачів. Утім, стало зрозуміло, що для деяких варіантів використання рівень прозорості, що забезпечується технологією blockchain, неприйнятний. Таким чином, нові методи для забезпечення більш високого рівня приватності користувачів були запропоновані й навіть реалізовані в деяких проектах криптовалют. Ці методи ефективно вирішували питання приватності транзакцій, залишаючи їх такими, що не змінюються та публічно перевіряються.

## 7.2 Приватність у цифрових валютах

Як згадувалося в розділі про платіжні канали (див. 4.8), розвиток цифрових валют ускладнюється проблемами масштабованості та приватності користувачів. Навіть більше, будь-яка система обліку активів, що використовує відкриту базу даних, наражається на проблему приватності [100]. А якщо йдеться про криптовалюти, то там принцип повної прозорості історії транзакцій взагалі базовий. Цей підрозділ присвячено тому, як у таких умовах досягти приватності користувачів.

Далі ми ознайомимося із моделлю приватності, принципами її забезпечення, розберемо декілька вже реалізованих на практиці підходів, а також проаналізуємо їхні переваги та недоліки.

> **Дані про транзакції, які слід приховувати передусім**
>> * *Історія походження монет* 
>> * *Суми платежів* 
>> * *Адреси (ідентифікатори користувачів)*
>> * *Мережеві адреси пристроїв користувачів* 
>> * *Метадані (час розповсюдження в мережі, версія гаманця, опис платежу й т. ін.)*

У деяких цифрових валютах використовується спеціальна структура транзакцій і модель обліку монет, яка дозволяє приховувати дані про деякі деталі операцій (табл. 7.1). Для приховування чи заплутування певних даних різні валюти застосовують різні методи.

![Таблиця 7.1 – Аспекти приватності в цифрових валютах](/resources/img/volume-1/7.2-privacy-in-digital-currencies/table-7.1-privacy.png)

### Сліпі підписи

Розгляньмо один із методів, що дозволяє декільком сторонам взаємодіяти та забезпечити водночас потрібний рівень приватності. Ідеться про сліпий підпис.

*Сліпий підпис (blind signature) – різновид цифрового підпису, особливість якого складається в тому, що сторона-підписант не може точно знати, що міститься в документі, що підписується* [105]. Кроки взаємодії учасників такі (рис. 7.2):

> 1. Автор виконує засліплення (blinding) документа своїм секретом і передає засліплений документ підписанту.
> 2. Підписувач за допомогою свого ключа підписує засліплений документ і повертає значення підпису автору.
> 3. Автор виконує зняття засліплення (unblinding) підписаного документа своїм секретом і пред’являє документ перевірячу.
> 4. Перевіряч бачить звичайний документ зі звичайним підписом, який перевіряється відкритим ключем підписанта.

![Рисунок 7.2 – Схема використання сліпого підпису](/resources/img/volume-1/7.2-privacy-in-digital-currencies/7.2-bling-sig.png)

Найширше схеми сліпих підписів застосовуються у сферах цифрових валют (для випускання анонімних цифрових банкнот) і таємного голосування (для анонімного отримання права голосу).

### Приватність у Біткоіні за замовчуванням

У Біткоіні забезпечується властивість анонімність, але її дуже легко втратити на практиці [101]. Не досягається повною мірою і властивість невідстежуваність. Ми можемо проаналізувати граф транзакцій і зробити висновки щодо їхнього «походження» з певних анонімних гаманців [102]. Якщо бодай одну адресу було скомпрометовано в контексті анонімності, можна встановити і зв’язок із певними особами. Найпростіша реалізація bitcoin-гаманця здатна забезпечити лише мінімальний рівень приватності.

Припустімо, для кожного вхідного платежу чи решти користувач створює нову адресу. Аудитор, що аналізує граф транзакцій, у цьому випадку вже не може достовірно зв’язати конкретні факти, що стосуються дій користувачів і розподілення валюти між ними. Але навіть у такій ситуації рівень приватності користувача не такий високий, як може здатися.

Зазвичай у Біткоіні приватність користувача залежить від його контрагентів. Отримувач платежа буде знати історію походження монет, а відправник монет буде знати, кому він їх передає (адресу отримувача) та, навіть більше, зможе відстежувати історію подальшої передачі монет. Інакше кажучи, генерація нових адрес ускладнюється можливістю відстеження ланцюжків, але не робить їх абсолютно невідстежуваними. Є низка метаданих, які можуть виявитися доступними третім сторонам: характер угоди, дані про гаманець, дані щодо місцезнаходження користувача тощо. Крім того, є методи, алгоритми, аналізатори, що дозволяють побудувати дерево з ланцюжків, знайти залежності за часом, за IP-адресами, за способом побудови транзакцій і з деякою ймовірністю можуть дати доволі близьку до реальності картину розподілення монет [103].

Слід розуміти, що якщо користувач хоче витратити монети, які прив’язані до кількох різних адрес, то транзакція, що міститиме багато входів, які належать одному користувачу, може повністю деанонімізувати його. Водночас до появи такої транзакції кожна окрема монета (невитрачений вихід) могла бути не зв’язана ні з рештою монет користувача, ні із самим користувачем.

Один із найпростіших способів заплутування історії транзакцій – використання т. зв. *міксерів (mixers)* [104]. Вони дозволяють змішати разом монети окремих користувачів. Для цього складається одна транзакція, а на її вхід подаються монети від різних власників. Монети з усіх входів сумуються, водночас змішуючись, а потім розподіляються між усіма виходами, у яких знову вказуються отримувачі. У такому випадку неможливо однозначно виявити історію передачі монети, тому що історії змішалися разом, а потім якимось чином розійшлись. Таке змішування в загальних транзакціях можна проводити навіть декілька разів поспіль. Наприклад, можна провести сім таких транзакцій поспіль. У підсумку ми отримаємо монети з дуже неоднозначною історією. Проте цей спосіб не один лише та має певні недоліки. Наприклад, деякі сервіси не приймають монети, що пройшли через міксер.

Варто також розуміти, що міксери – це організаційний метод підвищення рівня приватності. Тому відповідні сервіси зазвичай вимагають від користувача повної довіри як щодо збережності монет, так і щодо збереження анонімності користувача.

Щоби забезпечити максимальний рівень приватності, потрібно зрозуміти, які ж дані про транзакцію слід приховувати насамперед. До них належать дані про походження монет, що безпосередньо впливають на властивість *взаємозамінність (fungibility)*, дуже важливу для грошей та цінностей. На рівні протоколу Bitcoin ця властивість забезпечується (усі монети однакові, та правила їх оброблення однакові для всіх), але на практиці fungibility легко порушити. Наприклад, деякі мерчанти можуть аналізувати історію походження монет, які вони приймають, і відхиляти платежі, якщо ця історія викликає в них сумніви.

Наступне, що має сенс приховувати, це суми платежів, адреса відправника й отримувача в тілі транзакції. Важливо також приховати мережеві адреси користувачів, що зазвичай досягається за допомогою даркнетів, де використовуються такі протоколи як Freenet, Tor й I2P. Проте залишається питання: як же приховати суми, історію та адреси?

### CoinJoin

Найпростіший метод для заплутування графу транзакцій має назву *CoinJoin*. Його суть полягає в створенні спільної транзакції, унаслідок чого походження монет, що відправляються, стає неоднозначним. Формується група з користувачів, які створюють спільну транзакцію, у межах якої одночасно здійснюються декілька платежів. Тобто користувачам не потрібно створювати окремі транзакції.

Уперше таку ідею запропонував Ґреґорі Максвелл (Gregory Maxwell) у 2013 році на популярному форумі BitcoinTalk [106]. Відтоді було запропоновано та розроблено велику кількість модифікацій цього методу. Кожна з них покращувала певні властивості платежів. Поговорімо про те, як CoinJoin працює в чистій формі, а після розглянемо декілька найцікавіших його модифікацій.

Уявіть групу з трьох користувачів, у якій кожен хоче придбати товар у інтернет-магазині. Водночас для кожного з них магазин свій. Вони створюють одну транзакцію на три входи, по одному від кожного користувача, три виходи, по одному на кожен інтернет-магазин. Крім цього створюються ще три виходи для решти (рис. 7.3). Надалі всі виходи перемішуються між собою випадковим чином. Кожен користувач перевіряє отриману транзакцію й підписує вхід, що йому належить. У випадку успіху транзакція вважається правильною, розповсюджується мережею й отримує підтвердження.

![Рисунок 7.3 – Формування CoinJoin транзакції](/resources/img/volume-1/7.2-privacy-in-digital-currencies/7.3-coinjoin.png)

На рисунку 7.4 зображені два графи транзакцій: верхній і нижній. Для верхнього графа характерне те, що кожна транзакція має один чи два виходи, а транзакції нижнього графу можуть мати три й більше виходів. Нижній граф більш заплутаний і складний для аналізу.

![Рисунок 7.4 – Графи транзакцій із використанням CoinJoin і без такого](/resources/img/volume-1/7.2-privacy-in-digital-currencies/7.4-coinjoin-graph.png)

Щоби застосувати метод CoinJoin, наприклад, для відправлення біткоінів, спочатку потрібно сформувати групу користувачів, які одночасно бажають хочуть скористатися цим самим методом. Далі вони мають взаємодіяти, щоби сформувати спільну транзакцію. На практиці кінцеві транзакції можуть мати десятки входів і виходів (іноді більше). Зображений на площині граф таких транзакцій вийде дуже заплутаним (рис. 7.4). Монета, що пройшла ланцюжок таких транзакцій, має тисячі можливих варіантів походження. Складно визначити з-поміж усіх варіантів справжній.

Далі розглянемо різні модифікації методу CoinJoin, у яких творці намагаються досягти більшої приватності за допомогою різних способів.

### Chaumian CoinJoin

Одна з модифікацій CoinJoin має назву Chaumian CoinJoin. Запропонував її теж Gregory Maxwell. Тут залучається централізований оператор і використовується механізм cліпого підпису. Оператор потрібний, щоби перемішати входи та виходи, після чого скласти кінцеву транзакцію. Водночас оператор не може вкрасти монети чи порушити приватність перемішування. Завдяки сліпому підпису.

Користувач попередньо засліплює дані до їх передачі оператору (за використання механізму сліпого підпису). Коли оператор підписує ці дані, у нього немає доступу до фактичних складників. Підписані дані повертаються користувачеві, після чого він прибирає засліплення і все виглядає як звичайний цифровий підпис.

Як проходить взаємодія між користувачами й оператором під час формування спільної транзакції? Кожен користувач завчасно готує вхід, де витрачаються монети, що йому належать, адресу для отримання решти, а також засліплену адресу для відправлення платежа, після чого об’єднує ці дані в одну послідовність і передає оператору (рис. 7.5).

![Рисунок 7.5 – Взаємодія користувачів під час використання Chaumian CoinJoin](/resources/img/volume-1/7.2-privacy-in-digital-currencies/7.5-chaumian-coinjoin.png)

Оператор перевіряє вхід і суму платежа, підписує вихідну адресу й повертає підпис користувачу. Водночас оператор не має доступу до адреси, на яку користувач хоче відправити платіж, оскільки вона засліплена. Далі користувач прибирає засліплення з вихідної адреси, анонімно перепідключається до оператора й передає йому підписану вихідну адресу. Оператор, зі свого боку, перевіряє, що він дійсно підписував цю адресу своїм ключем і відповідний вхід у нього вже є, але водночас він не може знати, який вхід відповідає якому виходу. Після того, як усі користувачі виконали такі дії, вони знову анонімно підключаються до оператора й надають підписи, які підтверджують володіння монетами на вході спільної транзакції. Готову транзакцію розповсюджують у мережі для підтвердження; це роблять або самі користувачі, або оператор.

У такому разі ні користувачі, ні сам оператор не можуть деанонімізувати монети на вихідних адресах. Формування транзакції за нормальних умов займає не більш ніж одну хвилину. Відзначмо, що користувачі мають взаємодіяти через анонімні мережі передавання даних, як-от Tor, I2P чи Bitmessage.

Серед користувачів можуть бути недобросовісні, мета яких – порушити процес створення спільно транзакції будь-якими способами. Є цілий список можливих сценаріїв поведінки користувачів, зокрема й шахрайский. Розроблена ціла низка механізмів захисту для протистояння несприятливим сценаріям, які дозволяють чесним користувачам гарантовано сформувати кінечну транзакцію. Механізми захисту використовують таймаути, відстеження невитрачених виходів тощо.

### CoinShuffle

Модификацію *CoinShuffle* запропонували у 2014 році [107]. Тут уже немає центрального оператору, і це стало перевагою. Користувачі самостійно формують спільну транзакцію, спілкуючись між собою. Водночас приватність перемішування вихідних адрес і відповідних монет забезпечується навіть для самих учасників транзакції.

Ще одна перевага цього методу полягає в тім, що користувачам не обов’язково використовувати додаткові мережі для анонімізації трафіку, позаяк усі необхідні властивості буде досягнуто за використання однакового однорангового протоколу взаємодії користувачів.

У цьому разі застосовується асиметричне шифрування, де пускається в дію пара ключів (відкритий і особистий). Повідомлення шифрується за допомогою відкритого ключа, а розшифрувати його може тільки власник особистого ключа. Для комунікації між учасниками використовується протокол DiceMix, також передбачена протидія порушникам. Розгляньмо за допомогою схем, як працює CoinShuffle у спрощеній формі.

Уявімо невелику групу користувачів: хитра Аліса, мудрий Боб, бородатий Чарлі й помаранчевий Дейв. Кожний із них має одну невитрачену монету (один невитрачений вихід) в обліковій системі Bitcoin на адресах A, B, C та D, відповідно (рис. 7.6).

![Рисунок 7.6 – Група користувачів, що братиме участь у формуванні спільної транзакції](/resources/img/volume-1/7.2-privacy-in-digital-currencies/7.6-group-for-shared-tx.png)

Кожен хоче витратити монету та водночас приховати історію її походження. Для цього кожен учасник групи дізнається адресу, на яку має бути відправлена його монета, але не розголошує цю адресу іншим учасникам.

Далі кожний генерує нову пару ключів для асиметричного шифрування, після чого учасники групи обмінюються відкритими ключами шифрування між собою, причому новий відкритий ключ підписується особистим ключем, що відповідає адресі з невитраченою монетою. У такий самий спосіб підписуватимуться всі повідомлення учасників під час наступної взаємодії. Це був перший етап.

Учасники перемішуються й утворюють чергу. Аліса буде першою, тому що вона хитра, Боб другий, тому що він мудрий тощо. Тепер Аліса бере А’ і шифрує направлено на Дейва, використовуючи відкритий ключ Дейва відповідно. Шифротекст, що був отриманий Аліса знову шифрує, причому направлено на Чарлі. Цей шифротекст знову шифрується, але вже направлено на Боба (рис. 7.7).

![Рисунок 7.7 – Процес взаємодії користувачів за CoinShuffle](/resources/img/volume-1/7.2-privacy-in-digital-currencies/7.7-users-interaction-coin-shuffle.png)

Результат шифрування Аліса передає Бобу. Боб розшифровує своїм особистим ключем отримане повідомлення. Потім бере В’ і шифрує його направлено на Дейва, потім на Чарлі й додає до списку. Цей список він перемішує випадковим чином і передає Чарлі. Чарлі, зі свого боку, розшифровує елементи списку своїм особистим ключем, додає С’, зашифрований направлено на Дейва, до списку й перемішує всі елементи списку випадковим чином. Список передається Дейву, який його розшифровує, отримує відкрити дані адрес для відправки монет, додає адресу D’, перемішує випадковим чином і на основі цих адресів, відомих входів транзакції й сум формує спільну транзакцію.

Дейв розповсюджує заготовку транзакції іншим учасникам групи. Далі, кожен перевіряє, чи є у виходах транзакції необхідна для нього адреса й чи збігається сума переказу. Якщо умова виконана, то учасник підписує транзакцію, підтверджуючи володіння монетами свого входу (рис. 7.8). Учасники обмінюються підписами та якщо транзакція набирає всі необхідні підписи, то може бути розповсюджена мережею для підтвердження.

![Рисунок 7.8 – Формування загальної транзакції групи](/resources/img/volume-1/7.2-privacy-in-digital-currencies/7.8-formation-of-shared-tx.png)

Якщо хтось із учасників починає відхилятися від основного сценарію взаємодії, то інші можуть спільно проаналізувати історію взаємодії та вивести порушників із групи, щоби повторити все без них. Це дуже важлива особливість.

Відзначмо, що готові реалізації CoinShuffle уже є. На практиці вони ефективно працюють навіть на групах із декількох десятків користувачів. На цю мить очікується інтеграція цього протоколу до деяких bitcoin-гаманців, зокрема до мобільних версій.

### Недоліки методу CoinJoin

Очевидно, що для формування транзакції необхідна більш складна off-chain взаємодія, тобто необхідно організовувати формування груп і взаємодію користувачів один з одним. Але більш вагомий недолік складається в тому, що CoinJoin у чистій формі не приховує суми платежів. Як наслідок, він вразливий до *CoinJoin sudoku analysis*, що ґрунтується на зіставленні сум на виходах транзакцій і дозволяє розплутати історію походження монет після багаторазового її заплутування. Так, з цією проблемою можна боротися, наприклад, використовувати для вихідних значень транзакцій тільки відповідні суми (0,1 BTC, 1 BTC, 10 BTC тощо), але це створює додаткові складнощі й обмеження.

Інший спосіб, що вирішує проблему відкритості сум переводів, – *confidential transactions*. Однак перш ніж перейти до нього, пропонуємо розглянути основні принципи доказів із нульовим розголошенням.

### Концепція zero-knowledge proof

*Доказ із нульовим розголошенням (zero-knowledge proof, ZKP) – це метод, що дозволяє одній стороні довести знання секрету іншій стороні без розголошення даних самого секрету*.

Для побудування схем таких доказів можуть використовуватися різні математичні підходи. Проте схема може вважатися схемою ZKP, тільки якщо вона забезпечує властивості нижче.

> **Properties of zero-knowledge proofs**
>> * *Completeness (повнота)*
>> * *Soundness (коректність)*
>> * *Zero knowledge (нульове знання)*

*Сompleteness* передбачає, що якщо перевіряч і той, хто доводить, чесно слідують протоколу, то той, хто доводить, гарантовано може переконати перевіряча в коректності твердження (за винятком дуже малої ймовірності).

*Soundness* означає, що якщо твердження неправильне, то той, хто доводить, не зможе переконати перевіряча у своїй правоті (за винятком дуже малої ймовірності).

*Zero knowledge* передбачає, що під час доказу перевіряч не може дізнатися нічого про твердження крім факту, що воно правильне/неправильне.

Є два варіанти ZKP: інтерактивний та неінтерактивний. Інтерактивний варіант передбачає, що обидві сторони спілкуються безпосередньо між собою. Під час спілкування перевіряч дедалі більше переконується в тому, що твердження того, хто доводить, – правильне. Відзначмо, що за такого підходу жодну третю сторону неможливо переконати в тому, що твердження правильне, використовуючи ті самі докази.

У разі неінтерактивного протоколу, той, хто доводить, за попередньо визначеною схемою формує окремий набір даних. Цей набір – фактичний доказ твердження, що не має конкретного адресата. Маючи такий доказ, будь-хто може в будь-який момент часу переконатися в тім, чи правильне твердження того, хто доводить.

Для гарного розуміння того, як працюють ZKPs, пропонуємо розглянути такий приклад із розфарбовуванням вузлів графу.

Припустимо, Аліса захотіла перевірити свого друга Боба на кмітливість і запропонувала йому розв’язати цікаву задачу. Для цього вона намалювала декілька точок і з’єднала їх лініями в такий спосіб (рис. 7.9).

![Рисунок 7.9 – Положення вузлів графу](/resources/img/volume-1/7.2-privacy-in-digital-currencies/7.9-graph-nodes.png)

Після цього Аліса дала Бобу три маркери різного кольору та запропонувала йому спробувати розфарбувати вузли графу так, щоби не було жодного з’єднання між вузлами однакового кольору.

Боб дуже старався, витратив аж 4 хвилини, намагаючись знайти розв’язок, після чого заявив, що цю задачу вирішити неможливо. Аліса відповіла, що рішення є й вона може довести це Бобу. Водночас Аліса вигадала такий спосіб доведення, за якого вона не розкривала, як саме має бути розмальовано граф.

Отже, Аліса попросила Боба вийти з кімнати, після чого розфарбувала граф так, як на рис. 7.10.

![Рисунок 7.10 – Стан графу після розфарбовування](/resources/img/volume-1/7.2-privacy-in-digital-currencies/7.10-the-second-state-of-the-graph.png)

На кожну точку графу Аліса поставила ковпак, який приховував колір вузлу, і попросила Боба зайти назад до кімнати. Коли Боб зайшов, він побачив таке (рис. 7.11).

![Рисунок 7.11 – Приховання кольорів вузлів графу](/resources/img/volume-1/7.2-privacy-in-digital-currencies/7.11-the-hidden-graph.png)

Авжеж, Боб поцікавився, як же ковпаки допоможуть Алісі з доказами. Тоді Аліса попросила Боба підняти два будь-яких ковпаки, вузли під якими з’єднані між собою. Коли Боб підняв ковпаки, він побачив, що з’єднані вузли мають різний колір (рис. 7.12).

![Рисунок 7.12 – Перевірка твердження Аліси](/resources/img/volume-1/7.2-privacy-in-digital-currencies/7.12-verification-of-the-graph.png)

Звісно, Боб відразу не захотів здаватися і сказав, що раптом Алісі пощастило й інші з’єднані між собою вузли могли бути одного кольору. Аліса знову випровадила Боба з кімнати та перефарбувала граф знову, але перемішавши кольори. Боб заходить до кімнати, підіймає два сусідніх ковпаки й, авжеж, переконується, що під ними – вузли різного кольору.

Позаяк Боб не надто завзятий, то вже після 10-ї спроби він усе ж погодився, що задача має розв’язок й Аліса його знає. Найцікавіше в цьому прикладі (як і в концепції ZKP) те, що Алісі вдалося довести Бобу, що вона знає розв’язок задачі, не розкривши Бобу, у який саме спосіб вона розфарбувала граф.

### Confidential Transactions

Особливість методу *confidential transactions (CTs)* [94] полягає в тому, що він повністю приховує фактичні суми на входах і виходах транзакції від третіх осіб. Кожен може перевірити, що сума всіх виходів не перевищує суму всіх входів, – необхідну умову для верифікування та підтвердження транзакції.

Це стало можливим завдяки використанню описаного вище методу, а саме ZKP.

> * *Суми платежів приховані для всіх, окрім відправника й отримувача* 
> * *Транзакція містить дані, яких досить для її верифікування та підтвердження* 
> * *Використовується докази з нульовим розголошенням*

Для доведення того, що сума виходів не перевищує суму входів, використовується *зобов’язання Педерсена (Pedersen commitment)*, що ґрунтується на перетвореннях у групі точок еліптичної кривої. Для боротьби з неконтрольованою емісією монет у цій схемі обов’язково застосовується доказ використання допустимих сум на виході транзакції. Щоби перевірити, що були використані невід’ємні суми, які не перевищують порядок базової точки, застосовуються т. зв. *докази діапазону (range proofs)*.

І все б було добре, але створення цих самих range proofs досить витратне з погляду обчислювальних ресурсів. До того ж, вони дуже великі за обсягом. Теоретично, інтегрувати confidential transactions до протоколу Bitcoin можливо, але ніхто дуже не поспішає це робити із-за їх великого об’єму. Утім, уже є робочі облікові системи, де confidential transactions успішно застосовуються.

### Ring Confidential Transactions

Наступний метод має назву *ring confidential transactions*. За суттю, це гібрид CTs і механізму кільцевого підпису. Ring confidential transactions передбачать використання зобов’язань Педерсена для приховування сум платежів і кільцевих підписів для заплутування історії походження монет. Це означає, що відправник платежу на вході своєї транзакції посилається не на один конкретний вихід (UTXO), а відразу на декілька. Далі за допомогою кільцевого підпису він доводить, що йому належать монети одного з декількох виходів, але не розголошується, з якого саме. З цього випливає, що неможливо однозначно відстежити історію походження монет.

Застосування кільцевих підписів у такий спосіб (рис. 7.13) було вперше запропоновано в одному зі стандартів протоколу *CryptoNote* [108], на базі якого працюють декілька криптовалют. Ring confidential transactions дозволяють створювати транзакції з багатьма входами та виходами, де неможливо однозначно відстежити походження кожного входу, суми платежів приховані, а взаємодія з іншими користувачами для створення транзакції не потрібна.

![Рисунок 7.13 – Використання кільцевого підпису для ring confidential transactions](/resources/img/volume-1/7.2-privacy-in-digital-currencies/7.13-ring-signature.png)

### MimbleWimble

*MimbleWimble – це формат і протокол формування транзакцій та блоків цифрової валюти, що дозволяє забезпечити високий рівень приватності користувачів, спираючись тільки на криптографічні примітиви*. У своїй нинішній формі MimbleWimble не сумісний із протоколом Bitcoin і може бути реалізований тільки у форм sidechain або в окремій обліковій системі. Головні особливості MimbleWimble такі:

>> * *Порівняно високий рівень приватності користувачів* 
>> * *Підтримуються транзакції тільки з підвищеним рівнем приватності* 
>> * *Ефективне агрегування даних про невитрачені монети* 
>> * *Порівняно низький темп збільшення розміру бази даних* 

Криптовалюта Grin – перший проєкт, що реалізує протокол MimbleWimble. Першу тестову мережу (testnet) було запущено 16 листопада 2017 року, і її мета була знаходження недоліків у самій концепції MimbleWimble. 26 березня 2018 року протокол було доопрацьовано та було запущено testnet2, після закінчення роботи якої в проєкт знову було додано велика кількість технічних оновлень, а також було виправлено критичні вразливості протоколу. 7 липня 2018 року було запущено testnet3, а для завершення тестування цифрової валюти 17 жовтня 2018 року було запущено testnet4.

15 січня 2019 року в криптовалюті Grin почала працювати основна мережа (mainnet). На рис. 7.14 наведено дані відповідного genesis block. Як постійну тестову мережу було паралельно запущено ще одну мережу проєкту – floonet.

![Рисунок 7.14 – Genesis block проєкту Grin](/resources/img/volume-1/7.2-privacy-in-digital-currencies/7.14-grin-genesis-block.png)

### Stealth Addresses

Цей метод передбачає розрахування прихованих адрес, на які відправлятимуться монети. Уперше цю ідею описав Пітер Тодд (Peter Todd). Метод stealth addresses потребує від відправника платежа створення випадкової одноразової адреси для кожної транзакції. У випадку проведення декількох транзакцій на один stealth address, у ланцюжку блоків будуть міститися дані про декілька платежів на зовсім різні адреси [110].

Подібний підхід дозволяє зробити неможливим зв’язування транзакцій із конкретним ідентифікатором користувача. Як ідентифікатори користувачів використовуються відкрити ключі: якщо ви хочете приймати платежі, то вам потрібно оголосити свій відкритий ключ. Водночас тільки володілець stealth address може за допомогою свого особистого ключа переглянути всі транзакції, адресовані йому. Відправник використовує свою пару ключів і відкритий ключ отримувача для обчислення нового одноразового відкритого ключу, який уже буде вказаний у транзакції в якості адреси.

> * *Адреса, на яку відправляються монети, можуть знати тільки відправник і отримувач*
> * *Сторонній спостерігач не може ні підтвердити, ні спростувати зв’язок між ідентифікатором користувача й адресою призначення платежу*

Як приклад можна навести інтернет-магазин, який використовує stealth address для прийому платежів. У цьому разі для кожного вхідного платежу буде формуватися нова одноразова адреса, що сильно ускладнює відстежування діяльності інтернет-магазину (рис. 7.15).

![Рисунок 7.15 – Використання stealth address з боку магазину для приймання платежів](/resources/img/volume-1/7.2-privacy-in-digital-currencies/7.15-stealth-addresses.png)

### Концепція гомоморфного шифрування

У контексті асиметричної криптографії також не можна не згадати про *гомоморфне шифрування (homomorphic encryption)*. *Гомоморфна криптосистема – це система, що дозволяє проведення деяких дій із відкритим текстом через проведення операцій із шифротекстом*. Тобто, використовуючи такі системи ви можете дозволити іншій стороні обробляти ваші важливі (sensitive) дані, і водночас не турбуватися про їх витік. Наприклад, ви можете зашифрувати дані про свої прибутки та витрати та відправити їх до бухгалтера для підрахування поточного балансу, причем йому не буде потрібно розшифровувати дані, адже всі операції він виконуватиме із шифротекстом. У результаті, бухгалтер поверне вам зашифрований документ, що містить результат. Доступ до цього документу можна буде отримати під час використання тільки того ключа, який використовувався для шифрування початкового документу.

**Часті запитання**

*– Чи можливо використовувати stealth addresses у Біткоіні?*

Так, ви вже зараз можете ними користуватися, оновлення протоколу для цього не потребується. Але для більш широкої адаптації цієї функціональності необхідно суворо специфікувати порядок обчислень і формати даних, щоб усі гаманці могли працювати один із одним і, відповідно, упроваджувати цю функцію в самі гаманці. Для впровадження цієї специфікації Peter Todd уже створив окремий BIP, але він ще на етапі розгляду.

*– Чи ефективно використовувати CoinJoin у чистій формі для Bitcoin?*

Ні, у чистій формі це малоефективно, тому що такі транзакції піддаються простому аналізу за сумами платежів. Як варіант, можна використовувати однакові суми для всіх учасників схеми заплутування, водночас потрібно уникати довірених міксерів, які можуть або вкрасти монети, або порушити приватність.

*– Чи можна застосувати розглянуті вище методи для забезпечення приватності в цифрових валютах, як-от Ethereum, Ripple та Stellar?*

Ні, це не так. Ethereum, Ripple та Stellar використовують зовсім іншу модель транзакцій та інший спосіб обліку монет, до яких неможливо застосувати такі методи забезпечення приватності. Ви, авжеж, можете спробувати штучно інтегрувати stealth addresses чи confidential transactions, але це буде вкрай малоефективно з погляду продуктивності системи. Причина полягає в тому, що в Біткоіні облік здійснюється на основі невитрачених виходів, а перелічені в запитанні валюти використовують баланси й акаунти.

[ВИСНОВОК](https://github.com/distributed-lab/blockchain-and-decentralized-systems-book/blob/main/chapters/volume-1/ua/8-conclusion.md)   